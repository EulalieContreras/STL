"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[8347],{98347:(e,t,n)=>{n.r(t),n.d(t,{Annotation:()=>ot,AnnotationModel:()=>Rt,Annotations:()=>Ct,CommandIDs:()=>qe,ControlPanelHeader:()=>jt,ControlPanelModel:()=>kt,FloatingAnnotation:()=>it,FormDialog:()=>$,JupyterCadMainViewPanel:()=>dt,JupyterCadPanel:()=>yt,JupyterCadWidget:()=>wt,LeftPanelWidget:()=>Pt,MainView:()=>ct,Message:()=>nt,ObjectProperties:()=>St,ObjectPropertiesForm:()=>d,ObjectTree:()=>Oe,PanZoom:()=>se,ReactAnnotations:()=>ft,RightPanelWidget:()=>Lt,Separator:()=>Bt,SketcherDialog:()=>re,SketcherModel:()=>ie,SketcherReactWidget:()=>ae,TOOLBAR_SEPARATOR_CLASS:()=>Nt,TREE_THEMES:()=>ke,ToolbarSwitch:()=>ne,ToolbarWidget:()=>Vt,UsersItem:()=>Dt,addCommands:()=>Ge,axesIcon:()=>A,boxIcon:()=>C,chamferIcon:()=>D,chevronRightIcon:()=>V,clippingIcon:()=>L,coneIcon:()=>j,createHeader:()=>xt,cutIcon:()=>P,cylinderIcon:()=>S,debounce:()=>R,distance:()=>oe,drawCircle:()=>te,drawLine:()=>ee,drawPoint:()=>K,dryRunCheck:()=>Le,executeOperator:()=>Re,explodedViewIcon:()=>T,extrusionIcon:()=>E,filletIcon:()=>N,focusInputField:()=>z,getCSSVariableColor:()=>G,getElementFromProperty:()=>H,handleRemoveObject:()=>Ee,intersectionIcon:()=>O,itemFromName:()=>W,logoIcon:()=>b,minimizeIcon:()=>f,nearest:()=>Z,newName:()=>Te,removeStyleFromProperty:()=>U,requestAPI:()=>q,setVisible:()=>De,sphereIcon:()=>x,stlIcon:()=>w,stpIcon:()=>y,throttle:()=>F,torusIcon:()=>M,transformIcon:()=>I,unionIcon:()=>k,visibilityIcon:()=>v,visibilityOffIcon:()=>_,wireframeIcon:()=>B});var o=n(18504),i=n(64530),s=n(95870),a=n.n(s),r=n(99925);const l=e=>{const{formData:t=[],name:n,required:o,schema:i,errorSchema:s={},onChange:r,onBlur:l}=e,c=(e,n)=>{const o=[...t];o[e]=n,r(o)};return a().createElement("fieldset",null,a().createElement("legend",null,n),a().createElement("p",{className:"field-description"},i.description),a().createElement("div",{className:"custom-array-wrapper"},t.map(((e,t)=>{var r,d,h;return a().createElement("div",{key:t,className:"array-item"},((e,t)=>{const{enum:s,type:r}=i.items||{};return s?a().createElement("select",{value:e||"",required:o,onChange:e=>c(t,e.target.value),onBlur:()=>l(n,e)},s.map(((e,t)=>a().createElement("option",{key:t,value:e},e)))):"number"===r?a().createElement("input",{type:"number",value:e,step:"any",required:o,onChange:e=>c(t,""===e.target.value?null:parseFloat(e.target.value)),onBlur:()=>l(n,e)}):"boolean"===r?a().createElement("input",{type:"checkbox",checked:!!e,onChange:e=>c(t,e.target.checked),onBlur:()=>l(n,e)}):a().createElement("input",{type:"text",value:e,required:o,onChange:e=>c(t,e.target.value),onBlur:()=>l(n,e)})})(e,t),(null===(d=null===(r=null==s?void 0:s[t])||void 0===r?void 0:r.__errors)||void 0===d?void 0:d.length)>0&&a().createElement("div",{className:"validationErrors"},null===(h=null==s?void 0:s[t])||void 0===h?void 0:h.__errors.map(((e,n)=>a().createElement("div",{key:`${t}-${n}`,className:"error"},e)))))}))))};const c=e=>{const{fields:t}=e,n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["fields"]);return s.createElement(i.FormComponent,Object.assign({},n,{validator:r.Ay,fields:Object.assign(Object.assign({},t),{ArrayField:l})}))};class d extends s.Component{constructor(e){super(e),this.setStateByKey=(e,t)=>{const n=parseFloat(t);Number.isNaN(n)||this.setState((t=>Object.assign(Object.assign({},t),{internalData:Object.assign(Object.assign({},t.internalData),{[e]:n})})),(()=>this.props.syncData({[e]:n})))},this.onFormSubmit=e=>{const t=Object.assign({},this.state.internalData);Object.entries(e.formData).forEach((([e,n])=>t[e]=n)),this.setState((e=>Object.assign(Object.assign({},e),{internalData:t})),(()=>{this.props.syncData(e.formData),this.props.cancel&&this.props.cancel()}))},this.state={internalData:Object.assign({},this.props.sourceData),schema:e.schema}}componentDidUpdate(e){e.sourceData!==this.props.sourceData&&this.setState((e=>Object.assign(Object.assign({},e),{internalData:this.props.sourceData}))),e.schema!==this.props.schema&&this.setState((e=>Object.assign(Object.assign({},e),{schema:this.props.schema})))}buildForm(){if(!this.props.sourceData||!this.state.internalData)return[];const e=[];for(const[t,n]of Object.entries(this.props.sourceData)){let o;"string"!=typeof n&&"number"!=typeof n||(o=s.createElement("div",{key:t},s.createElement("label",{htmlFor:""},t),s.createElement("input",{type:"number",value:this.state.internalData[t],onChange:e=>this.setStateByKey(t,e.target.value)})),e.push(o))}return e}removeArrayButton(e,t){Object.entries(e.properties).forEach((([e,n])=>{"array"===n.type?t[e]={"ui:options":{orderable:!1,removable:!1,addable:!1}}:"object"===n.type&&(t[e]={},this.removeArrayButton(n,t[e])),t.Color={"ui:widget":"color"}}))}generateUiSchema(e){const t={additionalProperties:{"ui:label":!1,classNames:"jpcad-hidden-field"}};return this.removeArrayButton(e,t),t}render(){var e;if(this.props.schema){const t=Object.assign(Object.assign({},this.props.schema),{additionalProperties:!0}),n=s.createRef();return s.createElement("div",{className:"jpcad-property-panel","data-path":null!==(e=this.props.filePath)&&void 0!==e?e:""},s.createElement("div",{className:"jpcad-property-outer jp-scrollbar-tiny",onKeyUp:e=>{var t;"Enter"===e.key&&(e.preventDefault(),null===(t=n.current)||void 0===t||t.click())}},s.createElement(c,{schema:t,uiSchema:this.generateUiSchema(this.props.schema),formData:this.state.internalData,onSubmit:this.onFormSubmit,liveValidate:!0,onFocus:(e,t)=>{this.props.syncSelectedField&&this.props.syncSelectedField(e,t,this.props.parentType)},onBlur:(e,t)=>{this.props.syncSelectedField&&this.props.syncSelectedField(null,t,this.props.parentType)},children:s.createElement("button",{ref:n,type:"submit",style:{display:"none"}})})),s.createElement("div",{className:"jpcad-property-buttons"},this.props.cancel?s.createElement("button",{className:"jp-Dialog-button jp-mod-reject jp-mod-styled",onClick:this.props.cancel},s.createElement("div",{className:"jp-Dialog-buttonLabel"},"Cancel")):null,s.createElement("button",{className:"jp-Dialog-button jp-mod-accept jp-mod-styled",type:"button",onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()}},s.createElement("div",{className:"jp-Dialog-buttonLabel"},"Submit"))))}return s.createElement("div",null,this.buildForm())}}var h=n(62246),p=n(51827),m=n(8996);const u='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0V0z" fill="none" />\n    <path class="jp-icon3" d="M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z" fill="none" />\n</svg>\n',g='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none" />\n    <path class="jp-icon3" d="M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z" fill="none" />\n</svg>\n',v=new i.LabIcon({name:"jupytercad:visibilityIcon",svgstr:u}),_=new i.LabIcon({name:"jupytercad:visibilityOffIcon",svgstr:g}),b=new i.LabIcon({name:"jupytercad:logo",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="190.03" height="190.01" preserveAspectRatio="xMidYMid slice" version="1.1" viewBox="-300 -225 190.03 190.01" xmlns="http://www.w3.org/2000/svg">\n <path class="jp-icon-selectable jcad-main-logo" d="m-210.76-223.82a94 94 0 0 0-38.453 10.877 94 94 0 0 0-38.719 127.17 94 94 0 0 0 127.17 38.719 94 94 0 0 0 38.719-127.17 94 94 0 0 0-88.719-49.596zm8.5918 17.875 3.7832 0.23438 0.39258 1.2402 0.32813 1.2383 0.25976 1.2324 0.17774 1.2266 0.0723 1.2148 2.418 0.31445 2.4043 0.39844 0.42187-1.1406 0.52539-1.123 0.60352-1.1055 0.67383-1.0879 0.73437-1.0742 3.6895 0.87109 0.17773 1.2891 0.11328 1.2754 0.0469 1.2578-0.0312 1.2383-0.13282 1.2109 2.3281 0.71875 2.3027 0.79883 0.60938-1.0527 0.70703-1.0176 0.78125-0.98828 0.84766-0.95898 0.90625-0.9336 3.4883 1.4824-0.043 1.2988-0.10156 1.2774-0.16797 1.248-0.24024 1.2148-0.33593 1.1719 2.1738 1.1016 2.1348 1.1758 0.77734-0.93555 0.86914-0.88281 0.93946-0.83985 0.99609-0.80468 1.0508-0.76563 3.1875 2.0488-0.26172 1.2754-0.3164 1.2402-0.375 1.2012-0.44336 1.1582-0.5293 1.0977 1.957 1.4531 1.9043 1.5195 0.92578-0.79101 1.0059-0.72266 1.0664-0.66992 1.1191-0.62305 1.1641-0.57813 2.7969 2.5586-0.47461 1.2109-0.52148 1.1699-0.57422 1.1211-0.63086 1.0664-0.70703 0.99218 1.6836 1.7617 1.6191 1.8223 1.0469-0.62305 1.1133-0.54297 1.1641-0.48047 1.209-0.42578 1.2461-0.37305 2.3223 2.9941-0.67188 1.1152-0.71094 1.0644-0.75586 1.0078-0.80273 0.94336-0.86328 0.85938 1.3594 2.0215 1.2891 2.0684 1.1367-0.4375 1.1895-0.34765 1.2285-0.27539 1.2617-0.21485 1.293-0.1582 1.7832 3.3457-0.85156 0.98438-0.88086 0.92773-0.91406 0.86719-0.95117 0.79297-0.9961 0.70117 0.99805 2.2227 0.92188 2.2558 1.1934-0.23828 1.2305-0.14062 1.2578-0.0664 1.2812 2e-3 1.2988 0.0645 1.1934 3.5976-1.0039 0.82618-1.0274 0.76562-1.0469 0.69922-1.0723 0.62305-1.0996 0.52148 0.60937 2.3594 0.52539 2.3789 1.2188-0.0332 1.2363 0.0684 1.25 0.15039 1.2617 0.2168 1.2715 0.2832 0.56641 3.7461-1.1309 0.64648-1.1387 0.58203-1.1523 0.51172-1.1602 0.43164-1.1738 0.32812 0.20312 2.4297 0.11524 2.4336 1.207 0.17188 1.207 0.27734 1.207 0.35742 1.207 0.42969 1.2031 0.49219-0.0742 3.7891-1.2227 0.44531-1.2207 0.38086-1.2207 0.31055-1.2188 0.22851-1.2109 0.12501-0.21094 2.4277-0.29687 2.4199 1.1582 0.37305 1.1445 0.47656 1.1289 0.5586 1.1172 0.62499 1.1035 0.68946-0.71289 3.7226-1.2812 0.23047-1.2695 0.16992-1.2559 0.0996-1.2383 0.0195-1.2148-0.0801-0.61914 2.3555-0.70117 2.334 1.0801 0.56445 1.0449 0.66407 1.0195 0.74023 0.9961 0.80469 0.9707 0.86719-1.332 3.5469-1.3008 0.0137-1.2793-0.0488-1.2559-0.11523-1.2227-0.1875-1.1855-0.28711-1.0078 2.2188-1.0859 2.1836 0.96875 0.73828 0.91992 0.83008 0.87891 0.90234 0.84375 0.96094 0.8125 1.0176-1.9141 3.2715-1.2832-0.20703-1.2539-0.26367-1.2168-0.32422-1.1738-0.39453-1.1191-0.48047-1.3691 2.0156-1.4375 1.9668 0.82812 0.89258 0.76563 0.97461 0.71484 1.0371 0.66992 1.0898 0.62695 1.1406-2.4375 2.9023-1.2305-0.42187-1.1914-0.47266-1.1445-0.52539-1.0918-0.58594-1.0195-0.66406-1.6914 1.7559-1.75 1.6953 0.66797 1.0195 0.58984 1.0898 0.5293 1.1426 0.47461 1.1895 0.42578 1.2285-2.8926 2.4492-1.1426-0.625-1.0938-0.66602-1.0391-0.71094-0.97656-0.76172-0.89454-0.82812-1.9629 1.4453-2.0117 1.375 0.48632 1.1172 0.39649 1.1738 0.32812 1.2168 0.26758 1.252 0.21289 1.2832-3.2656 1.9238-1.0195-0.80859-0.9668-0.83984-0.9043-0.87695-0.83203-0.91602-0.74219-0.9668-2.1797 1.0918-2.2148 1.0156 0.28906 1.1836 0.19336 1.2246 0.11914 1.2539 0.0527 1.2793-8e-3 1.3008-3.5449 1.3438-0.86915-0.96875-0.80859-0.99219-0.74219-1.0176-0.66796-1.043-0.5684-1.0781-2.3301 0.70898-2.3555 0.62695 0.0859 1.2148-0.0176 1.2383-0.0957 1.2559-0.16406 1.2695-0.22852 1.2812-3.7188 0.72656-0.69336-1.1016-0.6289-1.1152-0.56055-1.127-0.48047-1.1426-0.3789-1.1582-2.418 0.30469-2.4258 0.2207-0.12305 1.2109-0.22461 1.2188-0.30664 1.2207-0.37695 1.2246-0.43946 1.2246-3.791 0.08594-0.49609-1.2031-0.43165-1.2051-0.36132-1.207-0.28125-1.2051-0.17774-1.2051-2.4336-0.10938-2.4297-0.19336-0.32422 1.1738-0.42773 1.1621-0.50781 1.1523-0.57813 1.1426-0.64258 1.1328-3.75-0.55469-0.28515-1.2695-0.22266-1.2617-0.15234-1.25-0.0723-1.2363 0.0293-1.2168-2.3809-0.51953-2.3633-0.60156-0.51758 1.1016-0.61914 1.0742-0.69532 1.0508-0.76171 1.0273-0.82422 1.0078-3.6016-1.1816-0.0684-1.2988-6e-3 -1.2793 0.0605-1.2598 0.13868-1.2305 0.23437-1.1953-2.2598-0.91406-2.2266-0.99024-0.69531 0.99805-0.79102 0.95312-0.86328 0.91797-0.92578 0.88476-0.98242 0.85352-3.3516-1.7734 0.15429-1.291 0.21094-1.2637 0.27149-1.2285 0.34375-1.1914 0.43359-1.1387-2.0723-1.2812-2.0273-1.3535-0.85547 0.86719-0.94141 0.80469-1.0058 0.75781-1.0606 0.7168-1.1133 0.67578-3.002-2.3145 0.36914-1.248 0.42188-1.209 0.47656-1.166 0.53906-1.1152 0.61914-1.0469-1.8262-1.6152-1.7676-1.6758-0.99023 0.70898-1.0644 0.63477-1.1191 0.57813-1.168 0.52539-1.209 0.47852-2.5684-2.7871 0.57421-1.168 0.61914-1.1211 0.66602-1.0684 0.7207-1.0078 0.78711-0.92969-1.5254-1.8984-1.4609-1.9512-1.0957 0.53125-1.1543 0.44726-1.2012 0.37891-1.2402 0.32226-1.2734 0.26562-2.0606-3.1816 0.76368-1.0527 0.80078-1 0.83593-0.94141 0.88086-0.87109 0.9336-0.7832-1.1836-2.1289-1.1094-2.1699-1.1699 0.33789-1.2148 0.24609-1.2461 0.17188-1.2774 0.10547-1.2988 0.04687-1.4941-3.4824 0.93164-0.91016 0.95703-0.84961 0.98438-0.78515 1.0137-0.71094 1.0527-0.61328-0.80664-2.2988-0.72657-2.3262-1.2109 0.13672-1.2383 0.0351-1.2578-0.041-1.2754-0.11133-1.2891-0.17383-0.88477-3.6856 1.0723-0.73828 1.0859-0.67578 1.1035-0.60937 1.1211-0.52735 1.1406-0.42773-0.40625-2.4024-0.32422-2.416-1.2148-0.0684-1.2266-0.17383-1.2344-0.25586-1.2383-0.32422-1.2422-0.38867-0.24609-3.7812 1.1797-0.54687 1.1856-0.48242 1.1914-0.41406 1.1934-0.33203 1.1953-0.22657 6e-3 -2.4375 0.0899-2.4355-1.1856-0.27344-1.1797-0.37891-1.1738-0.45898-1.166-0.5293-1.1582-0.5918 0.39453-3.7695 1.2578-0.33984 1.25-0.27539 1.2422-0.20703 1.2324-0.125 1.2168-0.0215 0.41797-2.4023 0.5-2.3848-1.123-0.4707-1.0977-0.57227-1.0801-0.65039-1.0586-0.71875-1.041-0.77929 1.0254-3.6484 1.2969-0.12305 1.2773-0.0605 1.2598 8e-3 1.2363 0.084 1.2031 0.1836 0.81836-2.2949 0.89648-2.2676-1.0293-0.65235-0.98438-0.75-0.95312-0.82422-0.92383-0.88672-0.89453-0.94531 1.6289-3.4219 1.2969 0.0977 1.2715 0.15625 1.2402 0.22071 1.2031 0.29297 1.1562 0.38476 1.1914-2.125 1.2676-2.082-0.90235-0.81836-0.8457-0.90625-0.79883-0.97266-0.75976-1.0312-0.72266-1.082 2.1836-3.0976 1.2617 0.3164 1.2266 0.36914 1.1855 0.42578 1.1367 0.49219 1.0742 0.57422 1.5352-1.8926 1.5996-1.8379-0.75196-0.95898-0.67969-1.0352-0.62304-1.0957-0.57618-1.1426-0.52734-1.1894 2.6758-2.6836 1.1894 0.52343 1.1465 0.57227 1.0957 0.61914 1.0371 0.67773 0.96094 0.74805 1.834-1.6074 1.8867-1.541-0.5781-1.0723-0.49414-1.1348-0.42969-1.1836-0.375-1.2246-0.32031-1.2617 3.0918-2.1934 1.084 0.71875 1.0332 0.75586 0.97657 0.79687 0.9082 0.8418 0.82031 0.90039 2.0781-1.2734 2.1211-1.1992-0.38867-1.1543-0.29688-1.2031-0.22266-1.2402-0.16211-1.2695-0.10156-1.2969 3.418-1.6406 0.94727 0.89258 0.89062 0.91992 0.82617 0.94922 0.75196 0.98438 0.6582 1.0254 2.2637-0.9043 2.293-0.82422-0.1875-1.2031-0.0898-1.2363-0.0117-1.2598 0.0566-1.2773 0.11914-1.2969 3.6445-1.0391 0.7832 1.0391 0.72266 1.0586 0.6543 1.0762 0.57619 1.0957 0.47461 1.1211 2.3828-0.50782 2.4004-0.42383 0.0176-1.2188 0.12109-1.2324 0.20117-1.2441 0.27149-1.25 0.33594-1.2578 3.7676-0.4082 0.59766 1.1562 0.5332 1.1641 0.46289 1.1719 0.38086 1.1797 0.2793 1.1856 2.4336-0.0996 2.4375-0.0117 0.22461-1.1973 0.32813-1.1953 0.4082-1.1914 0.47851-1.1875z" fill="#4584b6"/>\n <path class="jp-icon-selectable jcad-main-logo" d="m-200.32-159.63-0.48828 0.67188-0.43164 0.68554-0.37304 0.69727-0.29883 0.70703-0.19922 0.7207-0.25195 2.2969-2.7578-0.14453-2.7578 0.17578-0.27734-2.2949-0.20703-0.71875-0.3086-0.70313-0.3789-0.6914-0.43945-0.67969-0.4961-0.66797-3.6543 0.85547-0.14844 0.81836-0.0918 0.80469-0.0332 0.78906 0.0371 0.76758 0.13282 0.73437 0.76953 2.1797-2.5469 1.0664-2.4082 1.3535-1.2461-1.9453-0.49805-0.5586-0.58203-0.5-0.64258-0.45898-0.69141-0.42187-0.73632-0.38477-2.9219 2.3554 0.22266 0.80078 0.26562 0.76563 0.3125 0.72461 0.36719 0.67578 0.43945 0.60352 1.6387 1.6308-1.832 2.0664-1.582 2.2637-1.9688-1.2129-0.68945-0.28515-0.74219-0.19922-0.77734-0.13477-0.80664-0.0801-0.83008-0.0273-1.6094 3.3906 0.54688 0.625 0.57226 0.57423 0.5957 0.51757 0.62305 0.44922 0.6582 0.35352 2.1836 0.75781-0.75391 2.6582-0.44336 2.7246-2.2988-0.23828-0.74609 0.041-0.75586 0.14453-0.75781 0.21484-0.76172 0.2793-0.75977 0.33398 0.0215 3.7539 0.76367 0.32617 0.76367 0.26758 0.76172 0.20703 0.75586 0.13672 0.74609 0.0332 2.2969-0.26562 0.47461 2.7207 0.7832 2.6484-2.1758 0.7832-0.6543 0.35938-0.61718 0.45898-0.58985 0.52344-0.56445 0.58008-0.54102 0.63086 1.6484 3.373 0.83008-0.0371 0.80469-0.0898 0.77539-0.14453 0.74023-0.20508 0.6875-0.29492 1.9531-1.2344 1.6074 2.2461 1.8555 2.0469-1.6211 1.6484-0.43164 0.60742-0.35742 0.67969-0.30469 0.72852-0.25781 0.76757-0.21289 0.80274 2.9492 2.3242 0.73047-0.39453 0.68554-0.42774 0.63672-0.4668 0.57813-0.50781 0.49023-0.5625 1.2246-1.9609 2.4238 1.3262 2.5586 1.0391-0.74414 2.1894-0.125 0.73438-0.0273 0.76953 0.041 0.78711 0.10157 0.80469 0.15625 0.81445 3.6641 0.81445 0.48828-0.67187 0.43164-0.68555 0.37305-0.69531 0.29883-0.70703 0.19922-0.72071 0.25195-2.2969 2.7578 0.14258 2.7578-0.17383 0.27735 2.2949 0.20703 0.7168 0.30859 0.70312 0.37891 0.69336 0.43946 0.67968 0.49609 0.66602 3.6543-0.85547 0.14844-0.8164 0.0918-0.80469 0.0332-0.78906-0.0371-0.76758-0.13281-0.73438-0.76953-2.1797 2.5469-1.0684 2.4082-1.3535 1.2461 1.9473 0.49805 0.55664 0.58203 0.5 0.64258 0.45898 0.6914 0.42188 0.73633 0.38672 2.9219-2.3574-0.22266-0.80078-0.26563-0.76562-0.3125-0.72266-0.36718-0.67578-0.43946-0.60547-1.6387-1.6289 1.832-2.0684 1.582-2.2637 1.9688 1.2129 0.68946 0.28711 0.74219 0.19727 0.77734 0.13476 0.80664 0.0801 0.83008 0.0293 1.6094-3.3926-0.54687-0.625-0.57226-0.57422-0.59571-0.51562-0.62304-0.45118-0.65821-0.35351-2.1836-0.75781 0.7539-2.6562 0.44336-2.7266 2.2988 0.23828 0.7461-0.041 0.7539-0.14258 0.75977-0.2168 0.76172-0.27734 0.75976-0.33398-0.0215-3.7539-0.76367-0.32617-0.76368-0.26953-0.76171-0.20704-0.75586-0.13476-0.7461-0.0332-2.2969 0.26562-0.47461-2.7226-0.78321-2.6484 2.1758-0.78125 0.65429-0.36133 0.61719-0.45703 0.58984-0.52344 0.56446-0.58008 0.54101-0.63086-1.6484-3.375-0.83007 0.0391-0.80469 0.0899-0.77539 0.14257-0.74024 0.20704-0.6875 0.29296-1.9531 1.2363-1.6074-2.2461-1.8555-2.0469 1.6191-1.6484 0.43359-0.60938 0.35742-0.67969 0.30469-0.72851 0.25781-0.76758 0.21289-0.80273-2.9492-2.3242-0.73047 0.39453-0.68555 0.42969-0.63867 0.46679-0.57617 0.50586-0.49219 0.5625-1.2227 1.9609-2.4238-1.3262-2.5586-1.0391 0.74414-2.1875 0.125-0.73633 0.0274-0.76758-0.041-0.78906-0.10156-0.80274-0.15625-0.8164zm-4.3848 21.641a8 8 0 0 1 5.9453 2.9707 8 8 0 0 1-1.2031 11.25 8 8 0 0 1-11.25-1.2031 8 8 0 0 1 1.2031-11.25 8 8 0 0 1 5.3047-1.7676z" fill="#ffde57"/>\n <path class="jp-icon-selectable jcad-main-logo" d="m-152.75-159.38-0.43359 0.625-0.37891 0.63477-0.31836 0.64453-0.24609 0.65234-0.14844 0.65821-0.13086 2.6699-2.709 0.0703-2.666 0.47656-0.66601-2.5898-0.27735-0.61524-0.37304-0.58789-0.44141-0.56836-0.49805-0.54687-0.55078-0.52539-3.4688 1.4141-0.0273 0.75977 0.0254 0.74023 0.082 0.71485 0.14453 0.68164 0.23242 0.63281 1.332 2.3184-2.2402 1.5215-1.9863 1.8438-1.959-1.8184-0.56641-0.36914-0.63281-0.29297-0.67773-0.23828-0.71485-0.1914-0.74805-0.14454-2.1523 3.0645 0.38871 0.65427 0.41993 0.60937 0.45508 0.55664 0.49023 0.4961 0.53711 0.40625 2.375 1.2305-1.0606 2.4922-0.67578 2.623-2.6309-0.4707-0.67578-4e-3 -0.69141 0.0957-0.69921 0.16601-0.70313 0.22656-0.70703 0.28125-0.15625 3.7422 0.68164 0.33984 0.68359 0.28516 0.68164 0.22266 0.68165 0.15234 0.67187 0.0527 2.6621-0.25 0.45508 2.6699 0.84961 2.5723-2.4668 1.0274-0.57031 0.36133-0.5293 0.45312-0.5 0.51758-0.46875 0.57226-0.44336 0.61915 1.8926 3.2324 0.75781-0.082 0.72852-0.13086 0.69531-0.18164 0.6543-0.24024 0.59375-0.32031 2.1035-1.6484 1.8262 2 2.1074 1.7051-1.5215 2.1992-0.2832 0.61133-0.20117 0.66797-0.14063 0.70507-0.0859 0.73438-0.0371 0.76172 3.3398 1.6953 0.5918-0.47852 0.54296-0.5039 0.48633-0.5293 0.42188-0.55469 0.32617-0.58984 0.87891-2.5254 2.6172 0.69531 2.6934 0.29492-0.0898 2.6719 0.0918 0.66797 0.1914 0.66992 0.26367 0.66992 0.32423 0.66406 0.38081 0.66018 3.7266-0.3789 0.24024-0.72266 0.18359-0.7168 0.12305-0.70703 0.0547-0.69531-0.0449-0.67383-0.625-2.5996 2.5781-0.83007 2.4238-1.207 1.3691 2.2969 0.4375 0.51172 0.52539 0.45898 0.58203 0.42188 0.63281 0.38281 0.67773 0.34961 2.9277-2.332-0.1875-0.73828-0.23242-0.70313-0.2793-0.66211-0.33008-0.61328-0.40234-0.54297-1.9316-1.8476 1.7207-2.0918 1.3867-2.3281 2.3926 1.1914 0.64648 0.19531 0.68945 0.10352 0.7168 0.0371 0.74024-0.0176 0.75781-0.0723 1.2051-3.5469-0.5586-0.51758-0.57617-0.4668-0.5918-0.40625-0.60937-0.33789-0.63086-0.23828-2.625-0.51172 0.31641-2.6894-0.0918-2.707 2.6582-0.29102 0.64844-0.18554 0.63477-0.28711 0.625-0.35547 0.61132-0.41602 0.59961-0.4707-0.90429-3.6328-0.75-0.13477-0.73633-0.0801-0.71875-0.0215-0.69531 0.0449-0.66016 0.14063-2.4824 0.98828-1.1895-2.4336-1.541-2.2285 2.0781-1.6816 0.44532-0.50586 0.38086-0.58399 0.33203-0.63671 0.29101-0.68165 0.25-0.7207-2.7266-2.5664-0.70312 0.29101-0.66211 0.33008-0.61719 0.37109-0.56055 0.41406-0.47851 0.47461-1.5547 2.1758-2.3164-1.4062-2.5-1.041 0.83985-2.5371 0.0996-0.66797 4e-3 -0.69727-0.0644-0.71679-0.12305-0.72852-0.17969-0.74023zm-2.4629 21.865a2 2 0 0 1 1.6426 0.98828 2 2 0 0 1-0.71484 2.7363 2 2 0 0 1-2.7363-0.71485 2 2 0 0 1 0.71484-2.7383 2 2 0 0 1 1.0938-0.27148z" fill="#597083"/>\n <path class="jp-icon-selectable jcad-main-logo" d="m-232.88-194.22-3.7441 0.0234-0.30859 0.69531-0.25195 0.69727-0.18946 0.69336-0.11914 0.68554-0.0195 0.67578 0.375 2.6465-2.6445 0.58203-2.5293 0.9707-1.1445-2.416-0.38672-0.55274-0.47851-0.50586-0.54102-0.47461-0.59375-0.44335-0.64062-0.41016-3.1367 2.043 0.11719 0.75195 0.16406 0.72266 0.21484 0.68554 0.27149 0.64258 0.34765 0.57813 1.748 2.0234-1.9121 1.918-1.6016 2.1856-2.2695-1.4141-0.625-0.25586-0.67578-0.16797-0.71094-0.10547-0.73828-0.0527h-0.76172l-1.5352 3.416 0.50586 0.57031 0.5293 0.51758 0.55078 0.46094 0.57617 0.39258 0.60547 0.29883 2.5625 0.75781-0.57031 2.6484-0.16602 2.7031-2.6719 0.0371-0.66407 0.12305-0.66015 0.22461-0.65625 0.29492-0.64844 0.35547-0.64062 0.41211 0.55468 3.7031 0.73438 0.20508 0.72461 0.15039 0.71289 0.0898 0.69726 0.0195 0.66993-0.0762 2.5664-0.74804 0.95117 2.5352 1.3223 2.3652-2.2285 1.4766-0.49023 0.46289-0.43555 0.54492-0.39062 0.60156-0.35352 0.6504-0.3164 0.69335 2.4688 2.8145 0.72851-0.22267 0.68945-0.26562 0.64844-0.31055 0.59766-0.35937 0.52343-0.42774 1.7539-2.0156 2.1719 1.6172 2.3906 1.2754-1.0781 2.4473-0.1621 0.6543-0.0703 0.69336-4e-3 0.71875 0.0527 0.73828 0.10938 0.7539 3.5976 1.0332 0.49219-0.58203 0.4375-0.59766 0.37891-0.61133 0.30664-0.625 0.20898-0.64062 0.38672-2.6465 2.7012 0.1875 2.6992-0.2207 0.41797 2.6406 0.2168 0.64063 0.3164 0.62109 0.38477 0.60743 0.44336 0.59179 0.5 0.57422 3.5859-1.0762 0.0996-0.75586 0.0449-0.73828-0.0137-0.71875-0.0781-0.69141-0.17188-0.6543-1.1055-2.4336 2.375-1.3027 2.1524-1.6445 1.7773 1.9961 0.52735 0.41992 0.60156 0.35156 0.65234 0.30274 0.69532 0.25781 0.73046 0.21484 2.4336-2.8457-0.32422-0.6875-0.36133-0.64648-0.39844-0.59766-0.4414-0.53906-0.4961-0.45703-2.248-1.4492 1.2949-2.3809 0.91992-2.5469 2.5762 0.7168 0.66992 0.0684 0.69727-0.0293 0.71289-0.0977 0.72266-0.15821 0.73048-0.2148 0.50975-3.709-0.64453-0.40429-0.65429-0.34766-0.65821-0.28711-0.66406-0.21679-0.66406-0.11524-2.6738-4e-3 -0.19922-2.7012-0.60156-2.6406 2.5547-0.78906 0.60156-0.30665 0.57031-0.40039 0.54688-0.46679 0.52148-0.52539 0.49805-0.57422-1.5762-3.3984-0.75976 0.01-0.73828 0.0605-0.70899 0.11524-0.67578 0.17578-0.62109 0.26367-2.252 1.4414-1.627-2.166-1.9355-1.8965 1.7226-2.043 0.3418-0.58399 0.26367-0.64453 0.20508-0.68945 0.15625-0.72266 0.10937-0.7539-3.1621-2.0059-0.63671 0.41992-0.5879 0.44922-0.53515 0.48047-0.4707 0.51367-0.38086 0.55664-1.1152 2.4297-2.541-0.94141-2.6524-0.54883 0.34375-2.6504-0.0273-0.67578-0.12695-0.68555-0.19922-0.68945-0.25977-0.69336zm-1.7402 21.938a2 2 0 0 1 1.9277 1.4258 2 2 0 0 1-1.3398 2.4902 2 2 0 0 1-2.4902-1.3398 2 2 0 0 1 1.3398-2.4902 2 2 0 0 1 0.5625-0.0859z" fill="#646464"/>\n <path class="jp-icon-selectable jcad-main-logo" d="m-227.89-108.04-3.6719 0.73047-0.17188 0.74218-0.11523 0.73243-0.0547 0.71679 0.0117 0.69532 0.10937 0.66797 0.86914 2.5273-2.4883 1.0703-2.2988 1.4336-1.5801-2.1563-0.48633-0.46874-0.56445-0.40821-0.6211-0.36133-0.66601-0.32226-0.70703-0.2832-2.6934 2.5996 0.25781 0.7168 0.29883 0.67773 0.33984 0.63281 0.38672 0.57812 0.45117 0.50195 2.0996 1.6562-1.5137 2.248-1.1602 2.4473-2.4941-0.95898-0.66211-0.13281-0.69726-0.03711-0.7168 0.03125-0.73438 0.08789-0.74804 0.14453-0.86133 3.6445 0.60352 0.46289 0.61718 0.4082 0.62891 0.34961 0.64062 0.27734 0.6504 0.17773 2.6602 0.25977-0.0586 2.707 0.34765 2.6875-2.6172 0.54102-0.62696 0.24805-0.60742 0.34375-0.58789 0.41406-0.56836 0.47266-0.55273 0.52539 1.2461 3.5312 0.75977 0.0625 0.74023 0.0098 0.7168-0.04688 0.6875-0.11133 0.64453-0.20117 2.3789-1.2207 1.4141 2.3086 1.7461 2.0723-1.9102 1.8711-0.39453 0.54688-0.32226 0.61914-0.27149 0.66406-0.22461 0.70508-0.17968 0.74024 2.957 2.2969 0.67383-0.35547 0.62695-0.39258 0.57812-0.42774 0.51953-0.46484 0.43165-0.51953 1.3418-2.3125 2.4375 1.1797 2.5879 0.79883-0.59375 2.6055-0.0351 0.67383 0.0605 0.69531 0.13282 0.70508 0.19336 0.71484 0.24804 0.7207 3.7305 0.33203 0.37305-0.66406 0.3164-0.66797 0.25391-0.67188 0.18555-0.67188 0.084-0.66992-0.12304-2.6699 2.6894-0.32812 2.6094-0.72656 0.90821 2.5137 0.33398 0.58594 0.42774 0.55078 0.49218 0.52344 0.54883 0.49609 0.59961 0.4707 3.3164-1.7363-0.0449-0.75977-0.0957-0.73438-0.14843-0.70312-0.20899-0.66406-0.29101-0.60938-1.5469-2.1797 2.0859-1.7285 1.8008-2.0234 2.125 1.623 0.59766 0.3125 0.6582 0.23242 0.69726 0.17383 0.72852 0.12109 0.75977 0.07227 1.8516-3.2539-0.44922-0.61524-0.47656-0.56445-0.50586-0.51172-0.53516-0.44726-0.57422-0.35352-2.4785-0.99805 0.81836-2.582 0.42187-2.6758 2.666 0.2168 0.67187-0.06055 0.67774-0.16016 0.67968-0.23047 0.68164-0.29297 0.67579-0.34766-0.20118-3.7402-0.70898-0.27344-0.70898-0.21875-0.70118-0.15625-0.6914-0.08789-0.67383 0.01367-2.627 0.5-0.70508-2.6152-1.0918-2.4785 2.3594-1.2578 0.5332-0.41406 0.48242-0.50195 0.44922-0.5625 0.41211-0.61328 0.38086-0.6582-2.1894-3.0371-0.7461 0.15234-0.71289 0.19922-0.67578 0.24609-0.62695 0.30274-0.5625 0.375-1.9375 1.8398-2.0078-1.8164-2.2578-1.4961 1.3047-2.334 0.22461-0.63672 0.13476-0.68359 0.0723-0.71484 0.0176-0.74024-0.0371-0.75977-3.4844-1.3711-0.54492 0.5332-0.49219 0.55274-0.43359 0.57226-0.36719 0.59375-0.26758 0.61719-0.63672 2.5977-2.6719-0.44336-2.707-0.0371-0.16406-2.668-0.15625-0.65821-0.25391-0.64843-0.32617-0.64063-0.38672-0.63086zm2.7266 21.836a2 2 0 0 1 2.1035 1.8887 2 2 0 0 1-1.8887 2.1055 2 2 0 0 1-2.1055-1.8906 2 2 0 0 1 1.8906-2.1035z" fill="#9f9260"/>\n</svg>\n'}),w=new i.LabIcon({name:"jupytercad:stl",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   viewBox="0 0 24 24"\n   version="1.1"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon-selectable jp-icon3" fill="#616161">\n    <path\n       d="M 21.939453 17.714844 C 21.770649 17.781584 21.58954 17.820312 21.400391 17.820312 L 19.490234 17.820312 L 19.490234 20.169922 C 19.490234 20.169922 19.379766 20.429688 19.259766 20.429688 L 4.5390625 20.429688 C 4.4190625 20.429688 4.3007813 20.429922 4.3007812 20.169922 L 4.3007812 17.820312 L 2.5996094 17.820312 C 2.2914969 17.820312 2.0046132 17.721338 1.7597656 17.554688 L 1.7597656 21.060547 C 1.7597656 22.200547 2.5791406 23.089844 3.6191406 23.089844 L 20.080078 23.089844 C 21.130078 23.089844 21.939453 22.190547 21.939453 21.060547 L 21.939453 17.714844 z " />\n    <path\n       d="M 3.6191406 0.91015625 C 2.6891406 1.0401562 1.7597656 2.0594531 1.7597656 3.1894531 L 1.7597656 9.0253906 C 2.0046132 8.8587401 2.2914969 8.7597656 2.5996094 8.7597656 L 4.3007812 8.7597656 L 4.3007812 4.0800781 C 4.3007812 3.8300781 4.4190625 3.6992187 4.5390625 3.6992188 L 12.880859 3.6992188 L 12.880859 8.7597656 L 14.75 8.7597656 L 14.75 4.3398438 L 18.568359 8.7597656 L 21.400391 8.7597656 C 21.498819 8.7597656 21.593859 8.7701776 21.6875 8.7890625 A 1.72 1.72 0 0 0 21.470703 8.5195312 L 21.460938 8.5195312 L 15.099609 1.5507812 A 1.84 1.84 0 0 0 13.699219 0.91015625 L 3.6191406 0.91015625 z " />\n    <path\n       d="M 2.5996094,8.2597656 C 1.420367,8.2597656 0.5,9.2973684 0.5,10.5 v 5.580078 c 0,1.202632 0.920367,2.240234 2.0996094,2.240234 H 21.400391 C 22.579633,18.320312 23.5,17.28271 23.5,16.080078 V 10.5 c 0,-1.2026316 -0.920367,-2.2402344 -2.099609,-2.2402344 z m 0,1 H 21.400391 C 21.981148,9.2597656 22.5,9.8026316 22.5,10.5 v 5.580078 c 0,0.697369 -0.518852,1.240234 -1.099609,1.240234 H 2.5996094 C 2.0188518,17.320312 1.5,16.777447 1.5,16.080078 V 10.5 C 1.5,9.8026316 2.0188518,9.2597656 2.5996094,9.2597656 Z" />\n    <path\n       d="M9.73 14.41c0 .34-.08.64-.24.9-.16.26-.4.47-.7.61-.3.14-.66.22-1.07.22-.83 0-1.48-.27-1.97-.79l.6-.72c.38.37.82.55 1.34.55.25 0 .44-.06.6-.17a.6.6 0 0 0 .22-.5c0-.2-.06-.35-.2-.46a2.07 2.07 0 0 0-.7-.34c-.58-.2-.99-.42-1.23-.68a1.4 1.4 0 0 1-.37-1c0-.33.08-.61.25-.85.16-.24.39-.43.67-.55.28-.13.6-.19.95-.19.73 0 1.32.24 1.78.7l-.56.7a1.7 1.7 0 0 0-1.13-.45.93.93 0 0 0-.55.14.44.44 0 0 0-.2.39c0 .11.04.21.1.29.06.08.16.15.3.22.13.07.34.15.62.24.5.17.88.38 1.12.65.25.26.37.63.37 1.1ZM12.7 16h-1.18v-4.43h-1.4v-.99h4.02l-.12.99H12.7V16Zm2.22-5.42h1.18v4.4h2.14l-.1 1.02h-3.22v-5.42Z" />\n  </g>\n</svg>\n'}),y=new i.LabIcon({name:"jupytercad:stp",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   viewBox="0 0 24 24"\n   version="1.1"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon-selectable jp-icon3" fill="#616161">\n    <path\n       d="M 21.940039 17.714453 C 21.770921 17.781473 21.589565 17.819922 21.4 17.819922 L 19.490039 17.819922 L 19.490039 20.169922 C 19.490039 20.169922 19.379961 20.430078 19.259961 20.430078 L 4.5400391 20.430078 C 4.4200391 20.430078 4.3 20.429922 4.3 20.169922 L 4.3 17.819922 L 2.6 17.819922 C 2.2920338 17.819922 2.0047336 17.721583 1.7599609 17.555078 L 1.7599609 21.059961 C 1.7599609 22.199961 2.5799219 23.090039 3.6199219 23.090039 L 20.080078 23.090039 C 21.130078 23.090039 21.940039 22.189961 21.940039 21.059961 L 21.940039 17.714453 z "/>\n    <path\n       d="M 3.6199219 0.90996094 C 2.6899219 1.0399609 1.7599609 2.0600391 1.7599609 3.1900391 L 1.7599609 9.0248047 C 2.0047259 8.8583145 2.2920489 8.7599609 2.6 8.7599609 L 4.3 8.7599609 L 4.3 4.0800781 C 4.3 3.8300781 4.4200391 3.7 4.5400391 3.7 L 12.880078 3.7 L 12.880078 8.7599609 L 14.75 8.7599609 L 14.75 4.3400391 L 18.568945 8.7599609 L 21.4 8.7599609 C 21.498268 8.7599609 21.594198 8.7712142 21.687695 8.7900391 A 1.72 1.72 0 0 0 21.469922 8.5199219 L 21.459961 8.5199219 L 15.1 1.55 A 1.84 1.84 0 0 0 13.7 0.90996094 L 3.6199219 0.90996094 z "/>\n    <path\n       d="M 2.5996094,8.2597656 C 1.420367,8.2597656 0.5,9.2973684 0.5,10.5 v 5.580078 c 0,1.202632 0.920367,2.240235 2.0996094,2.240234 H 21.400391 C 22.579633,18.320312 23.5,17.28271 23.5,16.080078 V 10.5 c 0,-1.2026316 -0.920367,-2.2402344 -2.099609,-2.2402344 z m 0,1 H 21.400391 C 21.981148,9.2597656 22.5,9.8026316 22.5,10.5 v 5.580078 c 0,0.697369 -0.518852,1.240234 -1.099609,1.240234 H 2.5996094 C 2.0188518,17.320313 1.5,16.777447 1.5,16.080078 V 10.5 C 1.5,9.8026316 2.0188518,9.2597656 2.5996094,9.2597656 Z"/>\n    <path\n       d="m 9.74,14.42 c 0,0.34 -0.08,0.64 -0.24,0.9 -0.17,0.26 -0.4,0.46 -0.7,0.61 -0.3,0.14 -0.67,0.21 -1.08,0.21 -0.82,0 -1.48,-0.26 -1.96,-0.78 l 0.59,-0.72 c 0.38,0.36 0.82,0.55 1.34,0.55 0.25,0 0.45,-0.06 0.6,-0.18 a 0.6,0.6 0 0 0 0.22,-0.49 c 0,-0.2 -0.06,-0.35 -0.19,-0.46 a 2.03,2.03 0 0 0 -0.7,-0.35 c -0.58,-0.19 -1,-0.42 -1.24,-0.68 -0.24,-0.26 -0.37,-0.6 -0.37,-1 0,-0.33 0.08,-0.61 0.25,-0.85 0.16,-0.24 0.39,-0.43 0.67,-0.55 0.29,-0.13 0.6,-0.19 0.95,-0.19 0.73,0 1.33,0.24 1.78,0.7 l -0.55,0.7 a 1.7,1.7 0 0 0 -1.14,-0.45 0.93,0.93 0 0 0 -0.55,0.14 0.44,0.44 0 0 0 -0.19,0.4 c 0,0.1 0.03,0.2 0.09,0.28 0.06,0.08 0.16,0.15 0.3,0.22 0.14,0.07 0.34,0.15 0.62,0.24 0.5,0.17 0.88,0.39 1.13,0.65 0.25,0.26 0.37,0.63 0.37,1.1 z M 12.7,16 h -1.18 v -4.43 h -1.4 v -0.99 h 4.03 l -0.12,0.99 H 12.7 Z m 5.7,-3.65 c 0,0.61 -0.18,1.08 -0.54,1.39 -0.35,0.3 -0.82,0.46 -1.43,0.46 H 15.89 V 16 H 14.7 v -5.42 h 1.56 c 0.7,0 1.22,0.15 1.58,0.45 0.36,0.3 0.54,0.73 0.54,1.32 z m -1.21,0 c 0,-0.57 -0.3,-0.85 -0.9,-0.85 h -0.4 v 1.78 h 0.46 c 0.27,0 0.47,-0.08 0.62,-0.23 0.15,-0.15 0.22,-0.39 0.22,-0.7 z"/>\n  </g>\n</svg>\n'}),f=new i.LabIcon({name:"jupytercad:minimize-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20"><path class="jp-icon3" fill="#616161" d="M5 11.75v-1.5h10v1.5Z"/></svg>\n'}),C=new i.LabIcon({name:"jupytercad:box-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="14.3" viewBox="0 0 21.45 14.3" version="1.1" height="14.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.75039085,0.49939006)">\n      <path\n         d="M 0.97460938,-0.32421875 A 0.97509752,0.97509752 0 0 0 0,0.65039062 V 15.650391 A 0.97509752,0.97509752 0 0 0 0.97460938,16.625 H 15.974609 a 0.97509752,0.97509752 0 0 0 0.97461,-0.974609 V 0.65039062 a 0.97509752,0.97509752 0 0 0 -0.97461,-0.97460937 z M 1.9492187,1.625 H 15 V 14.675781 H 1.9492187 Z" />\n      <path\n         d="M 3.9746094,-3.3242188 A 0.97500002,0.97500002 0 0 0 3,-2.3496094 0.97500002,0.97500002 0 0 0 3.9746094,-1.375 H 18 v 13.621094 l -2.714844,2.714844 a 0.97500002,0.97500002 0 0 0 0,1.378906 0.97500002,0.97500002 0 0 0 1.378906,0 l 3,-3 a 0.97509752,0.97509752 0 0 0 0.285157,-0.689453 V -2.3496094 a 0.97509752,0.97509752 0 0 0 -0.97461,-0.9746094 z" />\n      <path\n         d="m 18.974609,-3.3242188 a 0.97500002,0.97500002 0 0 0 -0.689453,0.2851563 l -3,3 a 0.97500002,0.97500002 0 0 0 0,1.3789062 0.97500002,0.97500002 0 0 0 1.378906,0 l 3,-2.9999999 a 0.97500002,0.97500002 0 0 0 0,-1.3789063 0.97500002,0.97500002 0 0 0 -0.689453,-0.2851563 z" />\n      <path\n         d="m 3.9746094,-3.3242188 a 0.97500002,0.97500002 0 0 0 -0.6894531,0.2851563 l -3.00000005,3 a 0.97500002,0.97500002 0 0 0 0,1.3789062 0.97500002,0.97500002 0 0 0 1.37890625,0 l 3,-2.9999999 a 0.97500002,0.97500002 0 0 0 0,-1.3789063 0.97500002,0.97500002 0 0 0 -0.6894531,-0.2851563 z" />\n   </g>\n</svg>\n'}),j=new i.LabIcon({name:"jupytercad:cone-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.3" viewBox="0 0 18.45 13.3" version="1.1" height="13.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.75038755,0.49961028)">\n      <path\n         d="M 8.4746094,-3.0742188 A 0.97509752,0.97509752 0 0 0 7.6035156,-2.5371094 L 0.10351562,12.462891 A 0.97509752,0.97509752 0 0 0 0,12.900391 c 0,0 0.01804825,0.240769 0.07226562,0.392578 C 0.126483,13.444777 0.21694,13.605641 0.34375,13.757813 0.59736999,14.062156 0.9779784,14.325566 1.5507812,14.554688 2.696387,15.01293 4.6596132,15.375 8.4746094,15.375 c 3.8149966,0 5.7801756,-0.36207 6.9257816,-0.820312 0.572802,-0.229122 0.953411,-0.492532 1.207031,-0.796875 0.12681,-0.152172 0.217267,-0.313036 0.271484,-0.464844 0.05422,-0.151809 0.07031,-0.392578 0.07031,-0.392578 a 0.97509752,0.97509752 0 0 0 -0.101563,-0.4375 L 9.3476563,-2.5371094 A 0.97509752,0.97509752 0 0 0 8.4746094,-3.0742188 Z M 8.4765625,0.08007812 14.779297,12.6875 c -0.05791,0.02963 -0.01621,0.02172 -0.103516,0.05664 -0.729392,0.291757 -2.516175,0.68164 -6.2011716,0.68164 -3.6849963,0 -5.4698264,-0.389883 -6.1992188,-0.68164 C 2.1880816,12.70922 2.2297876,12.71713 2.171875,12.6875 Z" />\n   </g>\n</svg>\n'}),x=new i.LabIcon({name:"jupytercad:sphere-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.3" viewBox="0 0 18.45 12.3" version="1.1" height="12.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.7503905,0.4996094)">\n      <path\n         d="M 8.4746094,-2.8242188 C 3.8055493,-2.8242188 0,0.98133055 0,5.6503906 0,10.319451 3.8055493,14.125 8.4746094,14.125 c 4.6690596,0 8.4746096,-3.805549 8.4746096,-8.4746094 0,-4.66906005 -3.80555,-8.4746094 -8.4746096,-8.4746094 z m 0,1.9492188 C 12.089812,-0.875 15,2.0351877 15,5.6503906 15,9.2655935 12.089812,12.175781 8.4746094,12.175781 4.8594065,12.175781 1.9492187,9.2655935 1.9492187,5.6503906 1.9492188,2.0351877 4.8594065,-0.875 8.4746094,-0.875 Z" />\n   </g>\n</svg>\n'}),S=new i.LabIcon({name:"jupytercad:cylinder-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.299" viewBox="0 0 18.448499 14.299001" version="1.1" height="14.299" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.7496415,0.4991099)">\n      <path\n         d="m 8.4746094,-3.3242188 c -3.8149962,0 -5.7782224,0.3601171 -6.9238282,0.8183594 -0.5728028,0.2291212 -0.95341121,0.492531 -1.2070312,0.796875 -0.12680999,0.152172 -0.21726701,0.3149883 -0.27148438,0.4667969 C 0.01804826,-1.0903789 0,-0.84960938 0,-0.84960938 V 14.150391 c 0,0 0.01804825,0.240769 0.07226562,0.392578 C 0.126483,14.694777 0.21694,14.855641 0.34375,15.007813 0.59736999,15.312156 0.9779784,15.575566 1.5507812,15.804688 2.696387,16.26293 4.6596132,16.625 8.4746094,16.625 c 3.8149966,0 5.7801756,-0.36207 6.9257816,-0.820312 0.572802,-0.229122 0.953411,-0.492532 1.207031,-0.796875 0.12681,-0.152172 0.217267,-0.313036 0.271484,-0.464844 0.05422,-0.151809 0.07031,-0.392578 0.07031,-0.392578 V -0.84960938 c 0,0 -0.01609,-0.24076952 -0.07031,-0.39257812 -0.05422,-0.1518086 -0.144674,-0.3146249 -0.271484,-0.4667969 -0.25362,-0.304344 -0.634229,-0.5677538 -1.207031,-0.796875 -1.145606,-0.4582423 -3.110785,-0.8183594 -6.9257816,-0.8183594 z m 0,1.9492188 c 3.0471916,0 4.5852506,0.2665045 5.5117186,0.5234375 -0.926377,0.25696341 -2.464139,0.52734375 -5.5117186,0.52734375 -3.0487048,0 -4.5856075,-0.27029195 -5.5117188,-0.52734375 C 3.8890936,-1.1085838 5.426293,-1.375 8.4746094,-1.375 Z M 1.9492187,0.8984375 C 3.1300711,1.3036077 4.9683623,1.625 8.4746094,1.625 11.979656,1.625 13.81903,1.3034006 15,0.8984375 V 13.818359 c -0.03402,0.02875 -0.05133,0.06663 -0.324219,0.175782 -0.729392,0.291757 -2.516175,0.68164 -6.2011716,0.68164 -3.6849963,0 -5.4698264,-0.389883 -6.1992188,-0.68164 C 2.0012328,13.884477 1.9826178,13.846664 1.9492187,13.818359 Z" />\n   </g>\n</svg>\n'}),M=new i.LabIcon({name:"jupytercad:torus-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.424" viewBox="0 0 18.636 9.3000002" version="1.1" height="9.3000002" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.75013988,0.4996095)">\n      <path\n         d="M 1.0683594,3.9257813 A 0.97500002,0.97500002 0 0 0 0.09375,4.9003906 c 0,0 0.0199614,1.5024693 1.1621094,2.8730469 1.1421479,1.3705776 3.3675039,2.6015625 7.3125,2.6015625 3.9449956,0 6.1683986,-1.2309849 7.3105466,-2.6015625 1.142148,-1.3705776 1.164063,-2.8730469 1.164063,-2.8730469 A 0.97500002,0.97500002 0 0 0 16.068359,3.9257813 0.97500002,0.97500002 0 0 0 15.09375,4.9003906 c 0,0 0.01996,0.7455798 -0.712891,1.625 -0.73285,0.8794202 -2.257503,1.9003907 -5.8124996,1.9003907 -3.5549965,0 -5.081603,-1.0209705 -5.8144531,-1.9003907 -0.7328502,-0.8794202 -0.7109375,-1.625 -0.7109375,-1.625 A 0.97500002,0.97500002 0 0 0 1.0683594,3.9257813 Z" />\n      <path\n         d="M 4.0683594,3.9257813 A 0.97500002,0.97500002 0 0 0 3.09375,4.9003906 c 0,0 0.024046,0.3742631 0.171875,0.6699219 0.1478294,0.2956588 0.4181616,0.6199202 0.8242187,0.890625 C 4.901958,7.002347 6.2100284,7.375 8.5683594,7.375 10.92669,7.375 12.234761,7.002347 13.046875,6.4609375 13.452932,6.1902327 13.721311,5.8659712 13.869141,5.5703125 14.01697,5.2746538 14.042969,4.9003906 14.042969,4.9003906 A 0.97500002,0.97500002 0 0 0 13.068359,3.9257813 0.97500002,0.97500002 0 0 0 12.09375,4.9003906 c 0,0 0.02404,-0.1867628 0.03125,-0.2011719 0.0072,-0.014409 -0.0037,0.034377 -0.160156,0.1386719 -0.312885,0.2085897 -1.25482,0.5878907 -3.3964846,0.5878906 -2.1416645,0 -3.0835998,-0.3793008 -3.3964844,-0.5878906 C 5.0154327,4.7335958 5.0025611,4.6848097 5.0097656,4.6992187 c 0.0072,0.014409 0.033203,0.2011719 0.033203,0.2011719 A 0.97500002,0.97500002 0 0 0 4.0683594,3.9257813 Z" />\n      <path\n         d="m 8.5683594,-2.0742188 c -4.716662,0 -7.0736345,1.69023778 -7.9980469,3.5390625 -0.92441237,1.8488248 -0.44726562,3.671875 -0.44726563,3.671875 A 0.97500002,0.97500002 0 0 0 1.3046875,5.8457031 0.97500002,0.97500002 0 0 0 2.0136719,4.6640625 c 0,0 -0.2748049,-1.1769528 0.3007812,-2.328125 C 2.8900392,1.1847653 4.2850303,-0.125 8.5683594,-0.125 c 4.2833286,0 5.6763666,1.3097653 6.2519536,2.4609375 0.575586,1.1511722 0.302734,2.328125 0.302734,2.328125 a 0.97500002,0.97500002 0 0 0 0.708984,1.1816406 0.97500002,0.97500002 0 0 0 1.181641,-0.7089844 c 0,0 0.475193,-1.8230502 -0.449219,-3.671875 -0.924412,-1.84882471 -3.279432,-3.5390624 -7.9960936,-3.5390625 z" />\n      <path\n         d="m 8.5683594,0.92578125 c -1.5812484,0 -2.7260935,0.18926555 -3.5957032,0.53710935 -0.8696096,0.3478439 -1.4735685,0.8944027 -1.7773437,1.5019532 -0.6075505,1.2151009 0,2.3710937 0,2.3710937 A 0.97500002,0.97500002 0 0 0 4.5039062,5.7714844 0.97500002,0.97500002 0 0 0 4.9394531,4.4648437 c 0,0 -0.1424488,-0.3440086 0,-0.6289062 0.071224,-0.1424488 0.2192204,-0.3478444 0.7558594,-0.5625 C 6.2319515,3.0587819 7.1496108,2.875 8.5683594,2.875 c 1.4187484,0 2.3364076,0.1837819 2.8730466,0.3984375 0.536639,0.2146556 0.682682,0.4200512 0.753907,0.5625 0.142448,0.2848976 -1e-6,0.6289062 0,0.6289062 a 0.97500002,0.97500002 0 0 0 0.4375,1.3066407 0.97500002,0.97500002 0 0 0 1.30664,-0.4355469 c 0,0 0.607551,-1.1559928 0,-2.3710937 C 13.635678,2.3572933 13.033672,1.8107345 12.164063,1.4628906 11.294453,1.1150468 10.149608,0.92578125 8.5683594,0.92578125 Z" />\n   </g>\n</svg>\n'}),P=new i.LabIcon({name:"jupytercad:cut-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.8" viewBox="0 0 19.2 12.3" version="1.1" height="12.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.7503905,0.49960916)">\n      <path\n         d="m 6.225,2.6499939 a 5.25,5.25 0 0 0 -5.24999998,5.25 A 5.25,5.25 0 0 0 6.225,13.149994 5.25,5.25 0 0 0 11.410547,8.6441339 5.25,5.25 0 0 1 6.225,3.3999939 5.25,5.25 0 0 1 6.2894531,2.6529239 5.25,5.25 0 0 0 6.225,2.6499939 Z" />\n      <path\n         d="M 6.2246094,1.6757812 C 2.7981888,1.6757813 0,4.47397 0,7.9003906 -6.5265155e-8,11.326811 2.7981887,14.125 6.2246094,14.125 a 0.97509752,0.97509752 0 0 0 0.00195,0 C 9.3113218,14.118272 11.93777,11.836826 12.375,8.7832031 A 0.97509752,0.97509752 0 0 0 11.421875,7.6699219 C 9.0734969,7.6410905 7.2037815,5.7503771 7.1992187,3.4023438 7.2026815,3.2024961 7.2205938,3.0040526 7.2519531,2.8066406 A 0.97509752,0.97509752 0 0 0 6.3398437,1.6796875 c -0.025467,-0.00131 -0.050691,-0.0029 -0.076172,-0.00391 a 0.97509752,0.97509752 0 0 0 -0.039063,0 z M 5.3320312,3.8046875 c 0.191742,2.767078 2.184134,4.9590576 4.8300778,5.5507813 -0.6065615,1.6468932 -2.1170701,2.8155162 -3.9374996,2.8203122 -2.3725635,0 -4.2753907,-1.902827 -4.2753907,-4.2753904 0,-2.0550907 1.4589167,-3.6769146 3.3828125,-4.0957031 z" />\n      <path\n         d="M 11.474609,-2.8242188 C 8.0481887,-2.8242188 5.25,-0.02603001 5.25,3.4003906 5.25,6.8268113 8.0481887,9.625 11.474609,9.625 c 3.426421,0 6.22461,-2.7981887 6.22461,-6.2246094 0,-3.42642061 -2.798189,-6.2246094 -6.22461,-6.2246094 z m 0,1.9492188 c 2.372564,0 4.275391,1.9028272 4.275391,4.2753906 0,2.3725635 -1.902827,4.2753906 -4.275391,4.2753906 -2.3725631,0 -4.2753902,-1.9028271 -4.2753903,-4.2753906 0,-2.3725634 1.9028272,-4.2753906 4.2753903,-4.2753906 z" />\n   </g>\n</svg>\n'}),k=new i.LabIcon({name:"jupytercad:union-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="12.8" viewBox="0 0 19.2 12.3" version="1.1" height="12.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.7503905,0.49960916)">\n      <path\n         d="m 6.225,2.6499939 a 5.25,5.25 0 0 0 -5.24999998,5.25 A 5.25,5.25 0 0 0 6.225,13.149994 5.25,5.25 0 0 0 11.410547,8.6441339 5.25,5.25 0 0 1 6.225,3.3999939 5.25,5.25 0 0 1 6.2894531,2.6529239 5.25,5.25 0 0 0 6.225,2.6499939 Z" />\n      <path\n         d="M 6.2246094,1.6757812 C 2.7981888,1.6757813 0,4.47397 0,7.9003906 -6.5265155e-8,11.326811 2.7981887,14.125 6.2246094,14.125 a 0.97509752,0.97509752 0 0 0 0.00195,0 C 9.3113218,14.118272 11.93777,11.836826 12.375,8.7832031 A 0.97509752,0.97509752 0 0 0 11.421875,7.6699219 C 9.0734969,7.6410905 7.2037815,5.7503771 7.1992187,3.4023438 7.2026815,3.2024961 7.2205938,3.0040526 7.2519531,2.8066406 A 0.97509752,0.97509752 0 0 0 6.3398437,1.6796875 c -0.025467,-0.00131 -0.050691,-0.0029 -0.076172,-0.00391 a 0.97509752,0.97509752 0 0 0 -0.039063,0 z M 5.3320312,3.8046875 c 0.191742,2.767078 2.184134,4.9590576 4.8300778,5.5507813 -0.6065615,1.6468932 -2.1170701,2.8155162 -3.9374996,2.8203122 -2.3725635,0 -4.2753907,-1.902827 -4.2753907,-4.2753904 0,-2.0550907 1.4589167,-3.6769146 3.3828125,-4.0957031 z" />\n      <path\n         d="m 16.725,3.4000001 a 5.25,5.25 0 0 1 -5.25,5.25 5.25,5.25 0 0 1 -5.2499996,-5.25 5.25,5.25 0 0 1 5.2499996,-5.25 5.25,5.25 0 0 1 5.25,5.25 z" />\n      <path\n         d="M 11.474609,-2.8242188 C 8.0481887,-2.8242188 5.25,-0.02603001 5.25,3.4003906 5.25,6.8268113 8.0481887,9.625 11.474609,9.625 c 3.426421,0 6.22461,-2.7981887 6.22461,-6.2246094 0,-3.42642061 -2.798189,-6.2246094 -6.22461,-6.2246094 z m 0,1.9492188 c 2.372564,0 4.275391,1.9028272 4.275391,4.2753906 0,2.3725635 -1.902827,4.2753906 -4.275391,4.2753906 -2.3725631,0 -4.2753902,-1.9028271 -4.2753903,-4.2753906 0,-2.3725634 1.9028272,-4.2753906 4.2753903,-4.2753906 z" />\n   </g>\n</svg>\n'}),O=new i.LabIcon({name:"jupytercad:intersection-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="11.8" viewBox="0 0 17.7 11.8" version="1.1" height="11.8" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(0.7503905,0.4996094)">\n      <path d="m 5.4750003,2.7749937 a 5.25,5.25 0 0 0 5.2499997,5.25 5.25,5.25 0 0 0 -5.2499997,-5.25 z" />\n      <path\n         d="M 5.4746094,1.8007812 A 0.97509752,0.97509752 0 0 0 4.5,2.7753906 C 4.5,6.2018111 7.2981889,8.9999998 10.724609,9 a 0.97509752,0.97509752 0 0 0 0.97461,-0.9746094 c 0,-3.4264205 -2.7981891,-6.2246092 -6.2246096,-6.2246094 z M 6.6953125,3.9941406 C 8.061332,4.4049806 9.0950195,5.4386679 9.5058594,6.8046875 8.1395235,6.3938951 7.1061048,5.3604766 6.6953125,3.9941406 Z" />\n      <path\n         d="M 6.2246094,1.0507812 C 2.7981887,1.0507812 0,3.84897 0,7.2753906 0,10.701811 2.7981887,13.5 6.2246094,13.5 9.65103,13.5 12.449219,10.701811 12.449219,7.2753906 12.449219,3.84897 9.65103,1.0507813 6.2246094,1.0507812 Z M 6.2246094,3 C 8.5971728,3 10.5,4.9028272 10.5,7.2753906 10.5,9.6479541 8.5971728,11.550781 6.2246094,11.550781 3.8520459,11.550781 1.9492187,9.6479541 1.9492187,7.2753906 1.9492188,4.9028272 3.8520459,3 6.2246094,3 Z" />\n      <path\n         d="M 9.9746094,-2.6992188 C 6.5481887,-2.6992188 3.75,0.09896999 3.75,3.5253906 3.75,6.9518113 6.5481887,9.75 9.9746094,9.75 c 3.4264206,0 6.2246096,-2.7981887 6.2246096,-6.2246094 0,-3.42642061 -2.798189,-6.2246094 -6.2246096,-6.2246094 z m 0,1.9492188 C 12.347173,-0.75 14.25,1.1528272 14.25,3.5253906 c 0,2.3725635 -1.902827,4.2753906 -4.2753906,4.2753906 -2.3725635,0 -4.2753907,-1.9028271 -4.2753907,-4.2753906 C 5.6992187,1.1528272 7.6020459,-0.75 9.9746094,-0.75 Z" />\n   </g>\n</svg>\n'}),E=new i.LabIcon({name:"jupytercad:extrusion-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="14.3" viewBox="0 0 21.45 14.3" version="1.1" height="14.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161">\n      <path\n         d="m 6.9746094,6.5996094 a 0.97509752,0.97509752 0 0 0 -0.7792969,0.390625 l -4.5,5.9999996 a 0.97500002,0.97500002 0 0 0 0.011719,0.08399 0.97500002,0.97500002 0 0 0 -0.2070312,0.5 0.97500002,0.97500002 0 0 0 0.3828125,0.730469 0.97500002,0.97500002 0 0 0 0.00781,0.05078 0.97500002,0.97500002 0 0 0 0.3007813,0.07617 0.97500002,0.97500002 0 0 0 0.2832031,0.11914 H 15.974609 a 0.97509752,0.97509752 0 0 0 0.873047,-0.539062 l 3,-6.0000002 A 0.97509752,0.97509752 0 0 0 18.974609,6.5996094 Z m 0.4882812,1.9511719 h 9.9355464 l -2.02539,4.0488277 H 4.4257812 Z" />\n      <path\n         d="M 11.474609,-2.4003906 A 0.97500002,0.97500002 0 0 0 10.5,-1.4257812 V 10.574219 a 0.97500002,0.97500002 0 0 0 0.974609,0.976562 0.97500002,0.97500002 0 0 0 0.97461,-0.976562 V -1.4257812 a 0.97500002,0.97500002 0 0 0 -0.97461,-0.9746094 z" />\n      <path\n         d="m 10.785156,-2.1152344 -1.4999997,1.50000003 a 0.97500002,0.97500002 0 0 0 0,1.37890624 0.97500002,0.97500002 0 0 0 1.3789067,0 l 0.810546,-0.81054687 0.810547,0.81054687 a 0.97500002,0.97500002 0 0 0 1.378907,0 0.97500002,0.97500002 0 0 0 0,-1.37890624 l -1.5,-1.50000003 a 0.97509752,0.97509752 0 0 0 -1.378907,0 z" />\n   </g>\n</svg>\n'}),A=new i.LabIcon({name:"jupytercad:axes-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="14.3" viewBox="0 0 21.45 14.3" version="1.1" height="14.3" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161">\n      <path\n         d="m 10.785156,8.0390625 a 0.97509752,0.97509752 0 0 0 -0.40039,0.083984 L 3.5761719,11.185547 A 0.97500002,0.97500002 0 0 0 3.0859375,12.474609 0.97500002,0.97500002 0 0 0 4.375,12.964844 l 6.619141,-2.9765627 h 8.791015 a 0.97500002,0.97500002 0 0 0 0.97461,-0.9746094 0.97500002,0.97500002 0 0 0 -0.97461,-0.9746094 z" />\n      <path\n         d="M 10.785156,-0.9609375 A 0.97500002,0.97500002 0 0 0 9.8105469,0.01367188 V 9.0136719 a 0.97500002,0.97500002 0 0 0 0.9746091,0.9746094 0.97500002,0.97500002 0 0 0 0.97461,-0.9746094 V 0.01367188 a 0.97500002,0.97500002 0 0 0 -0.97461,-0.97460938 z" />\n      <path\n         d="m 10.095703,-0.67578125 -1.4999999,1.5 a 0.97500002,0.97500002 0 0 0 0,1.37890625 0.97500002,0.97500002 0 0 0 1.3789063,0 L 10.785156,1.3925781 11.595703,2.203125 a 0.97500002,0.97500002 0 0 0 1.378906,0 0.97500002,0.97500002 0 0 0 0,-1.37890625 l -1.5,-1.5 a 0.97509752,0.97509752 0 0 0 -1.378906,0 z" />\n      <path\n         d="m 3.0019531,10.109375 a 0.97500002,0.97500002 0 0 0 -1.1933594,0.689453 l -0.5507812,2.048828 a 0.97509752,0.97509752 0 0 0 0.6894531,1.19336 l 2.0507813,0.548828 A 0.97500002,0.97500002 0 0 0 5.1914062,13.900391 0.97500002,0.97500002 0 0 0 4.5019531,12.707031 L 3.3945313,12.410156 3.6914063,11.302734 A 0.97500002,0.97500002 0 0 0 3.0019531,10.109375 Z " />\n      <path d=" m 17.595703,6.8242187 a 0.97500002,0.97500002 0 0 0 0,1.3789063 l 0.810547,0.8105469 -0.810547,0.8105469 a\n         0.97500002,0.97500002 0 0 0 0,1.3789062 0.97500002,0.97500002 0 0 0 1.378906,0 l 1.5,-1.5 a\n         0.97509752,0.97509752 0 0 0 0,-1.3789062 l -1.5,-1.5000001 a 0.97500002,0.97500002 0 0 0 -1.378906,0 z" />\n   </g>\n</svg>\n'}),I=new i.LabIcon({name:"jupytercad:transform-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   viewBox="0 0 24 24"\n   version="1.1"\n   xmlns="http://www.w3.org/2000/svg">\n<g class="jp-icon3" fill="#616161">\n    <path\n       d="m 11.929682,0.13867534 a 0.90209021,0.90209021 0 0 0 -0.0332,0.005859 0.90209021,0.90209021 0 0 0 -0.103515,0.0214844 0.90209021,0.90209021 0 0 0 -0.107422,0.03125 0.90209021,0.90209021 0 0 0 -0.03125,0.007812 0.90209021,0.90209021 0 0 0 -0.05859,0.0332031 0.90209021,0.90209021 0 0 0 -0.0957,0.0527344 0.90209021,0.90209021 0 0 0 -0.08008,0.0625 0.90209021,0.90209021 0 0 0 -0.05859,0.046875 L 8.6269596,3.1347682 a 0.90200001,0.90200001 0 0 0 0,1.2773438 0.90200001,0.90200001 0 0 0 1.277344,0 L 11.097654,3.2187526 V 7.445316 a 0.90200001,0.90200001 0 0 0 0.90234,0.9023438 0.90200001,0.90200001 0 0 0 0.902344,-0.9023438 V 3.2187535 l 1.193359,1.1933594 a 0.90200001,0.90200001 0 0 0 1.277344,0 0.90200001,0.90200001 0 0 0 0,-1.2773438 L 12.679682,0.44336285 a 0.90209021,0.90209021 0 0 0 -0.04102,-0.0429688 0.90209021,0.90209021 0 0 0 -0.158203,-0.12304688 0.90209021,0.90209021 0 0 0 -0.0078,-0.007813 0.90209021,0.90209021 0 0 0 -0.0098,-0.003906 0.90209021,0.90209021 0 0 0 -0.117162,-0.0605468 0.90209021,0.90209021 0 0 0 -0.03125,-0.007813 0.90209021,0.90209021 0 0 0 -0.107422,-0.03125 0.90209021,0.90209021 0 0 0 -0.103515,-0.0214844 0.90209021,0.90209021 0 0 0 -0.103516,-0.003906 0.90209021,0.90209021 0 0 0 -0.07031,-0.001953 z" />\n    <path\n       d="m 11.929688,23.86132 a 0.90209021,0.90209021 0 0 1 -0.0332,-0.0059 0.90209021,0.90209021 0 0 1 -0.103515,-0.02148 0.90209021,0.90209021 0 0 1 -0.107422,-0.03125 0.90209021,0.90209021 0 0 1 -0.03125,-0.0078 0.90209021,0.90209021 0 0 1 -0.05859,-0.0332 0.90209021,0.90209021 0 0 1 -0.0957,-0.05273 0.90209021,0.90209021 0 0 1 -0.08008,-0.0625 0.90209021,0.90209021 0 0 1 -0.05859,-0.04687 L 8.626953,20.865229 a 0.90200001,0.90200001 0 0 1 0,-1.277344 0.90200001,0.90200001 0 0 1 1.277344,0 l 1.193359,1.193359 V 16.554682 A 0.90200001,0.90200001 0 0 1 12,15.652338 a 0.90200001,0.90200001 0 0 1 0.902344,0.902344 v 4.226562 l 1.193359,-1.193359 a 0.90200001,0.90200001 0 0 1 1.277344,0 0.90200001,0.90200001 0 0 1 0,1.277344 l -2.693359,2.691406 a 0.90209021,0.90209021 0 0 1 -0.04102,0.04297 0.90209021,0.90209021 0 0 1 -0.158203,0.123047 0.90209021,0.90209021 0 0 1 -0.0078,0.0078 0.90209021,0.90209021 0 0 1 -0.0098,0.0039 0.90209021,0.90209021 0 0 1 -0.117162,0.06055 0.90209021,0.90209021 0 0 1 -0.03125,0.0078 0.90209021,0.90209021 0 0 1 -0.107422,0.03125 0.90209021,0.90209021 0 0 1 -0.103515,0.02148 0.90209021,0.90209021 0 0 1 -0.103516,0.0039 0.90209021,0.90209021 0 0 1 -0.07031,0.002 z" />\n    <path\n       d="m 23.861325,11.929682 a 0.90209021,0.90209021 0 0 0 -0.0059,-0.0332 0.90209021,0.90209021 0 0 0 -0.02148,-0.103515 0.90209021,0.90209021 0 0 0 -0.03125,-0.107422 0.90209021,0.90209021 0 0 0 -0.0078,-0.03125 0.90209021,0.90209021 0 0 0 -0.0332,-0.05859 0.90209021,0.90209021 0 0 0 -0.05274,-0.0957 0.90209021,0.90209021 0 0 0 -0.0625,-0.08008 0.90209021,0.90209021 0 0 0 -0.04687,-0.05859 L 20.865232,8.6269596 a 0.90200001,0.90200001 0 0 0 -1.277343,0 0.90200001,0.90200001 0 0 0 0,1.277344 l 1.193359,1.1933504 h -4.226563 a 0.90200001,0.90200001 0 0 0 -0.902344,0.90234 0.90200001,0.90200001 0 0 0 0.902344,0.902344 h 4.226562 l -1.193359,1.193359 a 0.90200001,0.90200001 0 0 0 0,1.277344 0.90200001,0.90200001 0 0 0 1.277343,0 l 2.691407,-2.693359 a 0.90209021,0.90209021 0 0 0 0.04297,-0.04102 0.90209021,0.90209021 0 0 0 0.123046,-0.158203 0.90209021,0.90209021 0 0 0 0.0078,-0.0078 0.90209021,0.90209021 0 0 0 0.0039,-0.0098 0.90209021,0.90209021 0 0 0 0.06055,-0.117162 0.90209021,0.90209021 0 0 0 0.0078,-0.03125 0.90209021,0.90209021 0 0 0 0.03125,-0.107422 0.90209021,0.90209021 0 0 0 0.02149,-0.103515 0.90209021,0.90209021 0 0 0 0.0039,-0.103516 0.90209021,0.90209021 0 0 0 0.002,-0.07031 z" />\n    <path\n       d="m 0.138681,11.929688 a 0.90209021,0.90209021 0 0 1 0.0059,-0.0332 0.90209021,0.90209021 0 0 1 0.02148,-0.103515 0.90209021,0.90209021 0 0 1 0.03125,-0.107422 0.90209021,0.90209021 0 0 1 0.0078,-0.03125 0.90209021,0.90209021 0 0 1 0.0332,-0.05859 0.90209021,0.90209021 0 0 1 0.05273,-0.0957 0.90209021,0.90209021 0 0 1 0.0625,-0.08008 0.90209021,0.90209021 0 0 1 0.04687,-0.05859 L 3.134772,8.6269531 a 0.90200001,0.90200001 0 0 1 1.277344,0 0.90200001,0.90200001 0 0 1 0,1.277344 L 3.218757,11.097656 H 7.445319 A 0.90200001,0.90200001 0 0 1 8.347663,12 0.90200001,0.90200001 0 0 1 7.445319,12.902344 H 3.218757 l 1.193359,1.193359 a 0.90200001,0.90200001 0 0 1 0,1.277344 0.90200001,0.90200001 0 0 1 -1.277344,0 L 0.443366,12.679688 a 0.90209021,0.90209021 0 0 1 -0.04297,-0.04102 0.90209021,0.90209021 0 0 1 -0.123047,-0.158203 0.90209021,0.90209021 0 0 1 -0.0078,-0.0078 0.90209021,0.90209021 0 0 1 -0.0039,-0.0098 0.90209021,0.90209021 0 0 1 -0.06055,-0.117162 0.90209021,0.90209021 0 0 1 -0.0078,-0.03125 A 0.90209021,0.90209021 0 0 1 0.166049,12.207031 0.90209021,0.90209021 0 0 1 0.144569,12.103516 0.90209021,0.90209021 0 0 1 0.140669,12 a 0.90209021,0.90209021 0 0 1 -0.002,-0.07031 z" />\n    <circle\n       cx="12"\n       cy="12"\n       r="1.84375" />\n</g>\n</svg>\n'}),T=new i.LabIcon({name:"jupytercad:explodedView-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="14.3"\n   viewBox="0 0 21.45 14.3"\n   version="1.1"\n   height="14.3"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" transform="translate(1.1166014,0.20859301)">\n    <path\n       d="m 8.1933594,-3.4921875 a 0.92962298,0.92962298 0 0 0 -0.65625,0.2714844 L 4.7070312,-0.390625 a 0.92962298,0.92962298 0 0 0 0.65625,1.5878906 H 11.023438 A 0.92962298,0.92962298 0 0 0 11.681641,0.92382813 L 14.511719,-1.90625 a 0.92962298,0.92962298 0 0 0 -0.65625,-1.5859375 z m 0.3847656,1.859375 h 3.03125 l -0.970703,0.97070313 H 7.6074219 Z"/>\n    <path\n       d="m 8.1933594,12.685547 a 0.92962298,0.92962298 0 0 0 -0.65625,0.273437 l -2.8300782,2.830079 a 0.92962298,0.92962298 0 0 0 0.65625,1.585937 h 5.6601568 a 0.92962298,0.92962298 0 0 0 0.658203,-0.271484 l 2.830078,-2.830078 a 0.92962298,0.92962298 0 0 0 -0.65625,-1.587891 z m 0.3867187,1.859375 h 3.0292969 l -0.970703,0.970703 H 7.609375 Z"/>\n    <path\n       d="M 19.46875,1.8378906 A 0.92962298,0.92962298 0 0 0 18.455078,2.0390625 L 15.625,4.8691406 a 0.92962298,0.92962298 0 0 0 -0.271484,0.65625 V 11.1875 a 0.92962298,0.92962298 0 0 0 1.585937,0.65625 l 2.830078,-2.8300781 a 0.92962298,0.92962298 0 0 0 0.273438,-0.65625 V 2.6953125 A 0.92962298,0.92962298 0 0 0 19.46875,1.8378906 Z M 18.183594,4.9414062 V 7.9707031 L 17.212891,8.9414063 V 5.9121094 Z"/>\n    <path\n       d="M 3.2910156,1.8378906 A 0.92962298,0.92962298 0 0 0 2.2773438,2.0390625 l -2.83007817,2.8300781 a 0.92962298,0.92962298 0 0 0 -0.27343751,0.65625 V 11.1875 a 0.92962298,0.92962298 0 0 0 1.58789063,0.65625 L 3.5917969,9.0136719 a 0.92962298,0.92962298 0 0 0 0.2714844,-0.65625 V 2.6953125 A 0.92962298,0.92962298 0 0 0 3.2910156,1.8378906 Z M 2.0058594,4.9394531 v 3.03125 L 1.0332031,8.9433594 v -3.03125 z"/>\n    <path\n       d="M 8.1933594,1.765625 A 0.92962298,0.92962298 0 0 0 7.2636719,2.6953125 V 5.5253906 A 0.92953002,0.92953002 0 0 0 8.1933594,6.4550781 0.92953002,0.92953002 0 0 0 9.1230469,5.5253906 V 3.625 h 3.8027341 v 3.8027344 h -1.902343 a 0.92953002,0.92953002 0 0 0 -0.929688,0.9296875 0.92953002,0.92953002 0 0 0 0.929688,0.9296875 h 2.832031 A 0.92962298,0.92962298 0 0 0 14.783203,8.3574219 V 2.6953125 A 0.92962298,0.92962298 0 0 0 13.855469,1.765625 Z"/>\n    <path\n       d="M 5.3632812,4.5976562 A 0.92962298,0.92962298 0 0 0 4.4335937,5.5253906 V 11.1875 a 0.92962298,0.92962298 0 0 0 0.9296875,0.929688 H 11.023438 A 0.92962298,0.92962298 0 0 0 11.953125,11.1875 V 5.5253906 A 0.92962298,0.92962298 0 0 0 11.023438,4.5976562 Z M 6.2929687,6.4550781 H 10.09375 V 10.257813 H 6.2929687 Z"/>\n  </g>\n</svg>\n'}),L=new i.LabIcon({name:"jupytercad:clipping-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="14.3"\n   viewBox="0 0 21.45 14.3"\n   version="1.1"\n   height="14.3"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" transform="translate(1.5708563,0.00180506)">\n    <path\n       d="M 4.4522062,2.3786768 A 0.84747641,0.84747641 0 0 0 3.9377998,2.7736083 0.84747641,0.84747641 0 0 0 4.2481031,3.9318526 L 9.400465,6.9071134 v 6.0119176 a 0.84747641,0.84747641 0 0 0 0.846282,0.847942 0.84747641,0.84747641 0 0 0 0.847941,-0.847942 V 6.9502572 L 14.051695,5.2427595 A 0.84747641,0.84747641 0 0 0 14.361999,4.0845152 0.84747641,0.84747641 0 0 0 13.203754,3.7742119 L 10.284912,5.4601377 5.096044,2.463305 A 0.84747641,0.84747641 0 0 0 4.4522062,2.3786768 Z"/>\n    <path\n       d="M 6.8383888,0.95825114 C 5.9528068,1.4414519 5.0840336,1.9586524 4.2099374,2.463305 3.9481221,2.6147686 3.7868664,2.8942785 3.7867966,3.1967492 v 6.4815216 c -5.23e-4,0.3030635 0.160812,0.5833432 0.4231408,0.7351032 l 5.6136686,3.240761 c 0.262333,0.151549 0.585608,0.151549 0.847941,0 0.833237,-0.47774 1.663269,-0.961235 2.490724,-1.448636 0.186078,-1.299547 0.831893,-4.5092316 1.428478,-8.4131553 C 11.790245,2.7022024 6.8839909,0.96881974 6.8383888,0.95825114 Z M 7.0010076,2.8101145 12.702623,4.8843343 11.627347,11.145159 10.246747,11.94166 5.4810192,9.1904149 V 3.686265 Z"/>\n    <path\n       d="M 3.9573209,-3.4506459 C 3.3581223,-3.6901604 2.6896393,-3.322701 2.5691144,-2.6875606 L 0.0182973,11.169197 c -0.09210645,0.483599 0.17069866,0.964784 0.6268023,1.147647 l 13.5465654,5.430192 c 0.599199,0.239514 1.267682,-0.127945 1.388208,-0.763086 L 18.289989,2.7289435 c 0.09211,-0.4836 -0.170699,-0.9647854 -0.626803,-1.1476488 z M 4.3510813,-1.0788387 16.114261,3.1759226 13.797905,15.373214 2.1920163,10.720204 Z"/>\n  </g>\n</svg>\n'}),D=new i.LabIcon({name:"jupytercad:chamfer-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="14.3"\n   viewBox="0 0 21.45 14.3"\n   version="1.1"\n   height="14.3"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161">\n      <path\n         d="M 1.7695312,0.25 A 0.97509752,0.97509752 0 0 0 0.79101562,1.2207031 L 0.74414062,16.126953 A 0.97509752,0.97509752 0 0 0 1.71875,17.105469 l 15.074219,0.02734 a 0.97509752,0.97509752 0 0 0 0.976562,-0.978515 l -0.0332,-7.0566407 A 0.97509752,0.97509752 0 0 0 17.455078,8.4179688 L 9.7226563,0.55859375 A 0.97509752,0.97509752 0 0 0 9.0292969,0.26757813 Z m 0.9687501,1.9511719 5.8789062,0.015625 7.1699215,7.2851562 0.02734,5.6796879 -13.1152342,-0.02539 z"\n         />\n      <path\n         d="m 4.9628906,-2.8339844 a 0.97500002,0.97500002 0 0 0 -0.9804687,0.96875 0.97500002,0.97500002 0 0 0 0.96875,0.9824219 l 7.0117191,0.0429687 6.789062,6.78515625 -0.05078,6.9570315 -2.478516,2.511719 a 0.97500002,0.97500002 0 0 0 0.0078,1.378906 0.97500002,0.97500002 0 0 0 1.378906,-0.0098 l 2.757812,-2.792969 a 0.97509752,0.97509752 0 0 0 0.28125,-0.677734 l 0.05664,-7.7617188 A 0.97509752,0.97509752 0 0 0 20.419922,4.8554687 L 13.058594,-2.5019531 A 0.97509752,0.97509752 0 0 0 12.375,-2.7871094 Z"\n         />\n      <path\n         d="M 4.2441406,-2.5371094 1.125,0.4921875 a 0.97500002,0.97500002 0 0 0 -0.019531,1.3789062 0.97500002,0.97500002 0 0 0 1.3769532,0.019531 l 3.1191406,-3.0292969 a 0.97500002,0.97500002 0 0 0 0.021484,-1.3789062 0.97500002,0.97500002 0 0 0 -1.3789063,-0.019531 z"\n         />\n      <path\n         d="m 12.277344,-2.7636719 a 0.97500002,0.97500002 0 0 0 -0.69336,0.2753906 L 8.4648438,0.54101562 a 0.97500002,0.97500002 0 0 0 -0.019531,1.37890628 0.97500002,0.97500002 0 0 0 1.3789063,0.021484 l 3.1191402,-3.0312499 a 0.97500002,0.97500002 0 0 0 0.01953,-1.3789063 0.97500002,0.97500002 0 0 0 -0.685547,-0.2949219 z"\n         />\n      <path\n         d="m 19.671875,4.9160156 a 0.97500002,0.97500002 0 0 0 -0.693359,0.2773438 l -3.119141,3.0292969 a 0.97500002,0.97500002 0 0 0 -0.01953,1.3789062 0.97500002,0.97500002 0 0 0 1.378906,0.019531 l 3.119141,-3.0292969 a 0.97500002,0.97500002 0 0 0 0.01953,-1.3789063 0.97500002,0.97500002 0 0 0 -0.685547,-0.296875 z"\n         />\n   </g>\n</svg>\n'}),N=new i.LabIcon({name:"jupytercad:fillet-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="14.3"\n   viewBox="0 0 21.45 14.3"\n   version="1.1"\n   height="14.3"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161">\n   <path\n      d="m 5.1523437,0.31640625 c -0.00131,0.001298 -0.00261,0.0026 -0.00391,0.003906 h -3.43359 C 1.1766933,0.32058161 0.74050356,0.75677152 0.74023437,1.2949219 V 16.210937 c 2.6899e-4,0.538151 0.43645883,0.974341 0.97460933,0.97461 H 16.574219 c 0.53815,-2.7e-4 0.97434,-0.43646 0.974609,-0.97461 v -3.527343 c -0.03739,-0.267121 -0.183757,-0.506823 -0.404297,-0.66211 l 0.394531,0.611329 c -0.156559,-3.3353437 -1.57375,-6.5223534 -3.871093,-8.8144536 -6.66e-4,-6.51e-4 -0.0013,-0.0013 -0.002,-0.00195 C 11.381408,1.5548042 8.3211488,0.27858118 5.1738281,0.3203125 c -6.485e-4,8.6e-6 -0.0013,-8.71e-6 -0.00195,0 -0.00674,9.047e-5 -0.012795,-0.004009 -0.019531,-0.003906 z M 5.1816406,2.265625 v 0.00195 c 2.6074513,-0.039706 5.1795204,1.0231917 7.1113284,2.9355469 1.936348,1.9335244 3.16369,4.6841259 3.296875,7.5214841 0.0064,0.564684 0.0065,0.369792 0.0098,0.554688 v 1.957031 H 2.6894531 V 2.2695313 h 2.484375 c 0.00261,-0.00129 0.00521,-0.0026 0.00781,-0.00391 z"\n      />\n   <path\n      d="m 4.8828125,-2.8847656 a 0.97509752,0.97509752 0 0 0 -0.9414062,1.2539062 l 0.00586,0.021484 a 0.97500002,0.97500002 0 0 0 0.9570313,0.62695312 l -0.035156,0.046875 3.4863282,0.0273438 a 0.97509752,0.97509752 0 0 0 0.025391,-0.009766 l -0.00391,0.009766 c 2.6127999,-0.0397866 5.1423829,0.99157809 7.0742189,2.90234373 1.937891,1.9334685 3.173428,4.6957347 3.30664,7.5332032 a 0.97509752,0.97509752 0 0 0 0.002,0.00195 v 3.4746091 a 0.97500002,0.97500002 0 0 0 0.976562,0.976563 0.97500002,0.97500002 0 0 0 0.974609,-0.976563 V 9.4765625 a 0.97509752,0.97509752 0 0 0 -0.03711,-0.050781 l 0.0332,0.00977 C 20.550382,6.0988535 19.127635,2.9055945 16.830078,0.61328125 a 0.97509752,0.97509752 0 0 0 -0.0039,-0.001953 C 14.542021,-1.6498218 11.509562,-2.8972038 8.3691406,-2.8554688 l 0.00195,-0.00195 h -0.013672 c -0.00338,4.85e-5 -0.00639,-0.002 -0.00977,-0.00195 a 0.97509752,0.97509752 0 0 0 -0.00195,0.00195 z"\n      />\n   <path\n      d="m 4.7871094,-2.875 a 0.97500002,0.97500002 0 0 0 -0.6855469,0.296875 l -3.0820313,3.1875 a 0.97500002,0.97500002 0 0 0 0.021484,1.3789062 0.97500002,0.97500002 0 0 0 1.3789063,-0.023437 L 5.5039062,-1.2226562 A 0.97500002,0.97500002 0 0 0 5.4804687,-2.6015625 0.97500002,0.97500002 0 0 0 4.7871094,-2.875 Z"\n      />\n   <path\n      d="m 10.542969,-2.5097656 a 0.97500002,0.97500002 0 0 0 -1.3789065,0.021484 L 6.0820312,0.69921875 A 0.97500002,0.97500002 0 0 0 6.1054687,2.078125 0.97500002,0.97500002 0 0 0 7.4824219,2.0566406 l 3.0839841,-3.1875 a 0.97500002,0.97500002 0 0 0 -0.02344,-1.3789062 z"\n      />\n   <path\n      d="m 19.576172,7.2675781 a 0.97500002,0.97500002 0 0 0 -0.685547,0.296875 l -3.082031,3.1894529 a 0.97500002,0.97500002 0 0 0 0.02344,1.376953 0.97500002,0.97500002 0 0 0 1.376953,-0.02148 l 3.083985,-3.1875 A 0.97500002,0.97500002 0 0 0 20.269531,7.5429687 0.97500002,0.97500002 0 0 0 19.576172,7.2675781 Z"\n      />\n   <path\n      d="m 20.40625,12.310547 a 0.97500002,0.97500002 0 0 0 -1.378906,0.02148 l -3.082031,3.1875 a 0.97500002,0.97500002 0 0 0 0.02344,1.378906 0.97500002,0.97500002 0 0 0 1.376953,-0.02148 l 3.083984,-3.1875 a 0.97500002,0.97500002 0 0 0 -0.02344,-1.378906 z"\n      />\n   </g>\n</svg>\n'}),B=new i.LabIcon({name:"jupytercad:wireframe-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg viewBox="0 0 70.00 70.00" version="1.1" xmlns="http://www.w3.org/2000/svg">\n   <g class="jp-icon3" fill="#616161" transform="translate(-288.655,-258.612)">\n      <path\n         d="m 323.40612,258.6123 a 11.087409,11.087409 0 0 0 -11.08792,11.08793 11.087409,11.087409 0 0 0 0.51313,3.29145 l -6.98471,5.82994 a 11.087409,11.087409 0 0 0 -6.10505,-1.84075 11.087409,11.087409 0 0 0 -11.08702,11.08793 11.087409,11.087409 0 0 0 9.21369,10.91597 l 2.85162,10.20918 a 11.087409,11.087409 0 0 0 -3.791,8.33043 11.087409,11.087409 0 0 0 11.08702,11.08792 11.087409,11.087409 0 0 0 10.45896,-7.44715 l 10.63362,0 a 11.087409,11.087409 0 0 0 10.34946,7.11593 11.087409,11.087409 0 0 0 11.08702,-11.08702 11.087409,11.087409 0 0 0 -4.18558,-8.66346 l 2.65524,-9.50329 a 11.087409,11.087409 0 0 0 9.47342,-10.95851 11.087409,11.087409 0 0 0 -11.08701,-11.08793 11.087409,11.087409 0 0 0 -6.12407,1.85342 l -7.23267,-6.03809 a 11.087409,11.087409 0 0 0 0.44888,-3.09597 11.087409,11.087409 0 0 0 -11.08703,-11.08793 z m 7.32408,19.39302 6.58108,5.49328 a 11.087409,11.087409 0 0 0 -0.99729,4.5702 11.087409,11.087409 0 0 0 6.57746,10.11868 l -2.23171,7.98833 a 11.087409,11.087409 0 0 0 -1.20182,-0.0697 11.087409,11.087409 0 0 0 -10.87345,8.93586 l -9.77659,0 a 11.087409,11.087409 0 0 0 -10.792,-8.60463 11.087409,11.087409 0 0 0 -1.67061,0.13484 l -2.31587,-8.29061 a 11.087409,11.087409 0 0 0 6.8001,-10.21279 11.087409,11.087409 0 0 0 -1.00907,-4.5883 l 6.39827,-5.34215 a 11.087409,11.087409 0 0 0 7.18742,2.6489 11.087409,11.087409 0 0 0 7.32408,-2.78193 z" />\n   </g>\n</svg>\n'}),V=new i.LabIcon({name:"jupytercad:chevron-right-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="19" height="28" viewBox="0 0 19 28">\n  <path\n    d="M17.297 13.703l-11.594 11.594c-0.391 0.391-1.016 0.391-1.406 0l-2.594-2.594c-0.391-0.391-0.391-1.016 0-1.406l8.297-8.297-8.297-8.297c-0.391-0.391-0.391-1.016 0-1.406l2.594-2.594c0.391-0.391 1.016-0.391 1.406 0l11.594 11.594c0.391 0.391 0.391 1.016 0 1.406z">\n  </path>\n</svg>\n'}),R=(e,t=100)=>{let n;return(...o)=>{clearTimeout(n),n=setTimeout((()=>{e(...o)}),t)}};function F(e,t=100){let n,o;return function(...i){const s=+new Date;n&&s<n+t?(clearTimeout(o),o=setTimeout((()=>{n=s,e(...i)}),t)):(n=s,e(...i))}}function W(e,t){for(const n of t)if(n.name===e)return n}function z(e,t,n,o,i){var s;const a=["border-color","box-shadow"];let r;if(t){if(t!==i){U(e,i,a);const n=H(e,t);n&&(n.style.borderColor=null!=o?o:"red",n.style.boxShadow=`inset 0 0 4px ${null!=o?o:"red"}`),r=t}}else if(i){if(U(e,i,a),n){const t=H(e,i);"input"===(null===(s=null==t?void 0:t.tagName)||void 0===s?void 0:s.toLowerCase())&&(t.value=n)}r=void 0}return r}function H(e,t){if(!e||!t)return;const n=document.querySelector(`[data-path="${e}"]`);return n?n.querySelector(`[id$=${t}]`):void 0}function U(e,t,n){if(!e||!t||0===n.length)return;const o=H(e,t);o&&n.forEach((e=>o.style.removeProperty(e)))}function Z(e,t){const n=Math.round(e);return Math.abs(n-e)<t?n:e}function G(e){const t=window.getComputedStyle(document.body).getPropertyValue(e)||"#ffffff";return m.Qh(t).formatHex()}async function q(e="",t={}){const n=p.ServerConnection.makeSettings(),o=h.URLExt.join(n.baseUrl,e);let i;try{i=await p.ServerConnection.makeRequest(o,t,n)}catch(e){throw new p.ServerConnection.NetworkError(e)}let s=await i.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new p.ServerConnection.ResponseError(i,s.message||s);return s}class $ extends o.Dialog{constructor(e){let t;e.cancelButton&&(t=()=>{!0!==e.cancelButton&&!1!==e.cancelButton&&e.cancelButton(),this.resolve(0)});const n=e.context.path,i=e.context.model,a=s.createElement("div",{style:{overflow:"hidden"}},s.createElement(d,{parentType:"dialog",filePath:`${n}::dialog`,sourceData:e.sourceData,schema:e.schema,syncData:e.syncData,cancel:t,syncSelectedField:e.syncSelectedPropField}));let r;null==i||i.clientStateChanged.connect(((e,t)=>{var o,s,a,l,c;const d=null===(o=null==i?void 0:i.localState)||void 0===o?void 0:o.remoteUser;if(d){const e=t.get(d),o=null===(s=null==e?void 0:e.selectedPropField)||void 0===s?void 0:s.id,i=null===(a=null==e?void 0:e.selectedPropField)||void 0===a?void 0:a.value;"dialog"===(null===(l=null==e?void 0:e.selectedPropField)||void 0===l?void 0:l.parentType)&&(r=z(`${n}::dialog`,o,i,null===(c=null==e?void 0:e.user)||void 0===c?void 0:c.color,r))}else r&&(U(`${n}::dialog`,r,["border-color","box-shadow"]),r=void 0)})),super({title:e.title,body:a,buttons:[o.Dialog.cancelButton()]}),this.addClass("jpcad-property-FormDialog")}}var J=n(80185);class Y{constructor(e,t,n){this.center=e,this.radius=t,this.controlPoints=n}export(e=1){return{center:{x:this.center.x/e,y:this.center.y/e},radius:this.radius/e}}}class X{constructor(e,t,n){this.start=e,this.end=t,this.controlPoints=n}export(e=1){return{start:{x:this.start.x/e,y:this.start.y/e},end:{x:this.end.x/e,y:this.end.y/e}}}}class Q{constructor(e,t,n){this.option=n,this._x=e,this._y=t}get position(){return{x:this._x,y:this._y}}export(e=1){return{x:this._x/e,y:this._y/e}}}function K(e,t,n="blue",o=6){e.save(),e.fillStyle=n,e.fillRect(t.x-o/2,t.y-o/2,o,o),e.restore()}function ee(e,t,n,o,i=.5){e.save(),e.lineWidth=i,e.strokeStyle=o,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.setTransform(1,0,0,1,0,0),e.stroke(),e.closePath(),e.restore()}function te(e,t,n,o,i=1){e.save(),e.lineWidth=i,e.strokeStyle=o,e.beginPath(),e.arc(t.x,t.y,n,0,2*Math.PI),e.stroke(),e.closePath(),e.restore()}function ne(e){return s.createElement(i.Button,{className:"jp-Button jp-mod-minimal jp-ToolbarButtonComponent jp-mod-styled "+(e.toggled?"highlight":""),style:{color:"const(--jp-ui-font-color1)"},onClick:e.onClick},e.label.toUpperCase())}function oe(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}class ie{constructor(e){this._points=new Map,this._lines=new Map,this._circles=new Map([]),this._editing={type:null,content:null},this._gridSize=e.gridSize,this._sharedModel=e.sharedModel}get gridSize(){return this._gridSize}get points(){return this._points}get lines(){return this._lines}get circles(){return this._circles}get editing(){return this._editing}startEdit(e,t){this._editing.type=e,this._editing.content=t}updateEdit(e,t){e===this._editing.type&&(this.editing.content=t)}stopEdit(e){var t;if(e){const e=null===(t=this._editing.content)||void 0===t?void 0:t.tempId;if(e)switch(this._editing.type){case"CIRCLE":this.removeCircle(e);break;case"LINE":this.removeLine(e)}}this._editing.type=null,this._editing.content=null}addPoint(e,t){const n=this.getPointByPosition(e);if(n)return n;const o=(0,J.A)();return this._points.set(o,new Q(e.x,e.y,t)),o}removePoint(e){this._points.delete(e)}getPointByPosition(e){for(const[t,n]of this._points.entries())if(oe(n.position,e)<.05*this._gridSize)return t}getPointById(e){return this._points.get(e)}addLine(e,t){const n=(0,J.A)();return this._lines.set(n,new X(e,t)),n}removeLine(e){this._lines.delete(e)}getLineById(e){return this._lines.get(e)}getLineByControlPoint(e){const t=[];for(const[n,o]of this._lines.entries())o.controlPoints&&o.controlPoints.includes(e)&&t.push(n);return t}addCircle(e,t){const n=(0,J.A)();return this._circles.set(n,new Y(e,t)),n}removeCircle(e){this._circles.delete(e)}getCircleById(e){return this._circles.get(e)}getCircleByControlPoint(e){const t=[];for(const[n,o]of this._circles.entries())o.controlPoints&&o.controlPoints.includes(e)&&t.push(n);return t}async save(e,t){var n;if(this._sharedModel)if(this._sharedModel.objectExists(e))(0,o.showErrorMessage)("The object already exists","There is an existing object with the same name.");else{const o=[];this._circles.forEach((e=>{o.push(this._writeCircle(e.export(this._gridSize),t))})),this._lines.forEach((e=>{o.push(this._writeLine(e.export(this._gridSize),t))}));const i={shape:"Sketcher::SketchObject",name:e,visible:!0,parameters:{Geometry:o,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0},AttachmentOffset:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}};null===(n=this._sharedModel)||void 0===n||n.addObject(i)}}_writeLine(e,t){let n=0,o=0,i=0,s=0,a=0,r=0;return"XY"===t?(n=e.start.x,o=e.start.y,s=e.end.x,a=e.end.y):"YZ"===t?(o=e.start.x,i=e.start.y,a=e.end.x,r=e.end.y):(i=e.start.x,n=e.start.y,r=e.end.x,s=e.end.y),{TypeId:"Part::GeomLineSegment",StartX:n,StartY:o,StartZ:i,EndX:s,EndY:a,EndZ:r}}_writeCircle(e,t){let n,o,i,s=0,a=0,r=0;return"XY"===t?(n=e.center.x,o=e.center.y,i=0,r=1):"YZ"===t?(n=0,o=e.center.x,i=e.center.y,s=1):(n=e.center.y,o=0,i=e.center.x,a=1),{TypeId:"Part::GeomCircle",CenterX:n,CenterY:o,CenterZ:i,NormalX:s,NormalY:a,NormalZ:r,Radius:e.radius,AngleXU:0}}}class se{constructor(e,t){this.ctx=e,this.gridSize=t,this.x=0,this.y=0,this.scale=1}apply(){this.ctx.setTransform(this.scale,0,0,this.scale,this.x,this.y)}scaleAt(e,t,n){this.scale*=n,this.x=e-(e-this.x)*n,this.y=t-(t-this.y)*n}toWorld(e,t=!1,n=.1){const o=1/this.scale;let i=(e.x-this.x)*o,s=(e.y-this.y)*o;return t&&(i=Z(i/this.gridSize,n)*this.gridSize,s=Z(s/this.gridSize,n)*this.gridSize),{x:i,y:s}}toScreen(e){return{x:e.x*this.scale+this.x,y:e.y*this.scale+this.y}}}class ae extends s.Component{constructor(e){super(e),this.handleMouseMove=e=>{const t=this.props.model,n=this.globalToLocalPos({x:e.pageX,y:e.pageY}),o=this.screenToWorldPos(n);switch(this.state.mode){case"LINE":if("LINE"===t.editing.type){const e=t.editing.content.startPoint,n=t.editing.content.tempId,i=t.getPointById(e);if(i){n&&t.removeLine(n);const e=t.addLine(i.position,o);t.updateEdit("LINE",Object.assign(Object.assign({},t.editing.content),{tempId:e}))}}break;case"CIRCLE":if("CIRCLE"===t.editing.type){const e=t.editing.content.centerId,n=t.editing.content.tempId,i=t.getPointById(e);if(i){n&&t.removeCircle(n);const e=oe(o,i.position),s=t.addCircle(i.position,e);t.updateEdit("CIRCLE",Object.assign(Object.assign({},t.editing.content),{tempId:s}))}}}},this.handleRightClick=e=>{if(2!==e.button)return;const t=this.props.model;if(this.state.mode)t.stopEdit(!0),this.setState((e=>Object.assign(Object.assign({},e),{mode:void 0})));else{const n=this.globalToLocalPos({x:e.pageX,y:e.pageY}),o=this.screenToWorldPos(n),i=t.getPointByPosition(o);i&&(t.getLineByControlPoint(i).forEach((e=>t.removeLine(e))),t.getCircleByControlPoint(i).forEach((e=>{var n;const o=t.getCircleById(e);null===(n=null==o?void 0:o.controlPoints)||void 0===n||n.forEach((e=>t.removePoint(e))),t.removeCircle(e)})),t.removePoint(i))}},this.handleLeftClick=e=>{if(!this.ctx)return;const{model:t}=this.props,n=this.globalToLocalPos({x:e.pageX,y:e.pageY}),o=this.screenToWorldPos(n);switch(this.state.mode){case"LINE":if("LINE"===t.editing.type){t.addPoint(o,{color:"#ffffff00"});const e=t.editing.content.tempId,n=t.getLineById(e),i={x:(n.start.x+n.end.x)/2,y:(n.start.y+n.end.y)/2},s=t.addPoint(i,{color:"red"});n.controlPoints=[s],t.stopEdit()}else{const e=t.addPoint(o,{color:"#ffffff00"});t.startEdit("LINE",{startPoint:e})}break;case"CIRCLE":if("CIRCLE"===t.editing.type){const e=t.editing.content.centerId,n=t.editing.content.tempId,i=t.getCircleById(n),s=t.addPoint(o,{color:"red"});i.controlPoints=[s,e],t.stopEdit()}else{const e=t.addPoint(o,{color:"red"});t.startEdit("CIRCLE",{centerId:e,radius:0})}break;case"POINT":t.addPoint(o)}},this.mousePanAnZoom=e=>{if(!this._canvasRef.current)return;const t=this.globalToLocalPos({x:e.pageX,y:e.pageY});this._mouse.x=t.x,this._mouse.y=t.y,this._mouse.button="mousedown"===e.type&&2===e.button||"mouseup"!==e.type&&this._mouse.button,"wheel"===e.type&&(this._mouse.wheel+=-e.deltaY,e.preventDefault());const n=this.screenToWorldPos(this._mouse);n&&this.setState((e=>Object.assign(Object.assign({},e),{currentPointer:{x:parseFloat((n.x/this._gridSize).toFixed(2)),y:parseFloat((n.y/this._gridSize).toFixed(2))}})))},this.drawGrid=(e=128)=>{if(!this._canvasRef.current)return;const t=this._panZoom,n=this._canvasRef.current,o=n.getContext("2d"),i=n.width,s=n.height,a=e;let r=Math.max(i,s)/t.scale+2*a;this._topLeft=t.toWorld({x:0,y:0});const l=Math.floor(this._topLeft.x/a)*a,c=Math.floor(this._topLeft.y/a)*a;r/a>this._gridLimit&&(r=a*this._gridLimit),t.apply(),o.lineWidth=.5,o.strokeStyle="#ccc",o.beginPath();for(let e=0;e<r;e+=a)o.moveTo(l+e,c),o.lineTo(l+e,c+r),o.moveTo(l,c+e),o.lineTo(l+r,c+e);o.setTransform(1,0,0,1,0,0),o.stroke(),o.closePath(),this.drawCenter(r)},this.drawCenter=e=>{const t=this._panZoom,n=this._canvasRef.current.getContext("2d"),o=t.toScreen({x:0,y:0});n.lineWidth=1,n.strokeStyle="#000",n.beginPath(),n.moveTo(o.x,o.y),n.lineTo(o.x,o.y+e),n.moveTo(o.x,o.y),n.lineTo(o.x,o.y-e),n.moveTo(o.x,o.y),n.lineTo(o.x+e,o.y),n.moveTo(o.x,o.y),n.lineTo(o.x-e,o.y),n.stroke(),n.setTransform(1,0,0,1,0,0),n.closePath()},this.drawPointer=(e,t)=>{const n=this._panZoom,o=this._canvasRef.current,i=o.getContext("2d"),s=this.screenToWorldPos({x:e,y:t});n.apply(),i.lineWidth=.5,i.strokeStyle="#000",i.beginPath(),i.moveTo(s.x-2/n.scale*o.width,s.y),i.lineTo(s.x+2/n.scale*o.width,s.y),i.moveTo(s.x,s.y-2/n.scale*o.height),i.lineTo(s.x,s.y+2/n.scale*o.height),i.setTransform(1,0,0,1,0,0),i.stroke(),i.closePath(),K(i,n.toScreen(s),"crimson")},this.draw=()=>{const e=this.ctx;if(!e)return;const{model:t}=this.props,n=this._panZoom;t.points.forEach(((t,o)=>{var i;const s=n.toScreen(t.position),a=null===(i=t.option)||void 0===i?void 0:i.color;K(e,s,a)})),t.lines.forEach((t=>{const o=n.toScreen(t.start),i=n.toScreen(t.end);ee(e,o,i,"blue",1)})),t.circles.forEach((t=>{const{center:o}=t,i={x:o.x+t.radius,y:o.y},s=n.toScreen(o),a=oe(s,n.toScreen(i));te(e,s,a,"blue",1)}))},this.update=()=>{const e=this._canvasRef.current,t=this._divRef.current,n=null==e?void 0:e.getContext("2d");if(!e||!n||!t)return;const o=this._mouse,i=this._panZoom;n.setTransform(1,0,0,1,0,0),n.globalAlpha=1;const s=t.getBoundingClientRect();if(e.width!==s.width||e.height!==s.height-30?(e.height=s.height-30,e.width=s.width):n.clearRect(0,0,e.width,e.height),0!==o.wheel){let e=1;e=o.wheel<0?1/this._scaleRate:this._scaleRate,o.wheel*=.8,Math.abs(o.wheel)<1&&(o.wheel=0),i.scaleAt(o.x,o.y,e)}o.button?o.drag?(i.x+=o.x-o.lastX,i.y+=o.y-o.lastY,o.lastX=o.x,o.lastY=o.y):(o.lastX=o.x,o.lastY=o.y,o.drag=!0):o.drag&&(o.drag=!1),this.drawGrid(this._gridSize),this.drawPointer(o.x,o.y),this.draw(),requestAnimationFrame(this.update)},this.globalToLocalPos=e=>{const t=this._canvasRef.current.getBoundingClientRect();return{x:e.x-t.left-scrollX,y:e.y-t.top-scrollY}},this.screenToWorldPos=e=>{let t=this._panZoom.toWorld(e,!0);const n=this.props.model.getPointByPosition(t);return n&&(t=this.props.model.getPointById(n).position),t},this.toggleMode=e=>()=>{this.state.mode!==e?this.setState((t=>Object.assign(Object.assign({},t),{mode:e}))):this.setState((e=>Object.assign(Object.assign({},e),{mode:void 0})))},this.saveButtonOnClick=async()=>{this.state.sketchName&&(await this.props.model.save(this.state.sketchName,this.state.plane),this.props.closeCallback.handler())},this._mouse={x:0,y:0,button:!1,wheel:0,lastX:0,lastY:0,drag:!1},this._gridLimit=128,this._scaleRate=1.02,this._topLeft={x:0,y:0},this._divRef=s.createRef(),this._canvasRef=s.createRef(),this.state={plane:"XY"},this._gridSize=e.model.gridSize}componentDidMount(){setTimeout((()=>{this.initiateEditor()}),100)}get ctx(){const e=this._canvasRef.current;return e?e.getContext("2d"):null}initiateEditor(){const e=this._divRef.current;if(!e)return;const t=this._canvasRef.current;if(!t)return;const n=e.getBoundingClientRect();(null==n?void 0:n.width)&&(null==n?void 0:n.height)&&(t.height=n.height-30,t.width=n.width),["mousedown","mouseup","mousemove"].forEach((e=>t.addEventListener(e,this.mousePanAnZoom))),t.addEventListener("wheel",this.mousePanAnZoom,{passive:!1}),t.addEventListener("mousedown",this.handleRightClick),t.addEventListener("click",this.handleLeftClick),t.addEventListener("mousemove",this.handleMouseMove);const o=t.getContext("2d");this._panZoom=new se(o,this._gridSize),this._panZoom.x=t.width/2,this._panZoom.y=t.height/2,requestAnimationFrame(this.update)}render(){var e,t;return s.createElement("div",{className:"jpcad-sketcher-Sketcher",ref:this._divRef,style:{overflow:"hidden",width:"100%",height:"100%"}},s.createElement("div",{className:"lm-Widget jp-Toolbar jpcad-sketcher-Sketcher-Toolbar"},s.createElement("div",{className:"jp-HTMLSelect jp-DefaultStyle jp-Notebook-toolbarCellTypeDropdown"},s.createElement("select",{onChange:e=>this.setState((t=>Object.assign(Object.assign({},t),{plane:e.target.value})))},s.createElement("option",{value:"XY"},"XY-plane"),s.createElement("option",{value:"YZ"},"YZ-plane"),s.createElement("option",{value:"ZX"},"ZX-Plane"))),s.createElement("div",{style:{boxShadow:"0 0 3px var(--jp-border-color0) inset",display:"flex"}},["POINT","LINE","CIRCLE"].map((e=>s.createElement(ne,{key:e,label:e,toggled:this.state.mode===e,onClick:this.toggleMode(e)})))),s.createElement("div",{style:{flexGrow:1}}),s.createElement("input",{style:{height:25},className:"jp-mod-styled",type:"text",placeholder:"Sketch name",value:this.state.sketchName,onChange:e=>this.setState((t=>Object.assign(Object.assign({},t),{sketchName:e.target.value})))}),s.createElement(ne,{label:"Save",toggled:!1,onClick:this.saveButtonOnClick}),s.createElement(i.ToolbarButtonComponent,{icon:i.closeIcon,onClick:()=>{this.props.closeCallback.handler()}})),s.createElement("canvas",{className:"jpcad-sketcher-Sketcher-Canvas",ref:this._canvasRef}),s.createElement("div",{className:"jpcad-sketcher-Sketcher-Statusbar"},"X: ",null===(e=this.state.currentPointer)||void 0===e?void 0:e.x," - Y: ",null===(t=this.state.currentPointer)||void 0===t?void 0:t.y))}}class re extends o.Dialog{constructor(e){const t=new ie({gridSize:64,sharedModel:e.sharedModel});super({title:"Sketcher",body:s.createElement(ae,{model:t,closeCallback:e.closeCallback}),buttons:[],hasClose:!1}),this.addClass("jpcad-sketcher-SketcherDialog")}}const le=JSON.parse('[{"command":"jupytercad:undo","keys":["Accel Z"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:redo","keys":["Accel Shift Z"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:removeObject","keys":["Delete"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:wireframe","keys":["Accel Space"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:executeConsole","keys":["Shift Enter"],"selector":".jpcad-console .jp-CodeConsole[data-jp-interaction-mode=\'notebook\'] .jp-CodeConsole-promptCell"},{"command":"jupytercad:invokeConsoleCompleter","keys":["Tab"],"selector":".jpcad-console .jp-CodeConsole-promptCell .jp-mod-completer-enabled"},{"command":"jupytercad:selectConsoleCompleter","keys":["Enter"],"selector":".jpcad-console .jp-ConsolePanel .jp-mod-completer-active"},{"command":"jupytercad:sketch","keys":["Accel Alt N"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:newBox","keys":["Accel Alt B"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:newCylinder","keys":["Accel Alt C"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:newSphere","keys":["Accel Alt S"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:newCone","keys":["Accel Alt E"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:newTorus","keys":["Accel Alt T"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:cut","keys":["Accel Alt X"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:extrusion","keys":["Accel Alt E"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:union","keys":["Accel Alt U"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:intersection","keys":["Accel Alt I"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:chamfer","keys":["Accel Alt H"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:fillet","keys":["Accel Alt F"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:updateAxes","keys":["Alt A"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:updateExplodedView","keys":["Alt E"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:updateCameraSettings","keys":["Accel Alt K"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:updateClipView","keys":["Alt C"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:exportJcad","keys":["Accel Alt X"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:copyObject","keys":["Accel C"],"selector":".data-jcad-keybinding"},{"command":"jupytercad:pasteObject","keys":["Accel V"],"selector":".data-jcad-keybinding"}]');var ce=n(94939),de=n(93798),he=n(38307),pe=n(64790),me=n(60919);ce.LoY.prototype.computeBoundsTree=de.LO,ce.LoY.prototype.disposeBoundsTree=de.je,ce.eaF.prototype.raycast=de.zQ;const ue="--jp-inverse-layout-color4",ge="--jp-inverse-layout-color2",ve="--jp-brand-color0",_e="--jcad-splitview-background",be="selectionBoundingBox",we=new ce.Q1f(G(ue)),ye=new ce.Q1f(G(ge)),fe=new ce.Q1f(G(ve)),Ce=new ce.Q1f(G(_e));function je(e){var t;const n=null===(t=null==e?void 0:e.parameters)||void 0===t?void 0:t.Placement,o=n.Angle,i=n.Axis,s=new ce.Pq0(i[0],i[1],i[2]);s.normalize();const a=o*Math.PI/180/2,r=Math.sin(a);return new ce.PTz(s.x*r,s.y*r,s.z*r,Math.cos(a)).normalize()}function xe(e){var t,n;const{mesh:o,boundingGroup:i,factor:s}=e,a=new ce.Pq0,r=o.parent;i.getCenter(a);const l=new ce.Pq0;null===(t=o.geometry.boundingBox)||void 0===t||t.getCenter(l);const c=je(r.userData.jcObject),d=null===(n=r.userData.jcObject.parameters)||void 0===n?void 0:n.Placement.Position,h=new ce.Pq0(d[0],d[1],d[2]);l.applyQuaternion(c).add(h);const p=new ce.Pq0(l.x-a.x,l.y-a.y,l.z-a.z),m=p.length()*s;return p.normalize(),{oldGeometryCenter:l,newGeometryCenter:new ce.Pq0(l.x+m*p.x,l.y+m*p.y,l.z+m*p.z),vector:p,distance:m}}var Se=n(30384);const Me=new i.LabIcon({name:"jupytercad:visibilityIcon",svgstr:u}),Pe=new i.LabIcon({name:"jupytercad:visibilityOffIcon",svgstr:g}),ke={labTheme:{text:{fontSize:"14px",fontFamily:"var(--jp-ui-font-family)",color:"var(--jp-ui-font-color1)",selectedColor:"var(--jp-ui-inverse-font-color1)",hoverColor:"var(--jp-ui-font-color2)"},nodes:{folder:{bgColor:"var(--jp-layout-color1)",selectedBgColor:"var(--jp-layout-color2)",hoverBgColor:"var(--jp-layout-color2)"},leaf:{bgColor:"var(--jp-layout-color1)",selectedBgColor:"var(--jp-layout-color2)",hoverBgColor:"var(--jp-layout-color2)"},icons:{size:"9px",folderColor:"var(--jp-inverse-layout-color3)",leafColor:"var(--jp-inverse-layout-color3)"}}}};class Oe extends i.PanelWithToolbar{constructor(e){super(e),this.title.label="Objects tree";const t=o.ReactWidget.create(s.createElement(Ae,{cpModel:e.controlPanelModel}));this.addWidget(t),this.addClass("jpcad-sidebar-treepanel")}}const Ee=(e,t,n)=>{if(!t)return;const i=t.getDependants(e);let a;a=i.length?s.createElement("div",null,"Removing this object will also result in removing:",s.createElement("ul",null,i.map((e=>s.createElement("li",{key:e},e))))):s.createElement("div",null,"Are you sure?"),(0,o.showDialog)({title:`Removing ${e}`,body:a,buttons:[o.Dialog.okButton(),o.Dialog.cancelButton()]}).then((({button:{accept:n}})=>{if(n){const n=i.concat([e]),o=t.getObjectByName(e);t.transact((()=>{var e;null===(e=null==o?void 0:o.dependencies)||void 0===e||e.forEach((e=>{De(t,e,!0)})),t.removeObjects(n)}))}})),n()};class Ae extends s.Component{constructor(e){var t,n;super(e),this.stateToTree=()=>this.state.jcadObject?this.state.jcadObject.map((e=>{var t;const n=e.name,o=[];return e.shape&&o.push({id:`${n}#shape#${e.shape}#${this.state.filePath}`,label:"Shape",parentId:n}),e.operators&&o.push({id:`${n}#operator#${this.state.filePath}`,label:"Operators",parentId:n}),{id:n,label:null!==(t=e.name)&&void 0!==t?t:`Object (#${n})`,parentId:null,items:o}})):[],this.handleNodeClick=e=>{var t,n,o;const i=this.getObjectFromName(e);if(i&&!0===i.visible){const s=(null===(n=null===(t=null==i?void 0:i.parameters)||void 0===t?void 0:t.Placement)||void 0===n?void 0:n.Position)||{x:0,y:0,z:0},a=new CustomEvent("jupytercadObjectSelection",{detail:{objectId:e,objPosition:s,mainViewModelId:null===(o=this.props.cpModel.mainViewModel)||void 0===o?void 0:o.id}});window.dispatchEvent(a)}},this._sharedJcadModelChanged=(e,t)=>{if(t.objectChange){const e=this._getCurrentSelection();e?this.setState((t=>{var n,o;return Object.assign(Object.assign({},t),{selectedNodes:e.newSelectedNodes,openNodes:e.newOpenNodes,jcadObject:null===(n=this.props.cpModel.jcadModel)||void 0===n?void 0:n.getAllObject(),options:null===(o=this.props.cpModel.sharedModel)||void 0===o?void 0:o.options})})):this.setState((e=>{var t,n;return Object.assign(Object.assign({},e),{jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),options:null===(n=this.props.cpModel.sharedModel)||void 0===n?void 0:n.options})}))}},this._onClientSharedStateChanged=(e,t)=>{const n=this._getCurrentSelection(t);if(!n)return;const{newSelectedNodes:o,newOpenNodes:i}=n,{selectedNodes:s,openNodes:a}=this.state;JSON.stringify(s)===JSON.stringify(o)&&JSON.stringify(a)===JSON.stringify(i)||this.setState((e=>Object.assign(Object.assign({},e),{openNodes:i,selectedNodes:o})))},this._onClientSharedOptionsChanged=(e,t)=>{this.setState((t=>Object.assign(Object.assign({},t),{options:e.sharedModel.options})))},this._handleRemoveObject=e=>{var t;const n=null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.sharedModel;n&&Ee(e,n,(()=>{var e;null===(e=this.props.cpModel.jcadModel)||void 0===e||e.syncSelected({})}))},this.state={filePath:this.props.cpModel.filePath,jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),selectedNodes:[],clientId:null,id:(0,J.A)(),openNodes:[]},null===(n=this.props.cpModel.jcadModel)||void 0===n||n.sharedObjectsChanged.connect(this._sharedJcadModelChanged),this.props.cpModel.documentChanged.connect(((e,t)=>{if(t){this.props.cpModel.disconnect(this._sharedJcadModelChanged),this.props.cpModel.disconnect(this._onClientSharedStateChanged),t.context.model.sharedObjectsChanged.connect(this._sharedJcadModelChanged),t.context.model.clientStateChanged.connect(this._onClientSharedStateChanged),t.context.model.sharedOptionsChanged.connect(this._onClientSharedOptionsChanged);const e=this._getCurrentSelection();e?this.setState((n=>{var o,i;return Object.assign(Object.assign({},n),{selectedNodes:e.newSelectedNodes,openNodes:e.newOpenNodes,filePath:t.context.localPath,jcadObject:null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.getAllObject(),options:null===(i=this.props.cpModel.sharedModel)||void 0===i?void 0:i.options,clientId:t.context.model.getClientId()})})):this.setState((e=>{var n,o;return Object.assign(Object.assign({},e),{filePath:t.context.localPath,jcadObject:null===(n=this.props.cpModel.jcadModel)||void 0===n?void 0:n.getAllObject(),options:null===(o=this.props.cpModel.sharedModel)||void 0===o?void 0:o.options,clientId:t.context.model.getClientId()})}))}else this.setState({filePath:void 0,jcadObject:void 0,jcadOption:void 0})}))}getObjectFromName(e){if(e&&this.state.jcadObject){const t=this.state.jcadObject.filter((t=>t.name===e));if(t.length>0)return t[0]}}_selectedNodes(e){const t=new Set;for(const n in e){const o=e[n];"shape"===o.type?t.add(n):t.add(o.parent)}return Array.from(t)}_getCurrentSelection(e){var t,n,o;const i=null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.localState;if(!i)return;let s=[];if(e&&i.remoteUser){const t=e.get(i.remoteUser);(null===(n=null==t?void 0:t.selected)||void 0===n?void 0:n.value)&&(s=this._selectedNodes(t.selected.value))}else(null===(o=i.selected)||void 0===o?void 0:o.value)&&(s=this._selectedNodes(i.selected.value));const a=[...this.state.openNodes];for(const e of s)e&&-1===a.indexOf(e)&&a.push(e);return{newSelectedNodes:s,newOpenNodes:a}}render(){const{selectedNodes:e,openNodes:t}=this.state,n=this.stateToTree(),o=[];for(const t of e){const e=n.filter((e=>e.id===t));e.length>0&&e[0].items.length>0&&o.push(e[0].items[0].id)}return s.createElement("div",{className:"jpcad-treeview-wrapper jp-scrollbar-tiny",tabIndex:0},s.createElement(Se.a,{multiSelect:!0,nodes:n,openNodes:t,selectedNodes:o,messages:{noData:"No data"},theme:"labTheme",themes:ke,onToggleSelectedNodes:e=>{var t,n;if(e!==o)if(e&&e.length>0){const n={};for(const t of e){const e=t;e.includes("#")?n[e.split("#")[0]]={type:"shape"}:n[e]={type:"shape"}}null===(t=this.props.cpModel.jcadModel)||void 0===t||t.syncSelected(n,this.state.id)}else null===(n=this.props.cpModel.jcadModel)||void 0===n||n.syncSelected({})},RenderNode:e=>{const t=this.getObjectFromName(e.node.parentId);let n=!0;return t&&(n=t.visible),s.createElement("div",{className:"jpcad-control-panel-tree "+(e.selected?"selected":""),onClick:()=>this.handleNodeClick(e.node.id)},s.createElement("div",{style:{paddingLeft:"5px",minHeight:"20px",display:"flex",alignItems:"center",justifyContent:"space-between",minWidth:0}},s.createElement("span",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflowX:"hidden"}},e.node.label),"leaf"===e.type?s.createElement("div",{style:{display:"flex"}},s.createElement(i.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:()=>{var t;const n=e.node.parentId,o=this.getObjectFromName(n);if(o){const e=null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.sharedModel;e&&e.updateObjectByName(n,{data:{key:"visible",value:!o.visible}})}},icon:n?Me:Pe}),s.createElement(i.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:()=>{const t=e.node.parentId;this._handleRemoveObject(t)},icon:i.closeIcon})):null))}}))}}var Ie=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};function Te(e,t){const n=t.sharedModel;let o=1,i=`${e} 1`;for(;n.objectExists(i);)i=`${e} ${++o}`;return i}async function Le(e){const{jcadContent:t,mainView:n,requestedOperator:i}=e,s=await n.dryRun(t);return"error"===s.status?((0,o.showErrorMessage)(`Failed to apply ${i} operator`,`The ${i} tool was unable to create the desired shape due to invalid parameter values. The values you entered may not be compatible with the dimensions of your piece.`),null):s}function De(e,t,n){e.updateObjectByName(t,{data:{key:"visible",value:n}})}const Ne={box:{title:"Box parameters",shape:"Part::Box",default:e=>({Name:Te("Box",e),Length:1,Width:1,Height:1,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}})},cylinder:{title:"Cylinder parameters",shape:"Part::Cylinder",default:e=>({Name:Te("Cylinder",e),Radius:1,Height:1,Angle:360,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}})},sphere:{title:"Sphere parameters",shape:"Part::Sphere",default:e=>({Name:Te("Sphere",e),Radius:1,Angle1:-90,Angle2:90,Angle3:360,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}})},cone:{title:"Cone parameters",shape:"Part::Cone",default:e=>({Name:Te("Cone",e),Radius1:1,Radius2:.5,Height:1,Angle:360,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}})},torus:{title:"Torus parameters",shape:"Part::Torus",default:e=>({Name:Te("Torus",e),Radius1:1,Radius2:.5,Angle1:-180,Angle2:180,Angle3:360,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}})}};function Be(e,t){if(void 0===e)return"";const n=Object.keys(e);if(n[t]){const o=e[n[t]];return"shape"===o.type?n[t]:o.parent}return""}function Ve(e){if(void 0===e)return;const t=Object.keys(e);for(const n of t)if("edge"===e[n].type)return{shape:e[n].parent,edgeIndex:e[n].edgeIndex}}async function Re(e,t,n,i){var s;const a=n.context.model.sharedModel;if(!a)return;if(a.objectExists(t.name))return void(0,o.showErrorMessage)("The object already exists","There is an existing object with the same name.");const r=n.context.model.getContent(),l=Object.assign(Object.assign({},r),{objects:[...r.objects,t]}),c=await Le({jcadContent:l,mainView:n.content.currentViewModel,requestedOperator:e});if(!c)return;const d=null===(s=c.shapeMetadata)||void 0===s?void 0:s[t.name];d&&(t.shapeMetadata=d),a.transact((()=>{i(a),n.context.model.syncSelected({[t.name]:{type:"shape"}},(0,J.A)())}))}const Fe={cut:{title:"Cut parameters",shape:"Part::Cut",default:e=>{var t,n;const o=e.getAllObject(),i=(null===(t=e.localState)||void 0===t?void 0:t.selected.value)||{},s=Be(i,0),a=Be(i,1),r=s||o[0].name||"",l=e.sharedModel.getObjectByName(r);return{Name:Te("Cut",e),Base:r,Tool:a||o[1].name||"",Refine:!1,Color:(null===(n=null==l?void 0:l.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::Cut",parameters:o,visible:!0,name:n,dependencies:[o.Base,o.Tool]};return Re("Cut",i,e,(e=>{De(e,o.Base,!1),De(e,o.Tool,!1),e.addObject(i)}))}},extrusion:{title:"Extrusion parameters",shape:"Part::Extrusion",default:e=>{var t,n;const o=e.getAllObject(),i=Be((null===(t=e.localState)||void 0===t?void 0:t.selected.value)||{},0)||o[0].name||"",s=e.sharedModel.getObjectByName(i);return{Name:Te("Extrusion",e),Base:i,Dir:[0,0,1],LengthFwd:10,LengthRev:0,Solid:!1,Color:(null===(n=null==s?void 0:s.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::Extrusion",parameters:o,visible:!0,name:n,dependencies:[o.Base]};return Re("Extrusion",i,e,(e=>{De(e,o.Base,!1),e.addObject(i)}))}},union:{title:"Fuse parameters",shape:"Part::MultiFuse",default:e=>{var t,n;const o=e.getAllObject(),i=(null===(t=e.localState)||void 0===t?void 0:t.selected.value)||{},s=Object.keys(i).map((e=>e)),a=s.length>0?s:[o[0].name||"",o[1].name||""],r=e.sharedModel.getObjectByName(a[0]);return{Name:Te("Union",e),Shapes:a,Refine:!1,Color:(null===(n=null==r?void 0:r.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::MultiFuse",parameters:o,visible:!0,name:n,dependencies:o.Shapes};return Re("Fuse",i,e,(e=>{o.Shapes.map((t=>{De(e,t,!1)})),e.addObject(i)}))}},intersection:{title:"Intersection parameters",shape:"Part::MultiCommon",default:e=>{var t,n;const o=e.getAllObject(),i=(null===(t=e.localState)||void 0===t?void 0:t.selected.value)||{},s=Be(i,0),a=Be(i,1),r=s||o[0].name||"",l=e.sharedModel.getObjectByName(r);return{Name:Te("Intersection",e),Shapes:[r,a||o[1].name||""],Refine:!1,Color:(null===(n=null==l?void 0:l.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::MultiCommon",parameters:o,visible:!0,name:n,dependencies:o.Shapes};return Re("Intersection",i,e,(e=>{o.Shapes.map((t=>{De(e,t,!1)})),e.addObject(i)}))}},chamfer:{title:"Chamfer parameters",shape:"Part::Chamfer",default:e=>{var t,n;const o=e.getAllObject(),i=Ve(null===(t=e.localState)||void 0===t?void 0:t.selected.value),s=(null==i?void 0:i.shape)||o[0].name||"",a=e.sharedModel.getObjectByName(s);return{Name:Te("Chamfer",e),Base:s,Edge:(null==i?void 0:i.edgeIndex)||0,Dist:.2,Color:(null===(n=null==a?void 0:a.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::Chamfer",parameters:o,visible:!0,name:n,dependencies:[o.Base]};return Re("Chamfer",i,e,(e=>{De(e,o.Base,!1),e.addObject(i)}))}},fillet:{title:"Fillet parameters",shape:"Part::Fillet",default:e=>{var t,n;const o=e.getAllObject(),i=Ve(null===(t=e.localState)||void 0===t?void 0:t.selected.value),s=(null==i?void 0:i.shape)||o[0].name||"",a=e.sharedModel.getObjectByName(s);return{Name:Te("Fillet",e),Base:s,Edge:(null==i?void 0:i.edgeIndex)||0,Radius:.2,Color:(null===(n=null==a?void 0:a.parameters)||void 0===n?void 0:n.Color)||we,Placement:{Position:[0,0,0],Axis:[0,0,1],Angle:0}}},syncData:e=>async t=>{const{Name:n}=t,o=Ie(t,["Name"]),i={shape:"Part::Fillet",parameters:o,visible:!0,name:n,dependencies:[o.Base]};return Re("Fillet",i,e,(e=>{De(e,o.Base,!1),e.addObject(i)}))}}},We={title:"Axes Helper",schema:{type:"object",required:["Size","Visible"],additionalProperties:!1,properties:{Size:{type:"number",description:"Size of the axes"},Visible:{type:"boolean",description:"Whether the axes are visible or not"}}},default:e=>{var t,n,o,i;return{Size:null!==(n=null===(t=e.axes)||void 0===t?void 0:t.size)&&void 0!==n?n:5,Visible:null===(i=null===(o=e.axes)||void 0===o?void 0:o.visible)||void 0===i||i}},syncData:e=>t=>{const{Size:n,Visible:o}=t;e.axes={size:n,visible:o}}},ze={title:"Exploded View Settings",schema:{type:"object",required:["Enabled","Factor"],additionalProperties:!1,properties:{Enabled:{type:"boolean",description:"Whether the exploded view is enabled or not"},Factor:{type:"number",description:"The exploded view factor"}}},default:e=>{var t,n,o,i;return{Enabled:null!==(n=null===(t=e.explodedView)||void 0===t?void 0:t.enabled)&&void 0!==n&&n,Factor:null!==(i=null===(o=e.explodedView)||void 0===o?void 0:o.factor)&&void 0!==i?i:.5}},syncData:e=>t=>{const{Enabled:n,Factor:o}=t;e.explodedView={enabled:n,factor:o}}},He={title:"Camera Settings",schema:{type:"object",required:["Type"],additionalProperties:!1,properties:{Type:{title:"Projection",description:"The projection type",type:"string",enum:["Perspective","Orthographic"]}}},default:e=>{var t,n;return{Type:null!==(n=null===(t=e.cameraSettings)||void 0===t?void 0:t.type)&&void 0!==n?n:"Perspective"}},syncData:e=>t=>{const{Type:n}=t;e.cameraSettings={type:n}}},Ue={title:"Export to .jcad",schema:{type:"object",required:["Name"],additionalProperties:!1,properties:{Name:{title:"File name",description:"The exported file name",type:"string"}}},default:e=>({Name:h.PathExt.basename(e.path).replace(h.PathExt.extname(e.path),".jcad")}),syncData:e=>t=>{var n,i;const s=null===(i=null===(n=e.model)||void 0===n?void 0:n.sharedModel)||void 0===i?void 0:i.toJcadEndpoint;if(!s)return void(0,o.showErrorMessage)("Error","Missing endpoint.");const{Name:a}=t;q(s,{method:"POST",body:JSON.stringify({path:e.path,newName:a})})}};function Ze(e){var t;const n=null===(t=e.context.model.sharedModel.awareness.getLocalState())||void 0===t?void 0:t.selected;if(n&&n.value){const e=Object.keys(n.value)[0],t=n.value[e];return"edge"===t.type&&t.parent?t.parent:e}return""}function Ge(e,t,n,o,s,a){s.getWorker;const r=n.load("jupyterlab"),{commands:l}=e;$e.updateFormSchema(o),l.addCommand(qe.toggleConsole,{label:r.__("Toggle console"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:async()=>await $e.toggleConsole(t)}),l.addCommand(qe.executeConsole,{label:r.__("Execute console"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:()=>$e.executeConsole(t)}),l.addCommand(qe.removeConsole,{label:r.__("Remove console"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:()=>$e.removeConsole(t)}),l.addCommand(qe.invokeCompleter,{label:r.__("Display the completion helper."),execute:()=>{var e;const n=t.currentWidget;if(!n||!a)return;const o=null===(e=n.content.consolePanel)||void 0===e?void 0:e.id;return o?a.invoke(o):void 0}}),l.addCommand(qe.selectCompleter,{label:r.__("Select the completion suggestion."),execute:()=>{var e;const n=t.currentWidget;if(!n||!a)return;const o=null===(e=n.content.consolePanel)||void 0===e?void 0:e.id;return o?a.select(o):void 0}}),l.addCommand(qe.redo,{label:r.__("Redo"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:e=>{const n=t.currentWidget;if(n)return n.context.model.sharedModel.redo()},icon:i.redoIcon}),l.addCommand(qe.undo,{label:r.__("Undo"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:e=>{const n=t.currentWidget;if(n)return n.context.model.sharedModel.undo()},icon:i.undoIcon}),l.addCommand(qe.newSketch,{label:r.__("New Sketch"),iconClass:"fa fa-pencil",isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,execute:async e=>{const n=t.currentWidget;if(!n)return;const o={sharedModel:n.context.model.sharedModel,closeCallback:{handler:()=>{}}},i=new re(o);o.closeCallback.handler=()=>i.close(),await i.launch()}}),l.addCommand(qe.removeObject,{label:r.__("Remove Object"),isEnabled:()=>{const e=t.currentWidget;return!!e&&e.context.model.sharedModel.editable},execute:()=>{const e=t.currentWidget;if(!e)return;const n=Ze(e);if(!n)return void console.warn("No object is selected.");const o=e.context.model.sharedModel;Ee(n,o,(()=>o.awareness.setLocalStateField("selected",{})))}}),l.addCommand(qe.newBox,{label:r.__("New Box"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:C,execute:$e.createPart("box",t)}),l.addCommand(qe.newCylinder,{label:r.__("New Cylinder"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:S,execute:$e.createPart("cylinder",t)}),l.addCommand(qe.newSphere,{label:r.__("New Sphere"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:x,execute:$e.createPart("sphere",t)}),l.addCommand(qe.newCone,{label:r.__("New Cone"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:j,execute:$e.createPart("cone",t)}),l.addCommand(qe.newTorus,{label:r.__("New Torus"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:M,execute:$e.createPart("torus",t)}),l.addCommand(qe.extrusion,{label:r.__("Extrusion"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:E,execute:$e.executeOperator("extrusion",t)}),l.addCommand(qe.cut,{label:r.__("Cut"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:P,execute:$e.executeOperator("cut",t)}),l.addCommand(qe.union,{label:r.__("Union"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:k,execute:$e.executeOperator("union",t)}),l.addCommand(qe.intersection,{label:r.__("Intersection"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:O,execute:$e.executeOperator("intersection",t)}),l.addCommand(qe.wireframe,{label:r.__("Toggle Wireframe"),isEnabled:()=>null!==t.currentWidget,isToggled:()=>{var e;const n=null===(e=t.currentWidget)||void 0===e?void 0:e.content;return(null==n?void 0:n.wireframe)||!1},execute:async()=>{var e;const n=null===(e=t.currentWidget)||void 0===e?void 0:e.content;n&&(n.wireframe=!n.wireframe,l.notifyCommandChanged(qe.wireframe))},icon:B}),t.currentChanged.connect((()=>{l.notifyCommandChanged(qe.wireframe)})),l.addCommand(qe.transform,{label:r.__("Toggle Transform Controls"),isEnabled:()=>{if(!t.currentWidget||!t.currentWidget.context.model.sharedModel.editable)return!1;const e=t.currentWidget.content.currentViewModel.viewSettings;return!e.explodedView||!e.explodedView.enabled},isToggled:()=>{var e;const n=null===(e=t.currentWidget)||void 0===e?void 0:e.content;return(null==n?void 0:n.transform)||!1},execute:async()=>{var e;const n=null===(e=t.currentWidget)||void 0===e?void 0:e.content;n&&(n.transform=!n.transform,l.notifyCommandChanged(qe.transform))},icon:I}),t.currentChanged.connect((()=>{l.notifyCommandChanged(qe.transform)})),l.addCommand(qe.chamfer,{label:r.__("Make chamfer"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:D,execute:$e.executeOperator("chamfer",t)}),l.addCommand(qe.fillet,{label:r.__("Make fillet"),isEnabled:()=>!!t.currentWidget&&t.currentWidget.context.model.sharedModel.editable,icon:N,execute:$e.executeOperator("fillet",t)}),l.addCommand(qe.updateAxes,{label:r.__("Axes Helper"),isEnabled:()=>Boolean(t.currentWidget),icon:A,execute:async()=>{const e=t.currentWidget;if(!e)return;const n=new $({context:e.context,title:We.title,schema:We.schema,sourceData:We.default(e.content),syncData:We.syncData(e.content),cancelButton:!0});await n.launch()}}),l.addCommand(qe.updateExplodedView,{label:r.__("Exploded View"),isEnabled:()=>Boolean(t.currentWidget),icon:T,isToggled:()=>{var e;const n=null===(e=t.currentWidget)||void 0===e?void 0:e.content.currentViewModel.viewSettings;return!!(null==n?void 0:n.explodedView)&&n.explodedView.enabled},execute:async()=>{const e=t.currentWidget;if(!e)return;const n=new $({context:e.context,title:ze.title,schema:ze.schema,sourceData:ze.default(e.content),syncData:ze.syncData(e.content),cancelButton:!0});await n.launch(),l.notifyCommandChanged(qe.updateExplodedView),l.notifyCommandChanged(qe.transform)}}),l.addCommand(qe.updateCameraSettings,{label:r.__("Camera Settings"),isEnabled:()=>Boolean(t.currentWidget),iconClass:"fa fa-camera",execute:async()=>{const e=t.currentWidget;if(!e)return;const n=new $({context:e.context,title:He.title,schema:He.schema,sourceData:He.default(e.content),syncData:He.syncData(e.content),cancelButton:!0});await n.launch()}}),l.addCommand(qe.updateClipView,{label:r.__("Clipping"),isEnabled:()=>Boolean(t.currentWidget),isToggled:()=>{var e,n;const o=null===(e=t.currentWidget)||void 0===e?void 0:e.content;return(null===(n=null==o?void 0:o.clipView)||void 0===n?void 0:n.enabled)||!1},icon:L,execute:async()=>{const e=t.currentWidget;if(!e)return;const n=e.content;n.clipView=n.clipView||{enabled:!1,showClipPlane:!0},n.clipView.enabled=!n.clipView.enabled;const{enabled:o,showClipPlane:i}=n.clipView;n.clipView={enabled:o,showClipPlane:i},l.notifyCommandChanged(qe.updateClipView)}}),t.currentChanged.connect((()=>{l.notifyCommandChanged(qe.updateClipView)})),l.addCommand(qe.splitScreen,{label:r.__("Split screen"),isEnabled:()=>Boolean(t.currentWidget),icon:i.filterIcon,execute:async()=>{const e=t.currentWidget;e&&e.content.splitScreen&&(e.content.splitScreen={enabled:!e.content.splitScreen.enabled})}}),l.addCommand(qe.exportJcad,{label:r.__("Export to .jcad"),isEnabled:()=>{var e,n,o,i;return Boolean(null===(i=null===(o=null===(n=null===(e=t.currentWidget)||void 0===e?void 0:e.context)||void 0===n?void 0:n.model)||void 0===o?void 0:o.sharedModel)||void 0===i?void 0:i.toJcadEndpoint)},iconClass:"fa fa-file-export",execute:async()=>{var e,n;const o=t.currentWidget;if(!o)return;const i=new $({context:o.context,title:Ue.title,schema:Ue.schema,sourceData:Ue.default(null===(e=t.currentWidget)||void 0===e?void 0:e.context),syncData:Ue.syncData(null===(n=t.currentWidget)||void 0===n?void 0:n.context),cancelButton:!0});await i.launch()}}),l.addCommand(qe.copyObject,{label:r.__("Copy Object"),isEnabled:()=>{const e=t.currentWidget;return!!e&&e.context.model.sharedModel.editable},execute:()=>{const e=t.currentWidget;if(!e)return;const n=Ze(e),o=e.context.model.sharedModel.getObjectByName(n);o?e.context.model.setCopiedObject(o):console.warn("Could not retrieve object data.")}}),l.addCommand(qe.pasteObject,{label:r.__("Paste Object"),isEnabled:()=>{const e=t.currentWidget,n=null==e?void 0:e.context.model.getCopiedObject(),o=null==e?void 0:e.context.model.sharedModel.editable;return!!(e&&n&&o)},execute:()=>{const e=t.currentWidget;if(!e)return;const n=e.context.model.sharedModel,o=e.context.model.getCopiedObject();if(!o)return void console.error("No object in clipboard to paste.");const i=o,s=i.name||"Unnamed Object";let a=s,r=1;for(;n.objects.some((e=>e.name===a));)a=`${s} Copy${r>1?` ${r}`:""}`,r++;const l=e.context.model,c=Object.assign(Object.assign({},i),{name:a,visible:!0});n.addObject(c),l.syncSelected({[c.name]:{type:"shape"}},(0,J.A)())}}),function(e,t){t.forEach((t=>{e.addKeyBinding({command:t.command,keys:t.keys,selector:t.selector})}))}(l,le)}var qe,$e;!function(e){e.redo="jupytercad:redo",e.undo="jupytercad:undo",e.newSketch="jupytercad:sketch",e.removeObject="jupytercad:removeObject",e.newBox="jupytercad:newBox",e.newCylinder="jupytercad:newCylinder",e.newSphere="jupytercad:newSphere",e.newCone="jupytercad:newCone",e.newTorus="jupytercad:newTorus",e.cut="jupytercad:cut",e.extrusion="jupytercad:extrusion",e.union="jupytercad:union",e.intersection="jupytercad:intersection",e.wireframe="jupytercad:wireframe",e.transform="jupytercad:transform",e.copyObject="jupytercad:copyObject",e.pasteObject="jupytercad:pasteObject",e.chamfer="jupytercad:chamfer",e.fillet="jupytercad:fillet",e.updateAxes="jupytercad:updateAxes",e.updateExplodedView="jupytercad:updateExplodedView",e.updateCameraSettings="jupytercad:updateCameraSettings",e.updateClipView="jupytercad:updateClipView",e.splitScreen="jupytercad:splitScreen",e.exportJcad="jupytercad:exportJcad",e.toggleConsole="jupytercad:toggleConsole",e.invokeCompleter="jupytercad:invokeConsoleCompleter",e.removeConsole="jupytercad:removeConsole",e.executeConsole="jupytercad:executeConsole",e.selectCompleter="jupytercad:selectConsoleCompleter"}(qe||(qe={})),function(e){e.FORM_SCHEMA={},e.updateFormSchema=function(t){Object.keys(e.FORM_SCHEMA).length>0||t.getSchemas().forEach(((t,n)=>{if("Placement of the box"===n)return;const o=e.FORM_SCHEMA[n]=JSON.parse(JSON.stringify(t));o.required=["Name",...o.required],o.properties=Object.assign({Name:{type:"string",description:"The Name of the Object"}},o.properties)}))},e.createPart=function(t,n){return async i=>{const s=n.currentWidget;if(!s)return;const a=Ne[t];s.context.model.syncFormData(a);const r=new $({context:s.context,title:a.title,sourceData:a.default(s.context.model),schema:e.FORM_SCHEMA[a.shape],syncData:async e=>{var t;const{Name:n}=e,i=Ie(e,["Name"]),r={shape:a.shape,parameters:i,visible:!0,name:n},l=s.context.model;if(l){const e=l.sharedModel;if(e.objectExists(r.name))(0,o.showErrorMessage)("The object already exists","There is an existing object with the same name.");else{const n=s.context.model.getContent(),o=Object.assign(Object.assign({},n),{objects:[...n.objects,r]}),i=await Le({jcadContent:o,mainView:s.content.currentViewModel,requestedOperator:a.shape});if(!i)return;const c=null===(t=i.shapeMetadata)||void 0===t?void 0:t[r.name];c&&(r.shapeMetadata=c),e.addObject(r),l.syncSelected({[r.name]:{type:"shape"}},(0,J.A)())}}},cancelButton:()=>{s.context.model.syncFormData(void 0)},syncSelectedPropField:(e,t,n)=>{let o=null;if(e){const t=e.split("_")[0];o=e.substring(t.length)}s.context.model.syncSelectedPropField({id:o,value:t,parentType:n})}});await r.launch()}},e.executeOperator=function(t,n){return async o=>{const i=n.currentWidget;if(!i)return;const s=Fe[t],a=JSON.parse(JSON.stringify(e.FORM_SCHEMA[s.shape])),r=i.context.model.getAllObject().map((e=>e.name));for(const e in a.properties){const t=a.properties[e].fcType;if(t){const n=a.properties[e];switch(t){case"App::PropertyLink":n.enum=r;break;case"App::PropertyLinkList":n.items.enum=r}}}const l=new $({context:i.context,title:s.title,sourceData:s.default(i.context.model),schema:a,syncData:s.syncData(i),cancelButton:!0});await l.launch()}},e.executeConsole=function(e){const t=e.currentWidget;t&&t.content.executeConsole()},e.removeConsole=function(e){const t=e.currentWidget;t&&t.content.removeConsole()},e.toggleConsole=async function(e){const t=e.currentWidget;if(!t)return;const n=t.context.path.split(":");let o="";o=n.length>1?n[1]:n[0],await t.content.toggleConsole(o)}}($e||($e={}));var Je=n(47079),Ye=n(80281),Xe=n(31218),Qe=n(94022),Ke=n(42392),et=n(33760),tt=n(68478);const nt=e=>{var t,n,o;const{self:i,message:a,user:r}=e,l=null!==(t=null==r?void 0:r.color)&&void 0!==t?t:"black",c=null!==(n=null==r?void 0:r.display_name)&&void 0!==n?n:"",d=null!==(o=null==r?void 0:r.initials)&&void 0!==o?o:"";return s.createElement("div",{className:"jcad-Annotation-Message",style:{flexFlow:i?"row":"row-reverse"}},s.createElement("div",{className:"jcad-Annotation-User-Icon",style:{backgroundColor:l},title:c},s.createElement("span",{style:{width:24,textAlign:"center"}},d)),s.createElement("div",{className:"jcad-Annotation-Message-Content"},s.createElement("p",{style:{padding:7,margin:0}},a)))},ot=e=>{const{itemId:t,model:n}=e,o=n.getAnnotation(t),a=s.useMemo((()=>{var e;return null!==(e=null==o?void 0:o.contents)&&void 0!==e?e:[]}),[o]),[r,l]=s.useState("");if(!o)return s.createElement("div",null);const c=()=>{n.addContent(t,r),l("")};return s.createElement("div",{className:"jcad-Annotation"},e.children,s.createElement("div",{style:{paddingBottom:10,maxHeight:400,overflow:"auto"}},a.map((e=>{var t,o;return s.createElement(nt,{user:e.user,message:e.value,self:(null===(t=n.user)||void 0===t?void 0:t.username)===(null===(o=e.user)||void 0===o?void 0:o.username)})}))),s.createElement("div",{className:"jcad-Annotation-Message"},s.createElement("textarea",{rows:3,placeholder:"Ctrl+Enter to submit",value:r,onChange:e=>l(e.currentTarget.value),onKeyDown:e=>{e.ctrlKey&&"Enter"===e.key&&c()}}),s.createElement("div",{onClick:c},s.createElement(i.caretRightIcon.react,{className:"jcad-Annotation-Submit"}))))},it=e=>{const{itemId:t,model:n}=e,[a,r]=s.useState(e.open),l=e=>{var o;return e?r(!0):(null===(o=n.getAnnotation(t))||void 0===o?void 0:o.contents.length)?void r(!1):n.removeAnnotation(t)};return s.createElement("div",null,s.createElement("div",{className:"jcad-Annotation-Handler",onClick:()=>l(!a)}),s.createElement("div",{className:"jcad-FloatingAnnotation",style:{visibility:a?"visible":"hidden"}},s.createElement(ot,{model:n,itemId:t},s.createElement("div",{className:"jcad-Annotation-Topbar"},s.createElement("div",{onClick:async()=>{var e;if(!(null===(e=n.getAnnotation(t))||void 0===e?void 0:e.contents.length))return n.removeAnnotation(t);(await(0,o.showDialog)({title:"Delete Annotation",body:"Are you sure you want to delete this annotation?",buttons:[o.Dialog.cancelButton(),o.Dialog.okButton({label:"Delete"})]})).button.accept&&n.removeAnnotation(t)}},s.createElement(i.closeIcon.react,{className:"jcad-Annotation-TopBarIcon"})),s.createElement("div",{onClick:()=>{l(!1)}},s.createElement(f.react,{className:"jcad-Annotation-TopBarIcon"}))))))};function st(e){var t;return(null===(t=e.remoteUser)||void 0===t?void 0:t.display_name)?s.createElement("div",{style:{position:"absolute",top:1,right:3,background:e.remoteUser.color}},`Following ${e.remoteUser.display_name}`):null}function at(e){return s.createElement("div",{className:"jpcad-Spinner",style:{display:e.loading?"flex":"none"}},s.createElement("div",{className:"jpcad-SpinnerContent"}))}const rt=1e-6,lt=1e27;class ct extends s.Component{constructor(e){super(e),this.addContextMenu=()=>{const e=new Je.CommandRegistry;e.addCommand("add-annotation",{execute:()=>{if(!this._pointer3D)return;const e=(new ce.Pq0).copy(this._pointer3D.mesh.position);if(this._explodedView.enabled){const t=xe({mesh:this._pointer3D.mesh,boundingGroup:this._boundingGroup,factor:this._explodedView.factor});e.add(t.vector.multiplyScalar(-t.distance))}this._mainViewModel.addAnnotation({position:[e.x,e.y,e.z],label:"New annotation",contents:[],parent:this._pointer3D.parent.name})},label:"Add annotation",isEnabled:()=>!!this._pointer3D}),this._contextMenu=new Ye.ContextMenu({commands:e}),this._contextMenu.addItem({command:"add-annotation",selector:"canvas",rank:1})},this.sceneSetup=()=>{if(null!==this._divRef.current){we.set(G(ue)),ye.set(G(ge)),fe.set(G(ve)),Ce.set(G(_e)),this._camera=new ce.ubm(50,2,rt,lt),this._camera.position.set(8,8,8),this._camera.up.set(0,0,1),this._scene=new ce.Z58,this._scene.add(new ce.$p8(16777215,.5)),this._cameraLight=new ce.HiM(16777215,1),this._cameraLight.decay=0,this._camera.add(this._cameraLight),this._scene.add(this._camera),this._renderer=new ce.JeP({alpha:!0,antialias:!0,stencil:!0,logarithmicDepthBuffer:!0}),this._clock=new ce.zD7,this._renderer.autoClear=!1,this._renderer.setClearColor(0,0),this._renderer.setSize(500,500,!1),this._divRef.current.appendChild(this._renderer.domElement),this._syncPointer=F(((e,t)=>{e&&t?this._model.syncPointer({parent:t,x:e.x,y:e.y,z:e.z}):this._model.syncPointer(void 0)}),100),this._renderer.domElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._renderer.domElement.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation(),this._contextMenu.open(e)})),document.addEventListener("keydown",(e=>{this._onKeyDown(e)})),this._controls=new Xe.N(this._camera,this._renderer.domElement),this._controls.target.set(this._scene.position.x,this._scene.position.y,this._scene.position.z),this._controls.enableDamping=!0,this._controls.dampingFactor=.15,this._renderer.domElement.addEventListener("mousedown",(e=>{this._mouseDrag.start.set(e.clientX,e.clientY)})),this._renderer.domElement.addEventListener("mouseup",(e=>{this._mouseDrag.end.set(e.clientX,e.clientY),this._mouseDrag.end.distanceTo(this._mouseDrag.start)<=5&&this._onClick(e)})),this._controls.addEventListener("change",(()=>{this._updateAnnotation()})),this._controls.addEventListener("change",F((()=>{var e;(null===(e=this._model.localState)||void 0===e?void 0:e.remoteUser)||this._model.syncCamera({position:this._camera.position.toArray([]),rotation:[this._camera.rotation.x,this._camera.rotation.y,this._camera.rotation.z],up:this._camera.up.toArray([])},this._mainViewModel.id)}),100)),this._clipPlaneTransformControls=new Qe.ZU(this._camera,this._renderer.domElement),this._clippingPlaneMeshControl=new ce.eaF(new ce.bdM(1,1),new ce.V9B({color:we,opacity:.2,transparent:!0,side:ce.$EB})),this._clippingPlaneMeshControl.visible=!1;const e=new ce.Pq0(0,0,1);this._clippingPlane.coplanarPoint(e),this._clippingPlaneMeshControl.geometry.translate(e.x,e.y,e.z),this._clippingPlaneMeshControl.quaternion.setFromUnitVectors(new ce.Pq0(0,0,1),this._clippingPlane.normal),this._scene.add(this._clippingPlaneMeshControl),this._clipPlaneTransformControls.addEventListener("dragging-changed",(e=>{this._controls.enabled=!e.value})),this._clipPlaneTransformControls.addEventListener("change",(()=>{let e=new ce.Pq0(0,0,1);e=e.applyEuler(this._clippingPlaneMeshControl.rotation);const t=this._refLength?.001*this._refLength:0;this._clippingPlane.setFromNormalAndCoplanarPoint(e,this._clippingPlaneMeshControl.position),this._clippingPlane.translate(e.multiply(new ce.Pq0(t,t,t)))})),this._clipPlaneTransformControls.attach(this._clippingPlaneMeshControl),this._scene.add(this._clipPlaneTransformControls),this._clipPlaneTransformControls.enabled=!1,this._clipPlaneTransformControls.visible=!1,this._transformControls=new Qe.ZU(this._camera,this._renderer.domElement),this._transformControls.addEventListener("dragging-changed",(e=>{this._controls.enabled=!e.value})),this._transformControls.addEventListener("mouseUp",(async()=>{const e=this._selectedMeshes[0],t=e.name,n=new ce.Pq0;e.getWorldPosition(n);const o=new ce.PTz;e.getWorldQuaternion(o);const i=Math.sqrt(1-o.w*o.w);let s;s=i>1e-6?[[o.x/i,o.y/i,o.z/i],2*Math.acos(o.w)*(180/Math.PI)]:[[0,0,1],0];const a=this._model.sharedModel.getObjectByName(t);if(a&&a.parameters&&a.parameters.Placement){const i=[n.x,n.y,n.z];if(!await this._mainViewModel.maybeUpdateObjectParameters(t,Object.assign(Object.assign({},a.parameters),{Placement:Object.assign(Object.assign({},a.parameters.Placement),{Position:i,Axis:s[0],Angle:s[1]})}))&&e.parent){const t=a.parameters.Placement.Position;e.parent.position.copy(new ce.Pq0(0,0,0)),e.parent.applyQuaternion(o.invert()),e.parent.applyQuaternion(je(a)),e.parent.position.copy(new ce.Pq0(t[0],t[1],t[2]))}}})),this._scene.add(this._transformControls),this._transformControls.setMode("translate"),this._transformControls.setSpace("local"),this._transformControls.enabled=!1,this._transformControls.visible=!1,this._createViewHelper()}},this.animate=()=>{var e,t,n;this._requestID=window.requestAnimationFrame(this.animate);const o=this._clock.getDelta();for(const e of this._edgeMaterials)e.resolution.set(this._renderer.domElement.width,this._renderer.domElement.height);null!==this._clippingPlaneMesh&&(this._clippingPlane.coplanarPoint(this._clippingPlaneMesh.position),this._clippingPlaneMesh.lookAt(this._clippingPlaneMesh.position.x-this._clippingPlane.normal.x,this._clippingPlaneMesh.position.y-this._clippingPlane.normal.y,this._clippingPlaneMesh.position.z-this._clippingPlane.normal.z)),this._viewHelper.animating&&this._viewHelper.update(o),this._controls.update(),this._renderer.setRenderTarget(null),this._renderer.clear(),this._sceneL?(this._renderer.setScissor(0,0,this._sliderPos,(null===(e=this._divRef.current)||void 0===e?void 0:e.clientHeight)||0),this._renderer.render(this._sceneL,this._camera),this._renderer.setScissor(this._sliderPos,0,(null===(t=this._divRef.current)||void 0===t?void 0:t.clientWidth)||0,(null===(n=this._divRef.current)||void 0===n?void 0:n.clientHeight)||0),this._renderer.render(this._scene,this._camera)):this._renderer.render(this._scene,this._camera),this._viewHelper.render(this._renderer),this.updateCameraRotation()},this.resizeCanvasToDisplaySize=()=>{null!==this._divRef.current&&(this._renderer.setSize(this._divRef.current.clientWidth,this._divRef.current.clientHeight,!1),this._camera instanceof ce.ubm?this._camera.aspect=this._divRef.current.clientWidth/this._divRef.current.clientHeight:this._camera instanceof ce.qUd&&(this._camera.left=this._divRef.current.clientWidth/-2,this._camera.right=this._divRef.current.clientWidth/2,this._camera.top=this._divRef.current.clientHeight/2,this._camera.bottom=this._divRef.current.clientHeight/-2),this._camera.updateProjectionMatrix())},this.generateScene=()=>{this.sceneSetup(),this.animate(),this.resizeCanvasToDisplaySize()},this._shapeToMesh=e=>{null!==this._meshGroup&&this._scene.remove(this._meshGroup),null!==this._explodedViewLinesHelperGroup&&this._scene.remove(this._explodedViewLinesHelperGroup),null!==this._clippingPlaneMesh&&this._scene.remove(this._clippingPlaneMesh);const t=Object.keys(this._currentSelection||{});this._selectedMeshes=[],this._boundingGroup=new ce.NRn,this._edgeMaterials=[],this._meshGroup=new ce.YJl,Object.entries(e).forEach((([e,n])=>{var o,i,s,a;const r=t.includes(e),l=this._model.sharedModel.getObjectByName(e),c=null===(o=null==l?void 0:l.parameters)||void 0===o?void 0:o.Color,d=this.state.wireframe,h=!("Part::Extrusion"===(null==l?void 0:l.shape)&&!(null===(i=null==l?void 0:l.parameters)||void 0===i?void 0:i.Solid)),p=function(e){var t,n;const{objName:o,data:i,isSolid:s,isWireframe:a,clippingPlanes:r,objColor:l}=e,{faceList:c,edgeList:d,jcObject:h}=i,p=[],m=[],u=(null===(n=null===(t=null==i?void 0:i.jcObject)||void 0===t?void 0:t.parameters)||void 0===n?void 0:n.Placement).Position,g=je(h),v=g.clone().invert();let _=0;if(0===c.length&&0===d.length)return null;for(const e of c){const t=e.vertexCoord.length;for(let n=0;n<t;n+=3){const t=new ce.Pq0(e.vertexCoord[n],e.vertexCoord[n+1],e.vertexCoord[n+2]);t.sub(new ce.Pq0(u[0],u[1],u[2])),t.applyQuaternion(v),p.push(t.x,t.y,t.z)}const n=e.triIndexes.length;for(let t=0;t<n;t+=3)m.push(e.triIndexes[t+0]+_,e.triIndexes[t+1]+_,e.triIndexes[t+2]+_);_+=t/3}const b=l||we,w=h.visible,y=new ce._4j({color:new ce.Q1f(b),wireframe:a,flatShading:!1,clippingPlanes:r,metalness:.5,roughness:.5}),f=new ce.LoY;f.setIndex(m),f.setAttribute("position",new ce.qtW(p,3)),f.computeVertexNormals(),f.computeBoundingBox(),p.length>0&&f.computeBoundsTree();const C=new ce.YJl;if(C.name=`${o}-group`,C.visible=w,C.userData={jcObject:h,type:"shape"},s){const e=new ce.V9B;e.depthWrite=!1,e.depthTest=!1,e.colorWrite=!1,e.stencilWrite=!0,e.stencilFunc=ce.sKt;const t=e.clone();t.side=ce.hsX,t.clippingPlanes=r,t.stencilFail=ce.Ru$,t.stencilZFail=ce.Ru$,t.stencilZPass=ce.Ru$;const n=new ce.eaF(f,t);n.name=`${o}-back`,C.add(n);const i=e.clone();i.side=ce.hB5,i.clippingPlanes=r,i.stencilFail=ce.fJr,i.stencilZFail=ce.fJr,i.stencilZPass=ce.fJr;const s=new ce.eaF(f,i);s.name=`${o}-front`,C.add(s)}else y.side=ce.$EB;const j=new ce.eaF(f,y);j.name=o,j.userData={type:"shape"};let x=0;const S=[];for(const e of d){const t=new pe.G({linewidth:2,color:new ce.Q1f(ye).getHex(),clippingPlanes:r,polygonOffset:!0,polygonOffsetFactor:-5,polygonOffsetUnits:-5}),n=[];for(let t=0;t<e.vertexCoord.length;t+=3){const o=new ce.Pq0(e.vertexCoord[t],e.vertexCoord[t+1],e.vertexCoord[t+2]);o.sub(new ce.Pq0(u[0],u[1],u[2])),o.applyQuaternion(v),n.push(o.x,o.y,o.z)}const i=new he.v;i.setPositions(n);const s=new me.b(i,t);s.name=`edge-${o}-${x}`,s.userData={type:"edge",edgeIndex:x,parent:o},S.push(s),C.add(s),x++}const M=(new ce.NRn).setFromObject(C),P=new ce.Pq0;M.getSize(P);const k=new ce.Pq0;M.getCenter(k);const O=new ce.DXC(new ce.TDQ(new ce.iNn(P.x,P.y,P.z)),new ce.mrM({color:fe,depthTest:!1}));return O.position.copy(k),O.visible=!1,O.name=be,C.add(O),C.add(j),C.applyQuaternion(g),C.position.copy(new ce.Pq0(u[0],u[1],u[2])),{meshGroup:C,mainMesh:j,edgesMeshes:S}}({objName:e,data:n,clippingPlanes:this._clippingPlanes,isSolid:h,isWireframe:d,objColor:c});if(p){const{meshGroup:e,mainMesh:n,edgesMeshes:o}=p;if(e.userData.jcObject.visible&&this._boundingGroup.expandByObject(e),null===(s=n.material)||void 0===s?void 0:s.color){const e=new ce.Q1f(c||we);r||(n.material.color=e),n.userData.originalColor=e.clone()}if(r){const t=null==e?void 0:e.getObjectByName(be);t&&(t.visible=!0),e.userData.jcObject.visible||(e.visible=!0,n.material.opacity=.5,n.material.transparent=!0),this._selectedMeshes.push(n)}o.forEach((e=>{var n;this._edgeMaterials.push(e.material);const o=new ce.Q1f(c),i=.2126*o.r+.7152*o.g+.0722*o.b;let s;if(i>=0&&i<=.05)s=new ce.Q1f(.2,.2,.2);else if(i<.1){const e=3+3*(.1-i);s=o.clone().multiplyScalar(e)}else if(i<.5){const e=1.3+1.3*(.5-i);s=o.clone().multiplyScalar(e)}else{const e=.7-.3*(i-.5);s=o.clone().multiplyScalar(e)}t.includes(e.name)?(this._selectedMeshes.push(e),e.material.color=fe,e.material.linewidth=6,e.userData.originalColor=s.clone()):c&&(null===(n=e.material)||void 0===n?void 0:n.color)&&(e.material.color=s,e.material.linewidth=2,e.userData.originalColor=s.clone())})),null===(a=this._meshGroup)||void 0===a||a.add(e)}})),this._updateTransformControls(t),this._updateRefLength(null===this._refLength),this._setupExplodedView();const n=new ce.bdM(1e3*this._refLength,1e3*this._refLength),o=new ce.tXL({color:ye,stencilWrite:!0,stencilRef:0,stencilFunc:ce.klZ,stencilFail:ce.kG0,stencilZFail:ce.kG0,stencilZPass:ce.kG0,side:ce.$EB,wireframe:this.state.wireframe});this._clippingPlaneMesh=new ce.eaF(n,o),this._clippingPlaneMesh.visible=this._clipSettings.enabled,this._clippingPlaneMesh.onAfterRender=e=>{e.clearStencil()},this._scene.add(this._clippingPlaneMesh),this._scene.add(this._meshGroup),this._loadingTimeout&&(clearTimeout(this._loadingTimeout),this._loadingTimeout=null),this.setState((e=>Object.assign(Object.assign({},e),{loading:!1})))},this._onSharedMetadataChanged=(e,t)=>{const n=Object.assign({},this.state.annotations);t.forEach(((e,t)=>{if(!t.startsWith("annotation"))return;const o=this._model.sharedModel.getMetadata(t);let i=!0;if(this.state.firstLoad&&(i=!1),!o||"add"!==e.action&&"update"!==e.action)"delete"===e.action&&delete n[t];else{const e=JSON.parse(o);e.open=i,n[t]=e}})),this.setState((e=>Object.assign(Object.assign({},e),{annotations:n,firstLoad:!1})))},this._onClientSharedStateChanged=(e,t)=>{var n,o,i,s,a,r,l;const c=null===(n=this._model.localState)||void 0===n?void 0:n.remoteUser;if(c){const e=t.get(c);if(!e)return;(null===(o=e.user)||void 0===o?void 0:o.username)!==(null===(i=this.state.remoteUser)||void 0===i?void 0:i.username)&&this.setState((t=>Object.assign(Object.assign({},t),{remoteUser:e.user}))),(null===(s=e.selected)||void 0===s?void 0:s.value)&&this._updateSelected(e.selected.value);const n=e.camera;if(null==n?void 0:n.value){const{position:e,rotation:t,up:o}=n.value;this._camera.position.set(e[0],e[1],e[2]),this._camera.rotation.set(t[0],t[1],t[2]),this._camera.up.set(o[0],o[1],o[2])}}else{if(null!==this.state.remoteUser){this.setState((e=>Object.assign(Object.assign({},e),{remoteUser:null})));const e=null===(r=null===(a=this._model.localState)||void 0===a?void 0:a.camera)||void 0===r?void 0:r.value;if(e){const t=e.position,n=e.rotation,o=e.up;this._camera.position.set(t[0],t[1],t[2]),this._camera.rotation.set(n[0],n[1],n[2]),this._camera.up.set(o[0],o[1],o[2])}}const e=this._model.localState;(null===(l=null==e?void 0:e.selected)||void 0===l?void 0:l.value)&&this._updateSelected(e.selected.value)}t.forEach(((e,t)=>{var n,o;const i=null===(n=e.pointer)||void 0===n?void 0:n.value;if(this._model.getClientId()===t)return;let s=this._collaboratorPointers[t];if(i){const n=null===(o=this._meshGroup)||void 0===o?void 0:o.getObjectByName(i.parent);if(!s){const o=this._createPointer(e.user);s=this._collaboratorPointers[t]={mesh:o,parent:n},this._scene.add(o)}if(s.mesh.visible=!0,this._explodedView.enabled){const e=xe({mesh:n,boundingGroup:this._boundingGroup,factor:this._explodedView.factor}),t=e.vector.multiplyScalar(e.distance);s.mesh.position.copy(new ce.Pq0(i.x+t.x,i.y+t.y,i.z+t.z))}else s.mesh.position.copy(new ce.Pq0(i.x,i.y,i.z));s.parent=n}else this._collaboratorPointers[t]&&(this._collaboratorPointers[t].mesh.visible=!1)}))},this._handleThemeChange=()=>{we.set(G(ue)),ye.set(G(ge)),fe.set(G(ve)),Ce.set(G(_e)),this._clippingPlaneMeshControl.material.color=we},this._handleWindowResize=()=>{this.resizeCanvasToDisplaySize(),this._updateAnnotation()},this._handleSnapChange=e=>{const t=parseFloat(e.target.value);!isNaN(t)&&t>0&&this.setState({rotationSnapValue:t})},this._divRef=s.createRef(),this._mainViewRef=s.createRef(),this._selectedMeshes=[],this._meshGroup=null,this._boundingGroup=new ce.NRn,this._explodedView={enabled:!1,factor:0},this._explodedViewLinesHelperGroup=null,this._cameraSettings={type:"Perspective"},this._clipSettings={enabled:!1,showClipPlane:!0},this._clippingPlaneMesh=null,this._clippingPlane=new ce.Zcv(new ce.Pq0(-1,0,0),0),this._clippingPlanes=[this._clippingPlane],this._edgeMaterials=[],this._currentSelection=null,this._raycaster=new ce.tBo,this._requestID=null,this._refLength=null,this._mouseDrag={start:new ce.I9Y,end:new ce.I9Y},this._pointer3D=null,this._targetPosition=null,this._viewHelperDiv=null,this._sliderPos=0,this._slideInit=!1,this._sceneL=void 0,this._geometry=new ce.LoY,this._geometry.setDrawRange(0,3e4),this._mainViewModel=this.props.viewModel,this._mainViewModel.viewSettingChanged.connect(this._onViewChanged,this),this._model=this._mainViewModel.jcadModel,this._pointer=new ce.I9Y,this._collaboratorPointers={},this._model.themeChanged.connect(this._handleThemeChange,this),this._mainViewModel.jcadModel.sharedOptionsChanged.connect(this._onSharedOptionsChanged,this),this._mainViewModel.jcadModel.clientStateChanged.connect(this._onClientSharedStateChanged,this),this._mainViewModel.jcadModel.sharedMetadataChanged.connect(this._onSharedMetadataChanged,this),this._mainViewModel.renderSignal.connect(this._requestRender,this),this._mainViewModel.workerBusy.connect(this._workerBusyHandler,this),this._raycaster.params.Line2={threshold:50},this.state={id:this._mainViewModel.id,loading:!0,annotations:{},firstLoad:!0,wireframe:!1,transform:!1,clipEnabled:!0,rotationSnapValue:10,transformMode:"translate"}}componentDidMount(){window.addEventListener("resize",this._handleWindowResize),this.generateScene(),this.addContextMenu(),this._mainViewModel.initWorker(),this._mainViewModel.initSignal(),window.addEventListener("jupytercadObjectSelection",(e=>{const t=e;t.detail.mainViewModelId===this._mainViewModel.id&&this.lookAtPosition(t.detail.objPosition)})),this._transformControls.rotationSnap=ce.cj9.degToRad(this.state.rotationSnapValue),this._keyDownHandler=e=>{if("r"===e.key){const e=this._transformControls.mode||"translate";this.state.transformMode!==e&&this.setState({transformMode:e})}},document.addEventListener("keydown",this._keyDownHandler)}componentDidUpdate(e,t){this.resizeCanvasToDisplaySize(),t.rotationSnapValue!==this.state.rotationSnapValue&&(this._transformControls.rotationSnap=ce.cj9.degToRad(this.state.rotationSnapValue))}componentWillUnmount(){window.cancelAnimationFrame(this._requestID),window.removeEventListener("resize",this._handleWindowResize),this._mainViewModel.viewSettingChanged.disconnect(this._onViewChanged,this),this._controls.dispose(),this._model.themeChanged.disconnect(this._handleThemeChange,this),this._model.sharedOptionsChanged.disconnect(this._onSharedOptionsChanged,this),this._mainViewModel.jcadModel.clientStateChanged.disconnect(this._onClientSharedStateChanged,this),this._mainViewModel.jcadModel.sharedMetadataChanged.disconnect(this._onSharedMetadataChanged,this),this._mainViewModel.renderSignal.disconnect(this._requestRender,this),this._mainViewModel.workerBusy.disconnect(this._workerBusyHandler,this),this._mainViewModel.dispose(),document.removeEventListener("keydown",this._keyDownHandler)}_createViewHelper(){var e,t;this._viewHelperDiv&&(null===(e=this._divRef.current)||void 0===e?void 0:e.contains(this._viewHelperDiv))&&this._divRef.current.removeChild(this._viewHelperDiv),this._viewHelper=new tt.s(this._camera,this._renderer.domElement),this._viewHelper.center=this._controls.target,this._viewHelper.setLabels("X","Y","Z");const n=document.createElement("div");n.style.position="absolute",n.style.right="0px",n.style.bottom="0px",n.style.height="128px",n.style.width="128px",this._viewHelperDiv=n,null===(t=this._divRef.current)||void 0===t||t.appendChild(this._viewHelperDiv),this._viewHelperDiv.addEventListener("pointerup",(e=>this._viewHelper.handleClick(e)))}lookAtPosition(e){this._targetPosition=new ce.Pq0(e[0],e[1],e[2])}updateCameraRotation(){if(this._targetPosition&&this._camera&&this._controls){const e=this._controls.target.clone(),t=.1;e.lerp(this._targetPosition,t),this._controls.target.copy(e),e.distanceTo(this._targetPosition)<.01&&(this._targetPosition=null),this._controls.update()}}_updateAnnotation(){Object.keys(this.state.annotations).forEach((e=>{var t;const n=document.getElementById(e);if(n){const o=null===(t=this._model.annotationModel)||void 0===t?void 0:t.getAnnotation(e);let i=new ce.I9Y;o&&(i=this._computeAnnotationPosition(o)),n.style.left=`${Math.round(i.x)}px`,n.style.top=`${Math.round(i.y)}px`}}))}_onPointerMove(e){const t=this._renderer.domElement.getBoundingClientRect();this._pointer.x=(e.clientX-t.left)/t.width*2-1,this._pointer.y=-(e.clientY-t.top)/t.height*2+1;const n=this._pick();if(!this._pointer3D&&this._model.localState&&n&&(this._pointer3D={parent:n.mesh,mesh:this._createPointer(this._model.localState.user)},this._scene.add(this._pointer3D.mesh)),n){if(!this._pointer3D)return void this._syncPointer(void 0,void 0);if(this._pointer3D.mesh.visible=!0,this._pointer3D.mesh.position.copy(n.position),this._pointer3D.parent=n.mesh,this._explodedView.enabled){const e=xe({mesh:this._pointer3D.parent,boundingGroup:this._boundingGroup,factor:this._explodedView.factor});n.position.add(e.vector.multiplyScalar(-e.distance))}this._syncPointer(n.position,n.mesh.name)}else this._pointer3D&&(this._pointer3D.mesh.visible=!1),this._syncPointer(void 0,void 0)}_pick(){var e,t;if(null===this._meshGroup||!this._meshGroup.children)return null;this._raycaster.setFromCamera(this._pointer,this._camera);const n=this._raycaster.intersectObjects(this._meshGroup.children);if(n.length>0)for(const o of n){if(!o.object.visible||!(null===(e=o.object.parent)||void 0===e?void 0:e.visible)||o.object.name===be||this._transformControls.enabled&&o.object.name.startsWith("edge"))continue;const n=new ce.Pq0;if(this._clippingPlane.coplanarPoint(n),n.sub(o.point),this._clipSettings.enabled&&n.dot(this._clippingPlane.normal)>0)continue;let i=o.object;return o.object.name.includes("-front")&&(i=o.object.parent.getObjectByName(o.object.name.replace("-front",""))),o.object.name.includes("-back")&&(i=o.object.parent.getObjectByName(o.object.name.replace("-back",""))),{mesh:i,position:null!==(t=o.pointOnLine)&&void 0!==t?t:o.point}}return null}_onClick(e){var t,n;const o=this._pick(),i=new Set(this._selectedMeshes.map((e=>e.name)));if(o){const s=o.mesh.name;if(e.ctrlKey)i.has(s)?i.delete(s):i.add(s);else{const e=i.has(s);i.clear(),e||i.add(s)}const a=Array.from(i),r={};for(const e of a)r[e]=null===(n=null===(t=this._meshGroup)||void 0===t?void 0:t.getObjectByName(e))||void 0===n?void 0:n.userData;this._updateSelected(r),this._model.syncSelected(r,this._mainViewModel.id)}else this._updateSelected({}),this._model.syncSelected({},this._mainViewModel.id)}_onKeyDown(e){if(this._clipSettings.enabled||this._transformControls.enabled){const t=e=>{e.setMode("rotate"===e.mode?"translate":"rotate")};"r"===e.key&&this._clipSettings.enabled&&(e.preventDefault(),e.stopPropagation(),t(this._clipPlaneTransformControls)),"r"===e.key&&this._transformControls.enabled&&(e.preventDefault(),e.stopPropagation(),t(this._transformControls))}}_updateRefLength(e=!1){if(this._meshGroup&&this._meshGroup.children.length){const t=new ce.Pq0;this._boundingGroup.getSize(t),this._refLength=Math.max(t.x,t.y,t.z)/5||1,this._updatePointersScale(this._refLength),e&&(this._camera.lookAt(this._scene.position),this._camera.position.set(10*this._refLength,10*this._refLength,10*this._refLength)),this._clippingPlaneMeshControl.geometry=new ce.bdM(10*this._refLength,10*this._refLength)}else this._refLength=null}async _objToMesh(e,t){var n;const{binary:o,format:i,value:s}=t;let a;if("STL"===i){let e;if(o){const t=`data:application/octet-stream;base64,${s}`,n=await fetch(t);e=await n.arrayBuffer()}else e=s;a=(new et.t).parse(e)}if(!a)return;const r=new ce.tXL({color:we,wireframe:this.state.wireframe}),l=new ce.eaF(a,r),c=new ce.XJ7(l.geometry),d=new ce.mrM({color:"black"}),h=new ce.DXC(c,d);l.add(h),l.name=e,this._meshGroup&&(this._meshGroup.add(l),null===(n=this._boundingGroup)||void 0===n||n.expandByObject(l)),this._updateRefLength(!0)}_workerBusyHandler(e,t){this._loadingTimeout&&clearTimeout(this._loadingTimeout),t?this._loadingTimeout=setTimeout((()=>{this.setState((e=>Object.assign(Object.assign({},e),{loading:!0})))}),250):this.setState((e=>Object.assign(Object.assign({},e),{loading:!1})))}async _requestRender(e,t){var n;const{shapes:o,postShapes:i,postResult:s}=t;if(null!=o){this._shapeToMesh(o);const e={binary:!0,onlyVisible:!1};if(s&&this._meshGroup){const t=new Ke.r,n=[];Object.values(s).forEach((o=>{var i;const s=null===(i=o.jcObject.parameters)||void 0===i?void 0:i.Object;if(!s)return;const a=this._meshGroup.getObjectByName(`${s}-group`);if(!a)return;const r=new Promise((n=>{t.parse(a,(e=>{o.postShape=e,n()}),(()=>{}),e)}));n.push(r)})),await Promise.all(n),this._mainViewModel.sendRawGeometryToWorker(s)}}null!=i&&Object.entries(i).forEach((([e,t])=>{this._objToMesh(e,t)}));const a=this._model.localState;(null===(n=null==a?void 0:a.selected)||void 0===n?void 0:n.value)&&this._updateSelected(a.selected.value)}_updatePointersScale(e){var t;null===(t=this._pointer3D)||void 0===t||t.mesh.scale.set(e/10,e/10,e/10);for(const t in this._collaboratorPointers)this._collaboratorPointers[t].mesh.scale.set(e/10,e/10,e/10)}_createPointer(e){var t,n;let o=null;o=(null===(t=null==e?void 0:e.color)||void 0===t?void 0:t.startsWith("var"))?m.Ay(getComputedStyle(document.documentElement).getPropertyValue(e.color.slice(4,-1))):m.Ay(null!==(n=null==e?void 0:e.color)&&void 0!==n?n:"steelblue");const i=new ce.Gu$(1,32,32),s=new ce.V9B({color:o?new ce.Q1f(o.r/255,o.g/255,o.b/255):"black"}),a=new ce.eaF(i,s);return this._refLength&&a.scale.set(this._refLength/10,this._refLength/10,this._refLength/10),a}_updateSelected(e){var t,n,o,i,s,a,r;if(JSON.stringify(e)===JSON.stringify(this._currentSelection))return;this._currentSelection=Object.assign({},e);const l=Object.keys(e);for(const e of this._selectedMeshes){let i=e.userData.originalColor;i||(i=e.material.color.clone(),e.userData.originalColor=i),(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.color=i);const s=null===(o=null===(n=this._meshGroup)||void 0===n?void 0:n.getObjectByName(e.name))||void 0===o?void 0:o.parent,a=null==s?void 0:s.getObjectByName(be);a&&(a.visible=!1),s.userData.jcObject.visible||(s.visible=!1,e.material.opacity=1,e.material.transparent=!1);const r=e.material;(null==r?void 0:r.linewidth)&&(r.linewidth=2)}this._selectedMeshes=[];for(const e of l){const t=null===(i=this._meshGroup)||void 0===i?void 0:i.getObjectByName(e);if(t)if(this._selectedMeshes.push(t),t.name.startsWith("edge")){t.userData.originalColor||(t.userData.originalColor=t.material.color.clone()),(null===(s=null==t?void 0:t.material)||void 0===s?void 0:s.color)&&(t.material.color=fe);const e=t.material;(null==e?void 0:e.linewidth)&&(e.linewidth=6),t.material.wireframe=!1}else{const e=null===(r=null===(a=this._meshGroup)||void 0===a?void 0:a.getObjectByName(t.name))||void 0===r?void 0:r.parent;e.userData.jcObject.visible||(e.visible=!0,t.material.opacity=.5,t.material.transparent=!0);const n=null==e?void 0:e.getObjectByName(be);n&&(n.visible=!0)}}this._updateTransformControls(l)}_updateTransformControls(e){var t;if(1===e.length&&!this._explodedView.enabled){const n=e[0],o=null===(t=this._meshGroup)||void 0===t?void 0:t.children.find((e=>e.name.startsWith(n)));if(o)return this._transformControls.attach(o),this._transformControls.visible=this.state.transform,void(this._transformControls.enabled=this.state.transform)}this._transformControls.detach(),this._transformControls.visible=!1,this._transformControls.enabled=!1}_onSharedOptionsChanged(e,t){var n,o;const i=e.sharedModel.objects;if(i)for(const e of i){const t=e.name,i=null===(n=this._meshGroup)||void 0===n?void 0:n.getObjectByName(t);if(!i)continue;const s=e.visible,a=null==i?void 0:i.material.color;i.parent.visible=s,i.parent.userData.visible=s;const r=null===(o=this._explodedViewLinesHelperGroup)||void 0===o?void 0:o.getObjectByName(t);if(r&&(r.visible=s),i.material.color)if("color"in e){const t=e.color,n=new ce.Q1f(t[0],t[1],t[2]);i.material.color=n}else i.material.color=a||we}}_onViewChanged(e,t){var n;if("axes"===t.key){null===(n=this._sceneAxe)||void 0===n||n.removeFromParent();const e=t.newValue;"remove"!==t.type&&e&&e.visible&&(this._sceneAxe=new ce.IzY(e.size),this._scene.add(this._sceneAxe))}if("explodedView"===t.key){const e=t.newValue;"remove"!==t.type&&e&&(this._explodedView=e,this._setupExplodedView())}if("cameraSettings"===t.key){const e=t.newValue;"remove"!==t.type&&e&&(this._cameraSettings=e,this._updateCamera())}if("clipView"===t.key){const e=t.newValue;"remove"!==t.type&&e&&this.setState((t=>Object.assign(Object.assign({},t),{clipEnabled:e.enabled})),(()=>{this._clipSettings=e,this._updateClipping()}))}if("splitScreen"===t.key){const e=t.newValue;this._updateSplit(!!(null==e?void 0:e.enabled))}if("wireframe"===t.key){const e=t.newValue;void 0!==e&&this.setState((t=>Object.assign(Object.assign({},t),{wireframe:e})),(()=>{this._meshGroup&&this._meshGroup.traverse((t=>{t instanceof ce.eaF&&(t.material.wireframe=e,t.material.needsUpdate=!0)}))}))}if("transform"===t.key){const e=t.newValue;void 0!==e&&this.setState((t=>Object.assign(Object.assign({},t),{transform:e})),(()=>{this._updateTransformControls(Object.keys(this._currentSelection||{}))}))}}_setupExplodedView(){var e,t,n,o,i,s;if(this._explodedView.enabled){const o=new ce.Pq0;this._boundingGroup.getCenter(o),null===(e=this._explodedViewLinesHelperGroup)||void 0===e||e.removeFromParent(),this._explodedViewLinesHelperGroup=new ce.YJl;for(const e of null===(t=this._meshGroup)||void 0===t?void 0:t.children){const t=null===(n=e.userData.jcObject.parameters)||void 0===n?void 0:n.Placement.Position,o=xe({mesh:e.getObjectByName(e.name.replace("-group","")),boundingGroup:this._boundingGroup,factor:this._explodedView.factor});e.position.copy(new ce.Pq0(t[0]+o.vector.x*o.distance,t[1]+o.vector.y*o.distance,t[2]+o.vector.z*o.distance));const i=new ce.mrM({color:ye,linewidth:2}),s=(new ce.LoY).setFromPoints([o.oldGeometryCenter,o.newGeometryCenter]),a=new ce.N1A(s,i);a.name=e.name,a.visible=e.visible,this._explodedViewLinesHelperGroup.add(a)}this._scene.add(this._explodedViewLinesHelperGroup)}else{for(const e of null===(o=this._meshGroup)||void 0===o?void 0:o.children){const t=null===(i=e.userData.jcObject.parameters)||void 0===i?void 0:i.Placement.Position;e.position.copy(new ce.Pq0(t[0],t[1],t[2]))}null===(s=this._explodedViewLinesHelperGroup)||void 0===s||s.removeFromParent()}this._updateTransformControls(Object.keys(this._currentSelection||{}))}_updateCamera(){var e,t;const n=(new ce.Pq0).copy(this._camera.position),o=(new ce.Pq0).copy(this._camera.up),i=this._controls.target.clone();if(this._camera.remove(this._cameraLight),this._scene.remove(this._camera),"Perspective"===this._cameraSettings.type)this._camera=new ce.ubm(50,2,rt,lt);else{const o=(null===(e=this._divRef.current)||void 0===e?void 0:e.clientWidth)||0,s=(null===(t=this._divRef.current)||void 0===t?void 0:t.clientHeight)||0,a=1e3/n.distanceTo(i);this._camera=new ce.qUd(o/-2,o/2,s/2,s/-2),this._camera.zoom=a,this._camera.updateProjectionMatrix()}this._camera.add(this._cameraLight),this._createViewHelper(),this._scene.add(this._camera),this._controls.object=this._camera,this._camera.position.copy(n),this._camera.up.copy(o),this._transformControls.camera=this._camera,this._clipPlaneTransformControls.camera=this._camera;const s=new Event("resize");window.dispatchEvent(s)}_updateSplit(e){var t,n,o;if(e){if(!this._meshGroup)return;this._renderer.setScissorTest(!0),this._sliderPos=(null!==(n=null===(t=this._divRef.current)||void 0===t?void 0:t.clientWidth)&&void 0!==n?n:0)/2,this._sceneL=new ce.Z58,this._sceneL.background=Ce,this._sceneL.add(new ce.$p8(16777215,.5));const e=new ce.dth(16777215,4473924,.5);this._sceneL.add(e),this._sceneL.add(this._camera),this._sceneL.add(this._meshGroup.clone(!0)),this.initSlider(!0)}else this._renderer.setScissorTest(!1),null===(o=this._sceneL)||void 0===o||o.clear(),this._sceneL=void 0,this.initSlider(!1)}initSlider(e){if(!this._mainViewRef.current)return;const t=this._mainViewRef.current.querySelector(".jpcad-SplitSlider"),n=this._mainViewRef.current.querySelector("#split-label-left"),o=this._mainViewRef.current.querySelector("#split-label-right");if(e?(t.style.display="unset",n.style.display="unset",o.style.display="unset",t.style.left=this._sliderPos-t.offsetWidth/2+"px"):(t.style.display="none",n.style.display="none",o.style.display="none"),!this._slideInit){this._slideInit=!0;let e=0,n=0;const o=t=>{t.preventDefault(),this._controls.enabled=!1,e=t.clientX,n=this._sliderPos,window.addEventListener("pointermove",s),window.addEventListener("pointerup",i)},i=t=>{t.preventDefault(),this._controls.enabled=!0,e=0,n=0,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",i)},s=o=>{o.preventDefault(),this._divRef.current&&t&&(this._sliderPos=n+o.clientX-e,t.style.left=this._sliderPos-t.offsetWidth/2+"px")};t.style.touchAction="none",t.addEventListener("pointerdown",o)}}_updateClipping(){this._clipSettings.enabled?(this._renderer.localClippingEnabled=!0,this._clipPlaneTransformControls.enabled=!0,this._clipPlaneTransformControls.visible=!0,this._clipPlaneTransformControls.attach(this._clippingPlaneMeshControl),this._clipPlaneTransformControls.position.copy(new ce.Pq0(0,0,0)),this._clippingPlaneMeshControl.visible=this._clipSettings.showClipPlane,this._clippingPlaneMesh&&(this._clippingPlaneMesh.visible=!0)):(this._renderer.localClippingEnabled=!1,this._clipPlaneTransformControls.enabled=!1,this._clipPlaneTransformControls.visible=!1,this._clippingPlaneMeshControl.visible=!1,this._clippingPlaneMesh&&(this._clippingPlaneMesh.visible=!1))}_computeAnnotationPosition(e){var t;const n=null===(t=this._meshGroup)||void 0===t?void 0:t.getObjectByName(e.parent),o=new ce.Pq0(e.position[0],e.position[1],e.position[2]);if(this._explodedView.enabled&&n){const e=xe({mesh:n,boundingGroup:this._boundingGroup,factor:this._explodedView.factor}),t=e.vector.multiplyScalar(e.distance);o.add(t)}const i=this._renderer.domElement;return function(e){const{vector:t,camera:n,width:o,height:i}=e,s=(new ce.Pq0).copy(t);return s.project(n),new ce.I9Y((.5+s.x/2)*o,(.5-s.y/2)*i)}({vector:o,camera:this._camera,width:i.width,height:i.height})}render(){const e=this.state.transform||this._clipSettings.enabled;return s.createElement("div",{className:"jcad-Mainview data-jcad-keybinding",tabIndex:-2,style:{border:this.state.remoteUser?`solid 3px ${this.state.remoteUser.color}`:"unset"},ref:this._mainViewRef},s.createElement(at,{loading:this.state.loading}),s.createElement(st,{remoteUser:this.state.remoteUser}),Object.entries(this.state.annotations).map((([e,t])=>{if(!this._model.annotationModel)return null;const n=this._computeAnnotationPosition(t);return s.createElement("div",{key:e,id:e,style:{left:n.x,top:n.y},className:"jcad-Annotation-Wrapper"},s.createElement(it,{itemId:e,model:this._model.annotationModel,open:!1}))})),s.createElement("div",{className:"jpcad-SplitSlider",style:{display:"none"}}),s.createElement("div",{ref:this._divRef,style:{width:"100%",height:"calc(100%)"}}),e&&s.createElement("div",{style:{position:"absolute",bottom:"10px",left:"10px",padding:"8px",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",borderRadius:"4px",fontSize:"12px"}},s.createElement("div",{style:{marginBottom:"2px"}},"Press R to switch mode"),"rotate"===this.state.transformMode&&s.createElement("div",null,s.createElement("label",{style:{marginRight:"8px"}},"Rotation Snap (°):"),s.createElement("input",{type:"number",value:this.state.rotationSnapValue,onChange:this._handleSnapChange,style:{width:"50px",padding:"4px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"12px"}}))),s.createElement("div",{id:"split-label-left",style:{position:"absolute",top:"10px",left:"10px",display:"none"}},"Original document"),s.createElement("div",{id:"split-label-right",style:{position:"absolute",top:"10px",right:"10px",display:"none"}},"Suggested document"))}}class dt extends o.ReactWidget{constructor(e){super(),this._mainViewModel=e.mainViewModel,this.addClass("jp-jupytercad-panel")}render(){return s.createElement(ct,{viewModel:this._mainViewModel})}}var ht=n(54006),pt=n(33647),mt=n(30427),ut=n(51475),gt=n(68211);class vt{constructor(e){this._dryRunResponses={},this._postWorkerId=new Map,this._firstRender=!0,this._renderSignal=new mt.Signal(this),this._workerBusy=new mt.Signal(this),this._isDisposed=!1,this._jcadModel=e.jcadModel,this._viewSetting=e.viewSetting,this._workerRegistry=e.workerRegistry}get isDisposed(){return this._isDisposed}get id(){return this._id}get renderSignal(){return this._renderSignal}get workerBusy(){return this._workerBusy}get jcadModel(){return this._jcadModel}get viewSettingChanged(){return this._viewSetting.changed}get viewSettings(){const e={};for(const t of this._viewSetting.keys())e[t]=this._viewSetting.get(t)||null;return e}dispose(){this._isDisposed||(this._jcadModel.sharedObjectsChanged.disconnect(this._onSharedObjectsChanged,this),this._isDisposed=!0)}initSignal(){this._jcadModel.sharedObjectsChanged.connect(this._onSharedObjectsChanged,this)}initWorker(){this._worker=this._workerRegistry.getDefaultWorker(),this._id=this._worker.register({messageHandler:this.messageHandler.bind(this)}),this._workerRegistry.getAllWorkers().forEach((e=>{const t=e.register({messageHandler:this.postProcessWorkerHandler.bind(this)});this._postWorkerId.set(t,e)}))}messageHandler(e){switch(e.action){case ut.MainAction.DISPLAY_SHAPE:{const{result:t,postResult:n}=e.payload,o={},i={};if(Object.entries(n).forEach((([e,t])=>{var n,s;const a=null===(s=null===(n=t.jcObject)||void 0===n?void 0:n.shapeMetadata)||void 0===s?void 0:s.shapeFormat;a===ut.JCadWorkerSupportedFormat.BREP?o[e]=t:a===ut.JCadWorkerSupportedFormat.GLTF&&(i[e]=t)})),this._firstRender){const e=this._jcadModel.sharedModel.outputs;this._renderSignal.emit({shapes:t,postShapes:e,postResult:i}),this._firstRender=!1}else this._renderSignal.emit({shapes:t,postShapes:null,postResult:i}),this.sendRawGeometryToWorker(o);this._workerBusy.emit(!1);break}case ut.MainAction.DRY_RUN_RESPONSE:this._dryRunResponses[e.payload.id].resolve(e.payload);break;case ut.MainAction.INITIALIZED:{if(!this._jcadModel)return;const e=this._jcadModel.getContent();this._workerBusy.emit(!0),this._postMessage({action:ut.WorkerAction.LOAD_FILE,payload:{content:e}})}}}sendRawGeometryToWorker(e){Object.values(e).forEach((e=>{this._postWorkerId.forEach(((t,n)=>{var o,i;if(!e.jcObject.shape)return;const{shapeFormat:s,workerId:a}=null!==(i=null===(o=e.jcObject)||void 0===o?void 0:o.shapeMetadata)&&void 0!==i?i:{};t===this._workerRegistry.getWorker(null!=a?a:"")&&t.shapeFormat===s&&t.postMessage({id:n,action:ut.WorkerAction.POSTPROCESS,payload:e})}))}))}async maybeUpdateObjectParameters(e,t){var n,i;const s=this.jcadModel.getContent();for(const n of s.objects)n.name===e&&(n.parameters=Object.assign(Object.assign({},n.parameters),t));const a=await this.dryRun(s);if("error"===a.status)return(0,o.showErrorMessage)("Failed to update the desired shape","The tool was unable to update the desired shape due to invalid parameter values. The values you entered may not be compatible with the dimensions of your piece."),!1;const r=null!==(i=null===(n=a.shapeMetadata)||void 0===n?void 0:n[e])&&void 0!==i?i:{},l=this.jcadModel.sharedModel.getObjectByName(e);return l&&this.jcadModel.sharedModel.updateObjectByName(e,{data:{key:"parameters",value:Object.assign(Object.assign({},l.parameters),t)},meta:r}),!0}async dryRun(e){await this._worker.ready;const t=gt.UUID.uuid4();this._dryRunResponses[t]=new gt.PromiseDelegate,this._workerBusy.emit(!0),this._postMessage({action:ut.WorkerAction.DRY_RUN,payload:{id:t,content:e}});const n=await this._dryRunResponses[t].promise;return delete this._dryRunResponses[t],this._workerBusy.emit(!1),n}postProcessWorkerHandler(e){switch(e.action){case ut.MainAction.DISPLAY_POST:{const t={};e.payload.forEach((e=>{const{jcObject:n,postResult:o}=e;this._jcadModel.sharedModel.setOutput(n.name,o),t[n.name]=o})),this._renderSignal.emit({shapes:null,postShapes:t});break}}}addAnnotation(e){var t;null===(t=this._jcadModel.annotationModel)||void 0===t||t.addAnnotation((0,J.A)(),e)}_postMessage(e){if(this._worker){const t=Object.assign(Object.assign({},e),{id:this._id});this._worker.postMessage(t)}}async _onSharedObjectsChanged(e,t){if(t.objectChange){await this._worker.ready;const e=this._jcadModel.getContent();this._workerBusy.emit(!0),this._postMessage({action:ut.WorkerAction.LOAD_FILE,payload:{content:e}})}}}var _t=n(5514);class bt extends Ye.BoxPanel{constructor(e){super({direction:"top-to-bottom"}),this._resize=R((()=>{window.dispatchEvent(new Event("resize"))}),200),this.addClass("jpcad-console");const{manager:t,contentFactory:n,mimeTypeService:o,rendermime:s}=e,a=s.clone();this._consolePanel=new _t.ConsolePanel({manager:t,contentFactory:n,mimeTypeService:o,rendermime:a,kernelPreference:{name:"python3",shutdownOnDispose:!0}}),this._consolePanel.console.node.dataset.jpInteractionMode="notebook",this.addWidget(this._consolePanel),Ye.BoxPanel.setStretch(this._consolePanel,1),this._consolePanel.toolbar.addItem("spacer",i.Toolbar.createSpacerItem()),this._consolePanel.toolbar.addItem("toggle",new i.CommandToolbarButton({label:"",icon:i.expandIcon,id:"jupytercad:toggleConsole",commands:e.commandRegistry})),this._consolePanel.toolbar.addItem("close",new i.CommandToolbarButton({label:"",icon:i.closeIcon,id:"jupytercad:removeConsole",commands:e.commandRegistry}))}get consolePanel(){return this._consolePanel}dispose(){this.isDisposed||(this._consolePanel.dispose(),super.dispose())}execute(){this._consolePanel.console.execute(!1)}onResize(e){super.onResize(e),this._resize()}}class wt extends ht.DocumentWidget{constructor(e){super(e),this.onResize=e=>{window.dispatchEvent(new Event("resize"))}}dispose(){this.content.dispose(),super.dispose()}}class yt extends Ye.SplitPanel{constructor(e){super({orientation:"vertical",spacing:0}),this._consoleOpened=!1;const{model:t,workerRegistry:n,consoleTracker:o}=e,i=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["model","workerRegistry","consoleTracker"]);this._initModel({model:t,workerRegistry:n}),this._initView(),this._consoleOption=i,this._consoleTracker=o}_initModel(e){this._view=new pt.ObservableMap,this._mainViewModel=new vt({jcadModel:e.model,workerRegistry:e.workerRegistry,viewSetting:this._view})}_initView(){this._jupyterCadMainViewPanel=new dt({mainViewModel:this._mainViewModel}),this.addWidget(this._jupyterCadMainViewPanel),Ye.SplitPanel.setStretch(this._jupyterCadMainViewPanel,1)}get jupyterCadMainViewPanel(){return this._jupyterCadMainViewPanel}get viewChanged(){return this._view.changed}dispose(){this.isDisposed||(this._consoleView&&this._consoleView.dispose(),mt.Signal.clearData(this),this._mainViewModel.dispose(),super.dispose())}get currentViewModel(){return this._mainViewModel}get axes(){return this._view.get("axes")}set axes(e){this._view.set("axes",e||null)}get explodedView(){return this._view.get("explodedView")}set explodedView(e){this._view.set("explodedView",e||null)}get cameraSettings(){return this._view.get("cameraSettings")}set cameraSettings(e){this._view.set("cameraSettings",e||null)}get clipView(){return this._view.get("clipView")}set clipView(e){this._view.set("clipView",e||null)}get consolePanel(){var e;return null===(e=this._consoleView)||void 0===e?void 0:e.consolePanel}get splitScreen(){var e;return null!==(e=this._view.get("splitScreen"))&&void 0!==e?e:{enabled:!1}}set splitScreen(e){this._view.set("splitScreen",e||null)}deleteAxes(){this._view.delete("axes")}get wireframe(){return this._view.get("wireframe")}set wireframe(e){this._view.set("wireframe",e)}get transform(){return this._view.get("transform")}set transform(e){this._view.set("transform",e)}executeConsole(){this._consoleView&&this._consoleView.execute()}removeConsole(){this._consoleView&&(this._consoleView.dispose(),this._consoleView=void 0,this._consoleOpened=!1,setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),250))}async toggleConsole(e){if(this._consoleView)this._consoleOpened?(this._consoleOpened=!1,this.setRelativeSizes([1,0])):(this._consoleOpened=!0,this.setRelativeSizes([2,1]));else{const{contentFactory:t,manager:n,mimeTypeService:o,rendermime:i,commandRegistry:s}=this._consoleOption;if(t&&n&&o&&i&&s&&this._consoleTracker){this._consoleView=new bt({contentFactory:t,manager:n,mimeTypeService:o,rendermime:i,commandRegistry:s});const{consolePanel:a}=this._consoleView;this._consoleTracker.widgetAdded.emit(a),await a.sessionContext.ready,await a.console.inject(`from jupytercad_lab import CadDocument\ndoc = CadDocument("${e}")`),this.addWidget(this._consoleView),this.setRelativeSizes([2,1]),this._consoleOpened=!0,a.console.sessionContext.kernelChanged.connect(((e,t)=>{t.newValue||this.removeConsole()}))}}setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),250)}}class ft extends s.Component{constructor(e){super(e);const t=()=>{this.forceUpdate()};this._model=e.model,this._model.contextChanged.connect((async()=>{var n,o,i,s,a,r,l,c;await(null===(o=null===(n=this._model)||void 0===n?void 0:n.context)||void 0===o?void 0:o.ready),null===(a=null===(s=null===(i=this._model)||void 0===i?void 0:i.context)||void 0===s?void 0:s.model)||void 0===a||a.sharedMetadataChanged.disconnect(t),this._model=e.model,null===(c=null===(l=null===(r=this._model)||void 0===r?void 0:r.context)||void 0===l?void 0:l.model)||void 0===c||c.sharedMetadataChanged.connect(t),this.forceUpdate()}))}render(){var e;const t=null===(e=this._model)||void 0===e?void 0:e.getAnnotationIds();if(!t||!this._model)return s.createElement("div",null);const n=t.map((e=>s.createElement("div",null,s.createElement(ot,{model:this._model,itemId:e}),s.createElement("hr",{className:"jpcad-Annotations-Separator"}))));return s.createElement("div",null,n)}}class Ct extends i.PanelWithToolbar{constructor(e){super({}),this.title.label="Annotations",this.addClass("jpcad-Annotations"),this._model=e.model,this._widget=i.ReactWidget.create(s.createElement(ft,{model:this._model})),this.addWidget(this._widget)}}class jt extends Ye.Widget{constructor(){super({node:xt()}),this.title.changed.connect((e=>{this.node.textContent=this.title.label}))}}function xt(){const e=document.createElement("h2");return e.textContent="-",e}class St extends i.PanelWithToolbar{constructor(e){super(e);const{controlPanelModel:t,formSchemaRegistry:n,tracker:i}=e;this.title.label="Objects Properties";const a=o.ReactWidget.create(s.createElement(Mt,{cpModel:t,tracker:i,formSchemaRegistry:n}));this.addWidget(a),this.addClass("jpcad-sidebar-propertiespanel");const r=(e,t)=>{var n,o,i;const s=e.localState;if(!s)return;let a={};if(s.remoteUser){const e=t.get(s.remoteUser);(null===(n=null==e?void 0:e.selected)||void 0===n?void 0:n.value)&&(a=null===(o=null==e?void 0:e.selected)||void 0===o?void 0:o.value)}else(null===(i=s.selected)||void 0===i?void 0:i.value)&&(a=s.selected.value);const r=Object.keys(a);if(1===r.length){const e=r[0];e.startsWith("edge-")&&a[e].parent?this.title.label=a[e].parent:this.title.label=e}else this.title.label="No selection"};let l;t.documentChanged.connect(((e,t)=>{if(t)if(l&&l.clientStateChanged.disconnect(r),t.context.model.sharedModel.editable){l=t.context.model;const e=l.sharedModel.awareness.getStates();r(l,e),l.clientStateChanged.connect(r),a.show()}else this.title.label="Read Only File",a.hide();else this.title.label="-"}))}}class Mt extends s.Component{constructor(e){var t,n,o;super(e),this.syncSelectedField=(e,t,n)=>{var o;let i=null;if(e){const t=e.split("_")[0];i=e.substring(t.length)}null===(o=this.props.cpModel.jcadModel)||void 0===o||o.syncSelectedPropField({parentType:n,id:i,value:t})},this._sharedJcadModelChanged=(e,t)=>{this.setState((e=>{var t,n;if(e.selectedObject){const n=null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject();if(n){const t=W(e.selectedObject,n);if(!t)return e;const o=t.parameters;return Object.assign(Object.assign({},e),{jcadObject:n,selectedObjectData:o})}return e}return Object.assign(Object.assign({},e),{jcadObject:null===(n=this.props.cpModel.jcadModel)||void 0===n?void 0:n.getAllObject()})}))},this._onClientSharedStateChanged=(e,t)=>{var n,o,i,s,a,r,l,c,d;const h=null===(o=null===(n=this.props.cpModel.jcadModel)||void 0===n?void 0:n.localState)||void 0===o?void 0:o.remoteUser,p=this.state.clientId;let m;if(h){m=t.get(h);const e=null===(i=null==m?void 0:m.selectedPropField)||void 0===i?void 0:i.id,n=null===(s=null==m?void 0:m.selectedPropField)||void 0===s?void 0:s.value;"panel"===(null===(a=null==m?void 0:m.selectedPropField)||void 0===a?void 0:a.parentType)&&(this._lastSelectedPropFieldId=z(`${this.state.filePath}::panel`,e,n,null===(r=null==m?void 0:m.user)||void 0===r?void 0:r.color,this._lastSelectedPropFieldId))}else{const e=p?t.get(p):null;this._lastSelectedPropFieldId&&(U(`${this.state.filePath}::panel`,this._lastSelectedPropFieldId,["border-color","box-shadow"]),this._lastSelectedPropFieldId=void 0),e&&(null===(l=e.selected)||void 0===l?void 0:l.emitter)&&e.selected.emitter!==this.state.id&&(null===(c=e.selected)||void 0===c?void 0:c.value)&&(m=e)}if(m){const e=m.selected.value,t=Object.keys(e||{});if(void 0===e||1!==t.length)return void this.setState((e=>Object.assign(Object.assign({},e),{schema:void 0,selectedObject:"",selectedObjectData:void 0})));let n=t[0];if(e[n]&&"shape"!==e[n].type&&(n=e[n].parent),n!==this.state.selectedObject){const e=null===(d=this.props.cpModel.jcadModel)||void 0===d?void 0:d.getAllObject();if(e){let t;const o=W(n,e);if(!o)return;o.shape&&(t=this._formSchema.get(o.shape));const i=o.parameters;this.setState((e=>Object.assign(Object.assign({},e),{selectedObjectData:i,selectedObject:n,schema:t})))}}}else this.setState((e=>Object.assign(Object.assign({},e),{schema:void 0,selectedObject:"",selectedObjectData:void 0})))},this.state={filePath:this.props.cpModel.filePath,jcadObject:null===(t=this.props.cpModel.jcadModel)||void 0===t?void 0:t.getAllObject(),clientId:null,id:(0,J.A)()},this._formSchema=e.formSchemaRegistry.getSchemas(),null===(n=this.props.cpModel.jcadModel)||void 0===n||n.sharedObjectsChanged.connect(this._sharedJcadModelChanged),null===(o=this.props.cpModel.jcadModel)||void 0===o||o.sharedModelSwapped.connect(this._sharedModelSwappedHandler,this),this.props.cpModel.documentChanged.connect(((e,t)=>{if(t){this.props.cpModel.disconnect(this._sharedJcadModelChanged),this.props.cpModel.disconnect(this._onClientSharedStateChanged);const e=t.context.model;e.sharedObjectsChanged.connect(this._sharedJcadModelChanged),e.sharedModelSwapped.connect(this._sharedModelSwappedHandler,this);const n=e.sharedModel.awareness.getStates();this.setState((n=>{var o;return{jcadOption:void 0,selectedObjectData:void 0,selectedObject:void 0,schema:void 0,filePath:t.context.localPath,jcadObject:null===(o=this.props.cpModel.jcadModel)||void 0===o?void 0:o.getAllObject(),clientId:e.getClientId()}}),(()=>{this._onClientSharedStateChanged(e,n),e.clientStateChanged.connect(this._onClientSharedStateChanged)}))}else this.setState({jcadOption:void 0,filePath:void 0,jcadObject:void 0,selectedObjectData:void 0,selectedObject:void 0,schema:void 0})}))}async syncObjectProperties(e,t){if(!this.state.jcadObject||!e)return;const n=this.props.tracker.currentWidget;n&&this.props.cpModel.jcadModel&&n.content.currentViewModel.maybeUpdateObjectParameters(e,t)}_sharedModelSwappedHandler(e){const t=e.getClientId();this.setState((e=>Object.assign(Object.assign({},e),{clientId:t})))}render(){var e;const t=this.state.schema;if(t){const n=null===(e=this.props.cpModel.jcadModel)||void 0===e?void 0:e.getAllObject().reduce(((e,t)=>(t.name!==this.state.selectedObject&&e.push(t.name),e)),[]);for(const e in t.properties){const o=t.properties[e].fcType;if(o){const i=t.properties[e];switch(o){case"App::PropertyLink":i.enum=n;break;case"App::PropertyLinkList":i.items.enum=n}}}}return this.state.schema&&this.state.selectedObjectData?s.createElement(d,{parentType:"panel",filePath:`${this.state.filePath}::panel`,schema:t,sourceData:this.state.selectedObjectData,syncData:e=>{this.syncObjectProperties(this.state.selectedObject,e)},syncSelectedField:this.syncSelectedField}):s.createElement("div",null)}}class Pt extends i.SidePanel{constructor(e){super(),this.addClass("jpcad-sidepanel-widget"),this.addClass("data-jcad-keybinding"),this.node.tabIndex=0,this._model=e.model;const t=new jt;this.header.addWidget(t);const n=new Oe({controlPanelModel:this._model});this.addWidget(n);const o=new St({controlPanelModel:this._model,formSchemaRegistry:e.formSchemaRegistry,tracker:e.tracker});this.addWidget(o),this._handleFileChange=()=>{var e;t.title.label=(null===(e=this._currentContext)||void 0===e?void 0:e.localPath)||"-"},e.tracker.currentChanged.connect(((e,n)=>{n?(this._currentContext&&this._currentContext.pathChanged.disconnect(this._handleFileChange),this._currentContext=n.context,t.title.label=n.context.localPath,this._currentContext.pathChanged.connect(this._handleFileChange)):(t.title.label="-",this._currentContext=null)})),this.content.setRelativeSizes([4,6])}dispose(){super.dispose()}}class kt{constructor(e){this._tracker=e.tracker,this._documentChanged=this._tracker.currentChanged}get documentChanged(){return this._documentChanged}get filePath(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.localPath}get jcadModel(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.model}get sharedModel(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.context.model.sharedModel}get mainViewModel(){var e;return null===(e=this._tracker.currentWidget)||void 0===e?void 0:e.content.currentViewModel}disconnect(e){this._tracker.forEach((t=>{t.context.model.sharedObjectsChanged.disconnect(e),t.context.model.sharedOptionsChanged.disconnect(e),t.context.model.sharedMetadataChanged.disconnect(e)})),this._tracker.forEach((t=>t.context.model.themeChanged.disconnect(e))),this._tracker.forEach((t=>t.context.model.clientStateChanged.disconnect(e)))}}const Ot=e=>{const[t,n]=s.useState(),[a,r]=s.useState([{id:"root",label:e.model.title,parentId:null,items:[]}]),l=(0,Se.l)(),c=s.useCallback((()=>{const t=e.model.allForks,n=[...a];n[0]=Object.assign(Object.assign({},a[0]),{label:e.model.title,items:Object.entries(t).map((([e,t])=>{var n;return{id:e,label:t.title&&t.title.length?t.title:e,parentId:"root",rootRoomId:t.root_roomid,metadata:JSON.parse(null!==(n=t.description)&&void 0!==n?n:"{}")}}))}),r(n)}),[e.model,a]);s.useEffect((()=>{e.model.contextChanged.connect(c),e.model.forksUpdated.connect(c),e.model.forkSwitched.connect(((e,t)=>{n(t),!t&&l.current&&l.current.toggleAllNodesSelectedState("unselected")}))}),[e.model,c,l]);const d=s.useCallback((async t=>{const{button:n}=await(0,o.showDialog)({title:"Accept suggestion",body:"Do you want to merge content of the suggestion?",buttons:[o.Dialog.cancelButton(),o.Dialog.okButton()],hasClose:!0});n.accept&&await e.model.mergeFork(t)}),[e.model]),h=s.useCallback((async t=>{const{button:n}=await(0,o.showDialog)({title:"Delete suggestion",body:"Do you want to delete the suggestion?",buttons:[o.Dialog.cancelButton(),o.Dialog.okButton()],hasClose:!0});n.accept&&await e.model.deleteFork(t)}),[e.model]);return s.createElement("div",{className:"jcad-Suggestion"},s.createElement("div",{className:"jpcad-treeview-wrapper"},s.createElement(Se.a,{ref:l,multiSelect:!1,nodes:a,messages:{noData:"No data"},theme:"labTheme",themes:ke,openNodes:["root"],RenderIcon:e=>{if("node"===e.type)return s.createElement(V.react,{className:"jcad-suggestion-tree-node-icon"})},RenderNode:o=>{var a,r,l,c,p;const m=null===(a=o.node)||void 0===a?void 0:a.metadata,u=null==m?void 0:m.author;return s.createElement("div",{className:"jpcad-control-panel-suggestion "+(t===o.node.id?"selected":"")},s.createElement("div",{title:null!==(r=null==m?void 0:m.timestamp)&&void 0!==r?r:""},"leaf"===o.type&&s.createElement("div",{title:`Created at: ${null!==(l=null==u?void 0:u.display_name)&&void 0!==l?l:""}`,className:"jcad-suggestion-tree-node-user",style:{backgroundColor:null!==(c=null==u?void 0:u.color)&&void 0!==c?c:"#999999"}},s.createElement("span",null,null!==(p=null==u?void 0:u.initials)&&void 0!==p?p:"")),s.createElement("span",{className:"jcad-suggestion-tree-node-label"},o.node.label),"leaf"===o.type&&s.createElement("div",{style:{display:"flex"}},s.createElement(i.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:async()=>{n(o.node.id),await e.model.checkoutFork(o.node.id)},icon:t===o.node.id?v:_,tooltip:"Preview suggestion"}),s.createElement(i.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:async()=>await d(o.node.id),icon:i.checkIcon,tooltip:"Accept suggestion"}),s.createElement(i.ToolbarButtonComponent,{className:"jp-ToolbarButtonComponent",onClick:async()=>await h(o.node.id),icon:i.closeIcon,tooltip:"Delete suggestion"}))))}})))};function Et(e){const{setForkLabel:t}=e,[n,o]=s.useState("New suggestion"),i=s.useCallback((e=>{o(e),t(e)}),[t]);return s.createElement("div",null,s.createElement("p",{className:"field-description"},"Label of the suggestion"),s.createElement("input",{className:"form-control jp-mod-styled",style:{width:"100%"},value:n,onChange:e=>i(e.target.value),type:"text",placeholder:"New suggestion"}))}class At extends i.PanelWithToolbar{constructor(e){super(),this.title.label="Suggestions";const{model:t}=e;this._model=t;const n=o.ReactWidget.create(s.createElement(Ot,{model:t}));this.addWidget(n),this.addClass("jpcad-sidebar-propertiespanel"),this.toolbar.addItem("backToRoot",new i.ToolbarButton({icon:i.homeIcon,onClick:async()=>{await this._model.backToRoot(!0)},tooltip:"Return to root document"})),this.toolbar.addItem("newFork",new i.ToolbarButton({icon:i.addIcon,onClick:this.createFork.bind(this),tooltip:"Create new fork"}))}async createFork(){const e={forkLabel:"New suggestion"},t=o.ReactWidget.create(s.createElement(Et,{setForkLabel:t=>e.forkLabel=t}));if((await(0,o.showDialog)({title:"Create new suggestion",body:t,buttons:[o.Dialog.cancelButton(),o.Dialog.okButton()],hasClose:!0})).button.accept){const t=""===e.forkLabel?void 0:e.forkLabel;await this._model.createFork(t)}}}var It=n(80771);class Tt{constructor(e){this._allForks={},this._forksUpdated=new mt.Signal(this),this._forkSwitched=new mt.Signal(this),this._contextChanged=new mt.Signal(this);const{tracker:t,forkManager:n,filePath:o,jupytercadModel:i,collaborativeDrive:s}=e;this._tracker=t,this._forkManager=n,this._drive=s,this.switchContext({filePath:o,jupytercadModel:i}),this._forkManager.forkAdded.connect(this._handleForkAdded,this),this._forkManager.forkDeleted.connect(this._handleForkDeleted,this)}get currentForkId(){return this._currentForkId}get title(){var e,t;const n=null!==(t=null===(e=this._filePath)||void 0===e?void 0:e.split(":"))&&void 0!==t?t:[];return n.length>1?n[1]:n[0]}get allForks(){return this._allForks}get forksUpdated(){return this._forksUpdated}get forkSwitched(){return this._forkSwitched}get contextChanged(){return this._contextChanged}get currentUser(){return this._currentUser}async switchContext(e){var t,n,o;if(this._filePath=e.filePath,this._jupytercadModel=e.jupytercadModel,this._jupytercadModel||(this._allForks={}),this._filePath&&this._filePath.length>0){const e=this._currentSession=await(0,It.requestDocSession)("text","jcad",this._filePath);this._forkProvider=this._forkManager.getProvider({documentPath:this._filePath,format:e.format,type:e.type}),this._rootDocId=`${e.format}:${e.type}:${e.fileId}`,this._allForks=await this._forkManager.getAllForks(this._rootDocId),this._currentForkId=void 0,this._forkSwitched.emit(void 0)}if(null===(t=this._jupytercadModel)||void 0===t?void 0:t.currentUserId){const e=(null!==(o=null===(n=this._jupytercadModel)||void 0===n?void 0:n.users)&&void 0!==o?o:[]).filter((e=>e.userId===this._jupytercadModel.currentUserId));e[0]&&(this._currentUser=e[0])}this._contextChanged.emit()}async mergeFork(e){var t;await this._forkManager.deleteFork({forkId:e,merge:!0}),await(null===(t=this._forkProvider)||void 0===t?void 0:t.reconnect()),this._toggleSplitScreen(!1),this._currentForkId=void 0,this._forkSwitched.emit(void 0)}async deleteFork(e){await this._forkManager.deleteFork({forkId:e,merge:!1})}async createFork(e){var t;if(this._rootDocId){const n={timestamp:new Date(Date.now()).toLocaleString(),author:null===(t=this._currentUser)||void 0===t?void 0:t.userData};try{const t=await this._forkManager.createFork({rootId:this._rootDocId,synchronize:!1,title:e,description:JSON.stringify(n)});return t&&this.checkoutFork(t.fork_roomid),t}catch(e){console.error(e)}}}async backToRoot(e=!1){var t,n;if(this._currentForkId&&(null===(t=this._jupytercadModel)||void 0===t||t.sharedModel.dispose(),this._drive&&this._currentSession&&this._filePath)){const t=this._drive.sharedModelFactory.createNew({path:this._filePath,format:this._currentSession.format,contentType:this._currentSession.type,collaborative:!0});t&&(null===(n=this._jupytercadModel)||void 0===n||n.swapSharedModel(t)),this._forkProvider=this._forkManager.getProvider({documentPath:this._filePath,format:this._currentSession.format,type:this._currentSession.type}),await this._forkProvider.ready,e&&this._toggleSplitScreen(!1),this._currentForkId=void 0,this._forkSwitched.emit(void 0)}}async checkoutFork(e){var t;let n=!0;this._currentForkId!==e&&this._currentSession&&(this._currentForkId&&(n=!1,await this.backToRoot()),await(null===(t=this._forkProvider)||void 0===t?void 0:t.connectToForkDoc(e,this._currentSession.sessionId)),n&&this._toggleSplitScreen(!0),this._currentForkId=e,this._forkSwitched.emit(e))}_toggleSplitScreen(e){const t=this._tracker.currentWidget;t&&t.content.splitScreen&&(t.content.splitScreen={enabled:e})}async _handleForkDeleted(e,t){this._rootDocId&&t.fork_info.root_roomid===this._rootDocId&&(this._allForks=await this._forkManager.getAllForks(this._rootDocId),this._forksUpdated.emit(),this._currentForkId&&t.fork_roomid===this._currentForkId&&this.backToRoot(!0))}async _handleForkAdded(e,t){this._rootDocId&&t.fork_info.root_roomid===this._rootDocId&&(this._allForks=await this._forkManager.getAllForks(this._rootDocId),this._forksUpdated.emit())}}class Lt extends i.SidePanel{constructor(e){var t;super(),this.addClass("jpcad-sidepanel-widget"),this.addClass("data-jcad-keybinding"),this.node.tabIndex=0;const{model:n,tracker:o,forkManager:i,collaborativeDrive:s,annotationModel:a}=e;this._model=n,this._annotationModel=a;const r=new jt;this.header.addWidget(r);const l=new Ct({model:this._annotationModel});let c;if(this.addWidget(l),i){c=new Tt({jupytercadModel:null===(t=this._model)||void 0===t?void 0:t.jcadModel,filePath:"",tracker:o,forkManager:i,collaborativeDrive:s});const e=new At({model:c});this.addWidget(e)}this._handleFileChange=()=>{var e;r.title.label=(null===(e=this._currentContext)||void 0===e?void 0:e.localPath)||"-"},e.tracker.currentChanged.connect((async(t,n)=>{var o,i;n?(this._currentContext&&this._currentContext.pathChanged.disconnect(this._handleFileChange),this._currentContext=n.context,r.title.label=this._currentContext.localPath,this._currentContext.pathChanged.connect(this._handleFileChange),this._annotationModel.context=(null===(o=e.tracker.currentWidget)||void 0===o?void 0:o.context)||void 0,await n.context.ready,null==c||c.switchContext({filePath:n.context.localPath,jupytercadModel:null===(i=n.context)||void 0===i?void 0:i.model})):(r.title.label="-",this._currentContext=null,this._annotationModel.context=void 0,null==c||c.switchContext({filePath:"",jupytercadModel:void 0}))}))}dispose(){super.dispose()}}class Dt extends s.Component{constructor(e){super(e),this.selectUser=e=>{var t;let n;e.userId!==(null===(t=this.state.selectedUser)||void 0===t?void 0:t.userId)&&(n=e),this.setState((e=>Object.assign(Object.assign({},e),{selectedUser:n})),(()=>{this._model.setUserToFollow(null==n?void 0:n.userId)}))},this._model=e.model,this.state={usersList:[]}}componentDidMount(){this.setState((e=>Object.assign(Object.assign({},e),{usersList:this._model.users}))),this._model.userChanged.connect(((e,t)=>{this.setState((e=>Object.assign(Object.assign({},e),{usersList:t})))}))}createUserIcon(e){var t;let n;const{userId:o,userData:i}=e,a=o===(null===(t=this.state.selectedUser)||void 0===t?void 0:t.userId)?"selected":"";return n=i.avatar_url?s.createElement("div",{key:o,title:i.display_name,className:`lm-MenuBar-itemIcon jp-MenuBar-imageIcon ${a}`,onClick:()=>this.selectUser(e)},s.createElement("img",{src:i.avatar_url,alt:""})):s.createElement("div",{key:o,title:i.display_name,className:`lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon ${a}`,style:{backgroundColor:i.color},onClick:()=>this.selectUser(e)},s.createElement("span",null,i.initials)),n}filterDuplicated(e){var t;const n=[],o=new Set;for(const i of e)(null===(t=null==i?void 0:i.userData)||void 0===t?void 0:t.username)&&!o.has(i.userData.username)&&(o.add(i.userData.username),n.push(i));return n}render(){return s.createElement("div",{className:"jpcad-toolbar-usertoolbar"},this.filterDuplicated(this.state.usersList).map((e=>{if(e.userId!==this._model.currentUserId)return this.createUserIcon(e)})))}}const Nt="jcad-Toolbar-Separator";class Bt extends Ye.Widget{constructor(){super(),this.addClass(Nt)}}class Vt extends i.ReactiveToolbar{constructor(e){super(),this.addClass("jpcad-toolbar-widget"),setTimeout((()=>{var t;e.commands&&(this.addItem("undo",new o.CommandToolbarButton({id:qe.undo,label:"",icon:i.undoIcon,commands:e.commands})),this.addItem("redo",new o.CommandToolbarButton({id:qe.redo,label:"",icon:i.redoIcon,commands:e.commands})),this.addItem("separator1",new Bt),this.addItem("New Box",new o.CommandToolbarButton({id:qe.newBox,label:"",commands:e.commands})),this.addItem("New Cylinder",new o.CommandToolbarButton({id:qe.newCylinder,label:"",commands:e.commands})),this.addItem("New Sphere",new o.CommandToolbarButton({id:qe.newSphere,label:"",commands:e.commands})),this.addItem("New Cone",new o.CommandToolbarButton({id:qe.newCone,label:"",commands:e.commands})),this.addItem("New Torus",new o.CommandToolbarButton({id:qe.newTorus,label:"",commands:e.commands})),this.addItem("separator2",new Bt),this.addItem("Cut",new o.CommandToolbarButton({id:qe.cut,label:"",commands:e.commands})),this.addItem("Union",new o.CommandToolbarButton({id:qe.union,label:"",commands:e.commands})),this.addItem("Intersection",new o.CommandToolbarButton({id:qe.intersection,label:"",commands:e.commands})),this.addItem("Extrusion",new o.CommandToolbarButton({id:qe.extrusion,label:"",commands:e.commands})),this.addItem("separator3",new Bt),this.addItem("Chamfer",new o.CommandToolbarButton({id:qe.chamfer,label:"",commands:e.commands})),this.addItem("Fillet",new o.CommandToolbarButton({id:qe.fillet,label:"",commands:e.commands})),this.addItem("separator4",new Bt),this.addItem("New Sketch",new o.CommandToolbarButton({id:qe.newSketch,label:"",commands:e.commands})),this.addItem("separator5",new Bt),this.addItem("Exploded View",new o.CommandToolbarButton({id:qe.updateExplodedView,label:"",commands:e.commands})),this.addItem("Clip View",new o.CommandToolbarButton({id:qe.updateClipView,label:"",commands:e.commands})),this.addItem("Toggle Wireframe",new o.CommandToolbarButton({id:qe.wireframe,label:"",commands:e.commands})),this.addItem("Toggle Transform Controls",new o.CommandToolbarButton({id:qe.transform,label:"",commands:e.commands})),this.addItem("separator6",new Bt),this.addItem("Axes Helper",new o.CommandToolbarButton({id:qe.updateAxes,label:"",commands:e.commands})),this.addItem("Camera Settings",new o.CommandToolbarButton({id:qe.updateCameraSettings,label:"",commands:e.commands})),this.addItem("separator7",new Bt),this.addItem("Toggle console",new o.CommandToolbarButton({id:qe.toggleConsole,commands:e.commands,label:"",icon:i.terminalIcon})),this.addItem("separator8",new Bt),(null!==(t=e.externalCommands)&&void 0!==t?t:[]).forEach((t=>{var n;this.addItem(t.name,new o.CommandToolbarButton({id:t.id,label:null!==(n=t.label)&&void 0!==n?n:"",commands:e.commands}))})),this.addItem("spacer",i.ReactiveToolbar.createSpacerItem()),this.addItem("users",i.ReactWidget.create(s.createElement(Dt,{model:e.model}))))}),100)}}class Rt{constructor(e){this._contextChanged=new mt.Signal(this),this._updateSignal=new mt.Signal(this),this.context=e.context}get updateSignal(){return this._updateSignal}get user(){return this._user}set context(e){var t;this._context=e;const n=null===(t=this._context)||void 0===t?void 0:t.model.sharedModel.awareness.getLocalState();this._user=null==n?void 0:n.user,this._contextChanged.emit(void 0)}get context(){return this._context}get contextChanged(){return this._contextChanged}update(){this._updateSignal.emit(null)}getAnnotation(e){var t;const n=null===(t=this._context)||void 0===t?void 0:t.model.sharedModel.getMetadata(e);if(n)return JSON.parse(n)}getAnnotationIds(){var e;const t=[];for(const n in null===(e=this._context)||void 0===e?void 0:e.model.sharedModel.metadata)n.startsWith("annotation")&&t.push(n);return t}addAnnotation(e,t){var n;null===(n=this._context)||void 0===n||n.model.sharedModel.setMetadata(`annotation_${e}`,JSON.stringify(t))}removeAnnotation(e){var t;null===(t=this._context)||void 0===t||t.model.removeMetadata(e)}addContent(e,t){var n;const o={value:t,user:this._user},i=this.getAnnotation(e);if(i){const t=Object.assign(Object.assign({},i),{contents:[...i.contents,o]});null===(n=this._context)||void 0===n||n.model.sharedModel.setMetadata(e,JSON.stringify(t))}}}}}]);